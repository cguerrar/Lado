@model IEnumerable<Lado.Models.Contenido>
@using Lado.Models
@{
    ViewData["Title"] = "Descubre - Feed Publico";
    Layout = "~/Views/Shared/_LayoutPublico.cshtml";
    var contenidoPremiumIds = ViewBag.ContenidoPremiumIds as List<int> ?? new List<int>();
    var creadoresSugeridos = ViewBag.CreadoresSugeridos as List<ApplicationUser> ?? new List<ApplicationUser>();
    var creadoresPremium = ViewBag.CreadoresPremium as List<ApplicationUser> ?? new List<ApplicationUser>();
    var estaAutenticado = ViewBag.EstaAutenticado as bool? ?? false;
    var anuncios = ViewBag.Anuncios as List<Lado.Models.Anuncio> ?? new List<Lado.Models.Anuncio>();
}

<style>
    /* ========================================
       FEED PUBLICO - ESTILOS
       ======================================== */

    .feed-page-layout {
        display: grid;
        grid-template-columns: 280px minmax(0, 630px) 320px;
        gap: 24px;
        max-width: 1280px;
        margin: 0 auto;
        padding: 20px 16px;
        justify-content: center;
    }

    .feed-main {
        min-width: 0;
    }

    .feed-sidebar-left {
        position: sticky;
        top: 90px;
        height: fit-content;
    }

    .feed-sidebar {
        position: sticky;
        top: 90px;
        height: fit-content;
    }

    /* ========================================
       SIDEBAR IZQUIERDO - ESPACIO PUBLICITARIO
       ======================================== */
    .ad-sidebar-section {
        background: var(--surface);
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
    }

    .ad-sidebar-title {
        font-size: 11px;
        font-weight: 700;
        color: var(--muted);
        margin: 0 0 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .ad-space-box {
        min-height: 250px;
        background: linear-gradient(135deg, rgba(70, 130, 180, 0.05) 0%, rgba(176, 196, 222, 0.1) 100%);
        border: 2px dashed rgba(70, 130, 180, 0.25);
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--muted);
        font-size: 13px;
        font-weight: 500;
        text-align: center;
        padding: 20px;
        transition: all 0.3s ease;
    }

    .ad-space-box:hover {
        border-color: rgba(70, 130, 180, 0.4);
        background: linear-gradient(135deg, rgba(70, 130, 180, 0.08) 0%, rgba(176, 196, 222, 0.15) 100%);
    }

    .ad-space-box i {
        font-size: 32px;
        margin-bottom: 12px;
        color: var(--primary);
        opacity: 0.7;
    }

    .ad-space-box span {
        display: block;
        margin-bottom: 4px;
    }

    .ad-space-box small {
        font-size: 11px;
        opacity: 0.7;
    }

    /* Segunda caja de anuncio */
    .ad-space-box-small {
        min-height: 150px;
        background: linear-gradient(135deg, rgba(70, 130, 180, 0.05) 0%, rgba(176, 196, 222, 0.1) 100%);
        border: 2px dashed rgba(70, 130, 180, 0.25);
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--muted);
        font-size: 12px;
        font-weight: 500;
        text-align: center;
        padding: 15px;
        transition: all 0.3s ease;
    }

    .ad-space-box-small:hover {
        border-color: rgba(70, 130, 180, 0.4);
    }

    .ad-space-box-small i {
        font-size: 24px;
        margin-bottom: 8px;
        color: var(--primary);
        opacity: 0.7;
    }

    /* ========================================
       ANUNCIOS REALES
       ======================================== */
    .ad-card {
        background: var(--surface);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        cursor: pointer;
        text-decoration: none;
        display: block;
    }

    .ad-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }

    .ad-card-image {
        width: 100%;
        aspect-ratio: 1/1;
        object-fit: cover;
        background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
    }

    .ad-card-video {
        width: 100%;
        aspect-ratio: 1/1;
        object-fit: cover;
    }

    .ad-card-content {
        padding: 12px;
    }

    .ad-card-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--fg);
        margin: 0 0 6px;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .ad-card-description {
        font-size: 11px;
        color: var(--muted);
        margin: 0 0 10px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .ad-card-cta {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: var(--primary);
        color: white;
        padding: 8px 14px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s;
        width: 100%;
        justify-content: center;
    }

    .ad-card-cta:hover {
        background: var(--primary-dark);
    }

    .ad-card-cta i {
        font-size: 11px;
    }

    .ad-label {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 9px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }

    .ad-label i {
        font-size: 8px;
    }

    /* Anuncio grande */
    .ad-card-large .ad-card-image,
    .ad-card-large .ad-card-video {
        aspect-ratio: 4/5;
    }

    /* Anuncio pequeno */
    .ad-card-small .ad-card-image,
    .ad-card-small .ad-card-video {
        aspect-ratio: 16/9;
    }

    .ad-card-small .ad-card-content {
        padding: 10px;
    }

    .ad-card-small .ad-card-title {
        font-size: 12px;
        margin-bottom: 8px;
    }

    .ad-card-small .ad-card-cta {
        padding: 6px 12px;
        font-size: 11px;
    }

    .feed-container {
        max-width: 630px;
        margin: 0 auto;
    }

    /* ========================================
       BANNER DE BIENVENIDA
       ======================================== */
    .welcome-banner {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        border-radius: 16px;
        padding: 28px;
        margin-bottom: 24px;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .welcome-banner::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 100%;
        background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.1) 100%);
        transform: skewX(-15deg);
    }

    .welcome-banner h2 {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 0 8px;
    }

    .welcome-banner p {
        font-size: 0.95rem;
        opacity: 0.9;
        margin: 0 0 16px;
    }

    .welcome-banner .btn-group {
        display: flex;
        gap: 12px;
    }

    .welcome-banner .btn {
        padding: 10px 20px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 14px;
        text-decoration: none;
        transition: all 0.2s;
    }

    .welcome-banner .btn-light {
        background: white;
        color: var(--primary-dark);
    }

    .welcome-banner .btn-light:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .welcome-banner .btn-outline {
        background: transparent;
        border: 2px solid rgba(255,255,255,0.5);
        color: white;
    }

    .welcome-banner .btn-outline:hover {
        background: rgba(255,255,255,0.1);
        border-color: white;
    }

    /* ========================================
       POST CARD
       ======================================== */
    .post {
        background: var(--surface);
        border: 1px solid var(--line);
        border-radius: 12px;
        margin-bottom: 24px;
        overflow: hidden;
    }

    .post-header {
        display: flex;
        align-items: center;
        padding: 14px 16px;
    }

    .post-header-left {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
        text-decoration: none;
    }

    .post-header-left:hover .post-username {
        text-decoration: underline;
    }

    .post-avatar {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;
    }

    .post-avatar-placeholder {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 16px;
        flex-shrink: 0;
    }

    .post-user-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .post-username {
        font-weight: 600;
        font-size: 14px;
        color: var(--fg);
    }

    .post-time {
        font-size: 12px;
        color: var(--muted);
    }

    .post-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        margin-left: 8px;
    }

    .post-badge.premium {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
    }

    .post-badge.verified {
        background: var(--primary);
        color: white;
    }

    /* POST MEDIA */
    .post-media {
        position: relative;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        aspect-ratio: 4/3;
        overflow: hidden;
    }

    .post-media img,
    .post-media video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .post-media-placeholder {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--muted);
    }

    /* POST PREMIUM BLUR */
    .post-media.premium-blur {
        position: relative;
    }

    .post-media.premium-blur img,
    .post-media.premium-blur video {
        filter: blur(12px) saturate(1.1);
        transform: scale(1.05);
    }

    .premium-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(0,0,0,0.25);
        text-align: center;
        padding: 20px;
        z-index: 2;
    }

    .premium-overlay .lock-icon {
        width: 64px;
        height: 64px;
        background: rgba(255,255,255,0.15);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
        backdrop-filter: blur(4px);
    }

    .premium-overlay .lock-icon svg {
        width: 32px;
        height: 32px;
        color: white;
    }

    .premium-overlay h4 {
        color: white;
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0 0 8px;
    }

    .premium-overlay p {
        color: rgba(255,255,255,0.8);
        font-size: 0.9rem;
        margin: 0 0 16px;
    }

    .premium-overlay .btn-subscribe {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 12px 28px;
        border-radius: 25px;
        font-weight: 700;
        font-size: 14px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
    }

    .premium-overlay .btn-subscribe:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    /* POST CONTENT */
    .post-content {
        padding: 16px;
    }

    .post-description {
        font-size: 14px;
        line-height: 1.5;
        color: var(--fg);
        margin-bottom: 12px;
    }

    /* POST ACTIONS */
    .post-actions {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        border-top: 1px solid var(--line);
        gap: 16px;
    }

    .post-action-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        background: none;
        border: none;
        color: var(--muted);
        font-size: 14px;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 8px;
        transition: all 0.2s;
    }

    .post-action-btn:hover {
        background: var(--line);
        color: var(--fg);
    }

    .post-action-btn.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .post-action-btn.disabled:hover {
        background: none;
        color: var(--muted);
    }

    .post-action-btn svg {
        width: 20px;
        height: 20px;
    }

    .post-stats {
        margin-left: auto;
        font-size: 13px;
        color: var(--muted);
        display: flex;
        gap: 16px;
    }

    /* ========================================
       SIDEBAR - SUGERENCIAS
       ======================================== */
    .sidebar-section {
        background: var(--surface);
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
    }

    .sidebar-title {
        font-size: 14px;
        font-weight: 700;
        color: var(--muted);
        margin: 0 0 16px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
    }

    /* Tendencias */
    .trends-list {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .trend-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 12px;
        border-radius: 8px;
        text-decoration: none;
        transition: background 0.2s;
    }

    .trend-item:hover {
        background: rgba(255, 196, 0, 0.08);
    }

    .trend-tag {
        font-size: 15px;
        font-weight: 600;
        color: var(--text);
    }

    .trend-count {
        font-size: 12px;
        color: var(--muted);
    }

    .suggested-user {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 0;
        border-bottom: 1px solid var(--line);
    }

    .suggested-user:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }

    .suggested-user:first-child {
        padding-top: 0;
    }

    .suggested-avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;
    }

    .suggested-avatar-placeholder {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 16px;
        flex-shrink: 0;
    }

    .suggested-info {
        flex: 1;
        min-width: 0;
    }

    .suggested-name {
        font-weight: 600;
        font-size: 14px;
        color: var(--fg);
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .suggested-name .verified-badge {
        width: 14px;
        height: 14px;
        color: var(--primary);
        flex-shrink: 0;
    }

    .suggested-meta {
        font-size: 12px;
        color: var(--muted);
    }

    .btn-follow-sm {
        background: var(--primary);
        color: white;
        padding: 6px 16px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 13px;
        text-decoration: none;
        transition: all 0.2s;
        white-space: nowrap;
    }

    .btn-follow-sm:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
    }

    /* PREMIUM CREATORS */
    .premium-creator {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 0;
        border-bottom: 1px solid var(--line);
    }

    .premium-creator:last-child {
        border-bottom: none;
    }

    .premium-avatar {
        position: relative;
    }

    .premium-avatar::after {
        content: '';
        position: absolute;
        inset: -3px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        z-index: -1;
    }

    .premium-badge-icon {
        position: absolute;
        bottom: -2px;
        right: -2px;
        width: 18px;
        height: 18px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid var(--surface);
    }

    .premium-badge-icon svg {
        width: 10px;
        height: 10px;
        color: white;
    }

    /* CTA SIDEBAR */
    .cta-sidebar {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        color: white;
    }

    .cta-sidebar h4 {
        font-size: 1rem;
        font-weight: 700;
        margin: 0 0 8px;
    }

    .cta-sidebar p {
        font-size: 0.85rem;
        opacity: 0.8;
        margin: 0 0 16px;
    }

    .cta-sidebar .btn {
        display: inline-block;
        background: var(--primary);
        color: white;
        padding: 10px 24px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 14px;
        text-decoration: none;
        transition: all 0.2s;
    }

    .cta-sidebar .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(70, 130, 180, 0.4);
    }

    /* ========================================
       LOGIN MODAL
       ======================================== */
    .login-prompt-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.6);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(4px);
    }

    .login-prompt-modal.show {
        display: flex;
    }

    .login-prompt-content {
        background: white;
        border-radius: 20px;
        padding: 40px;
        max-width: 400px;
        width: 90%;
        text-align: center;
        animation: modalSlideIn 0.3s ease;
    }

    @@keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .login-prompt-content .icon-wrapper {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .login-prompt-content .icon-wrapper svg {
        width: 40px;
        height: 40px;
        color: white;
    }

    .login-prompt-content h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 0 12px;
        color: var(--fg);
    }

    .login-prompt-content p {
        color: var(--muted);
        margin: 0 0 24px;
        font-size: 0.95rem;
    }

    .login-prompt-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .login-prompt-buttons .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 14px 28px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 15px;
        text-decoration: none;
        transition: all 0.2s;
    }

    .login-prompt-buttons .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(70, 130, 180, 0.4);
    }

    .login-prompt-buttons .btn-secondary {
        background: transparent;
        color: var(--muted);
        padding: 12px 28px;
        border: none;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: color 0.2s;
    }

    .login-prompt-buttons .btn-secondary:hover {
        color: var(--fg);
    }

    /* ========================================
       RESPONSIVE
       ======================================== */
    @@media (max-width: 1200px) {
        .feed-page-layout {
            grid-template-columns: minmax(0, 630px) 320px;
            max-width: 1000px;
        }

        .feed-sidebar-left {
            display: none;
        }
    }

    @@media (max-width: 900px) {
        .feed-page-layout {
            grid-template-columns: 1fr;
            max-width: 630px;
        }

        .feed-sidebar-left,
        .feed-sidebar {
            display: none;
        }
    }

    @@media (max-width: 600px) {
        .welcome-banner {
            padding: 20px;
        }

        .welcome-banner h2 {
            font-size: 1.25rem;
        }

        .welcome-banner .btn-group {
            flex-direction: column;
        }

        .post-actions {
            padding: 10px 12px;
            gap: 8px;
        }

        .post-action-btn {
            padding: 6px 8px;
            font-size: 12px;
        }

        .post-stats {
            gap: 8px;
            font-size: 12px;
        }
    }

    /* ========================================
       ANUNCIO EN FEED (ESTILO POST)
       ======================================== */
    .post-ad {
        background: var(--surface);
        border: 1px solid var(--line);
        border-radius: 12px;
        margin-bottom: 24px;
        overflow: hidden;
    }

    .post-ad-header {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        gap: 10px;
    }

    .post-ad-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }

    .post-ad-icon svg {
        width: 20px;
        height: 20px;
    }

    .post-ad-info {
        flex: 1;
    }

    .post-ad-label {
        font-size: 13px;
        font-weight: 600;
        color: var(--fg);
    }

    .post-ad-badge {
        font-size: 11px;
        color: var(--muted);
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .post-ad-badge i {
        font-size: 9px;
    }

    .post-ad-media {
        position: relative;
        overflow: hidden;
        cursor: pointer;
        background: #f8f9fa;
    }

    .post-ad-media img,
    .post-ad-media video {
        width: 100%;
        height: auto;
        display: block;
        transition: transform 0.3s ease;
    }

    .post-ad:hover .post-ad-media img,
    .post-ad:hover .post-ad-media video {
        transform: scale(1.02);
    }

    .post-ad-content {
        padding: 14px 16px;
    }

    .post-ad-cta {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        background: var(--primary);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s;
        width: 100%;
    }

    .post-ad-cta:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
    }

    .post-ad-cta i {
        font-size: 12px;
    }

    /* EMPTY STATE */
    .empty-state {
        text-align: center;
        padding: 60px 24px;
        background: var(--surface);
        border-radius: 16px;
        border: 1px solid var(--line);
    }

    .empty-state svg {
        width: 80px;
        height: 80px;
        color: var(--muted);
        margin-bottom: 20px;
        opacity: 0.5;
    }

    .empty-state h3 {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--fg);
        margin: 0 0 8px;
    }

    .empty-state p {
        color: var(--muted);
        font-size: 0.95rem;
        margin: 0;
    }
</style>

<div class="feed-page-layout">
    <!-- SIDEBAR IZQUIERDO - ESPACIO PUBLICITARIO -->
    <aside class="feed-sidebar-left">
        @if (anuncios.Any())
        {
            <!-- Primer anuncio (grande) -->
            var anuncioPrincipal = anuncios.FirstOrDefault();
            if (anuncioPrincipal != null)
            {
                <div class="ad-sidebar-section">
                    <div class="ad-label"><i class="fas fa-ad"></i> Publicidad</div>
                    <a href="@Url.Action("RedirectAnuncio", "FeedPublico", new { id = anuncioPrincipal.Id })"
                       class="ad-card ad-card-large"
                       target="_blank"
                       data-anuncio-id="@anuncioPrincipal.Id">
                        @if (anuncioPrincipal.TipoCreativo == TipoCreativo.Video && !string.IsNullOrEmpty(anuncioPrincipal.UrlCreativo))
                        {
                            <video class="ad-card-video" src="@Url.Content($"~{anuncioPrincipal.UrlCreativo}")" muted autoplay loop playsinline></video>
                        }
                        else if (!string.IsNullOrEmpty(anuncioPrincipal.UrlCreativo))
                        {
                            <img class="ad-card-image" src="@Url.Content($"~{anuncioPrincipal.UrlCreativo}")" alt="@anuncioPrincipal.Titulo">
                        }
                        <div class="ad-card-content">
                            <span class="ad-card-cta">
                                @anuncioPrincipal.TextoBotonDisplay
                                <i class="fas fa-external-link-alt"></i>
                            </span>
                        </div>
                    </a>
                </div>
            }

            <!-- Segundo anuncio (pequeno) -->
            var anuncioSecundario = anuncios.Skip(1).FirstOrDefault();
            if (anuncioSecundario != null)
            {
                <div class="ad-sidebar-section">
                    <div class="ad-label"><i class="fas fa-bullhorn"></i> Promocion</div>
                    <a href="@Url.Action("RedirectAnuncio", "FeedPublico", new { id = anuncioSecundario.Id })"
                       class="ad-card ad-card-small"
                       target="_blank"
                       data-anuncio-id="@anuncioSecundario.Id">
                        @if (anuncioSecundario.TipoCreativo == TipoCreativo.Video && !string.IsNullOrEmpty(anuncioSecundario.UrlCreativo))
                        {
                            <video class="ad-card-video" src="@Url.Content($"~{anuncioSecundario.UrlCreativo}")" muted autoplay loop playsinline></video>
                        }
                        else if (!string.IsNullOrEmpty(anuncioSecundario.UrlCreativo))
                        {
                            <img class="ad-card-image" src="@Url.Content($"~{anuncioSecundario.UrlCreativo}")" alt="Anuncio">
                        }
                        <div class="ad-card-content">
                            <span class="ad-card-cta">
                                @anuncioSecundario.TextoBotonDisplay
                                <i class="fas fa-arrow-right"></i>
                            </span>
                        </div>
                    </a>
                </div>
            }
        }
        else
        {
            <!-- Placeholders cuando no hay anuncios -->
            <div class="ad-sidebar-section">
                <h3 class="ad-sidebar-title">Publicidad</h3>
                <div class="ad-space-box">
                    <i class="fas fa-bullhorn"></i>
                    <span>Espacio publicitario</span>
                    <small>Contacta para anunciar</small>
                </div>
            </div>

            <div class="ad-sidebar-section">
                <h3 class="ad-sidebar-title">Promociones</h3>
                <div class="ad-space-box-small">
                    <i class="fas fa-ad"></i>
                    <span>Tu anuncio aqui</span>
                </div>
            </div>
        }
    </aside>

    <!-- MAIN FEED -->
    <div class="feed-main">
        <div class="feed-container">
            <!-- Banner de bienvenida para usuarios anÃ³nimos -->
            @if (!estaAutenticado)
            {
                <div class="welcome-banner">
                    <h2>Descubre lo que esta pasando</h2>
                    <p>Explora contenido de creadores increibles. Unete para interactuar y acceder a contenido exclusivo.</p>
                    <div class="btn-group">
                        <a href="@Url.Action("Register", "Account")" class="btn btn-light">Crear cuenta gratis</a>
                        <a href="@Url.Action("Login", "Account")" class="btn btn-outline">Ya tengo cuenta</a>
                    </div>
                </div>
            }

            <!-- POSTS -->
            @if (Model != null && Model.Any())
            {
                var postIndex = 0;
                var anuncioIndex = 0;
                var insertarAnuncioCada = 5; // Insertar anuncio cada 5 posts

                @foreach (var post in Model)
                {
                    var esPremium = contenidoPremiumIds.Contains(post.Id);
                    var usuario = post.Usuario;
                    // Para posts PUBLICOS (LadoA), SIEMPRE usar datos de LadoA
                    // Para posts PREMIUM (LadoB), usar datos de LadoB si existen
                    var fotoMostrar = esPremium
                        ? (usuario?.FotoPerfilLadoB ?? usuario?.FotoPerfil)
                        : usuario?.FotoPerfil;
                    var nombreMostrar = esPremium
                        ? (usuario?.Seudonimo ?? usuario?.NombreCompleto ?? "Usuario")
                        : (usuario?.NombreCompleto ?? "Usuario");
                    <article class="post">
                        <!-- Header -->
                        <div class="post-header">
                            <a href="@Url.Action("VerPerfil", "FeedPublico", new { id = usuario?.Id })" class="post-header-left">
                                @if (!string.IsNullOrEmpty(fotoMostrar))
                                {
                                    <img src="@Url.Content($"~{fotoMostrar}")" alt="@nombreMostrar" class="post-avatar">
                                }
                                else
                                {
                                    <div class="post-avatar-placeholder">
                                        @(nombreMostrar.Substring(0, 1).ToUpper())
                                    </div>
                                }
                                <div class="post-user-info">
                                    <span class="post-username">
                                        @nombreMostrar
                                        @if (usuario?.CreadorVerificado == true)
                                        {
                                            <svg style="width:14px;height:14px;color:var(--primary);margin-left:4px;" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                                            </svg>
                                        }
                                        @if (esPremium)
                                        {
                                            <span class="post-badge premium">Premium</span>
                                        }
                                    </span>
                                    <span class="post-time">@post.FechaPublicacion.ToString("dd MMM yyyy")</span>
                                </div>
                            </a>
                        </div>

                        <!-- Media -->
                        <div class="post-media @(esPremium ? "premium-blur" : "")">
                            @if (!string.IsNullOrEmpty(post.RutaArchivo))
                            {
                                @if (post.TipoContenido == TipoContenido.Video)
                                {
                                    <video src="@Url.Content($"~{post.RutaArchivo}")" @(esPremium ? "" : "controls")></video>
                                }
                                else
                                {
                                    <img src="@Url.Content($"~{post.RutaArchivo}")" alt="Contenido">
                                }
                            }
                            else if (!string.IsNullOrEmpty(post.Thumbnail))
                            {
                                <img src="@Url.Content($"~{post.Thumbnail}")" alt="Contenido">
                            }
                            else
                            {
                                <div class="post-media-placeholder">
                                    <svg style="width:48px;height:48px;" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                                    </svg>
                                </div>
                            }

                            @if (esPremium)
                            {
                                <div class="premium-overlay">
                                    <div class="lock-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                        </svg>
                                    </div>
                                    <h4>Contenido Premium</h4>
                                    <p>Suscribete para ver este contenido exclusivo</p>
                                    @if (estaAutenticado)
                                    {
                                        <a href="@Url.Action("Perfil", "Feed", new { id = usuario?.Id })" class="btn-subscribe">
                                            <svg style="width:16px;height:16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                                            </svg>
                                            Suscribirme
                                        </a>
                                    }
                                    else
                                    {
                                        <a href="@Url.Action("Register", "Account")" class="btn-subscribe">
                                            Crear cuenta para suscribirme
                                        </a>
                                    }
                                </div>
                            }
                        </div>

                        <!-- Content -->
                        @if (!esPremium && !string.IsNullOrEmpty(post.Descripcion))
                        {
                            <div class="post-content">
                                <p class="post-description">@post.Descripcion</p>
                            </div>
                        }

                        <!-- Actions -->
                        <div class="post-actions">
                            <button class="post-action-btn @(!estaAutenticado ? "disabled" : "")" onclick="@(!estaAutenticado ? "showLoginPrompt('dar like')" : "")">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                                <span>@post.NumeroLikes</span>
                            </button>

                            <button class="post-action-btn @(!estaAutenticado ? "disabled" : "")" onclick="@(!estaAutenticado ? "showLoginPrompt('comentar')" : "")">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span>@post.NumeroComentarios</span>
                            </button>

                            <button class="post-action-btn @(!estaAutenticado ? "disabled" : "")" onclick="@(!estaAutenticado ? "showLoginPrompt('guardar en favoritos')" : "")">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </button>

                            <button class="post-action-btn @(!estaAutenticado ? "disabled" : "")" onclick="@(!estaAutenticado ? "showLoginPrompt('compartir')" : "")">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="18" cy="5" r="3"></circle>
                                    <circle cx="6" cy="12" r="3"></circle>
                                    <circle cx="18" cy="19" r="3"></circle>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                </svg>
                            </button>

                            <div class="post-stats">
                                <span>@post.NumeroVistas vistas</span>
                            </div>
                        </div>
                    </article>

                    @* Insertar anuncio cada N posts *@
                    postIndex++;
                    if (postIndex % insertarAnuncioCada == 0 && anuncioIndex < anuncios.Count)
                    {
                        var anuncioFeed = anuncios[anuncioIndex];
                        anuncioIndex++;

                        <article class="post-ad">
                            <div class="post-ad-header">
                                <div class="post-ad-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                                    </svg>
                                </div>
                                <div class="post-ad-info">
                                    <div class="post-ad-label">Patrocinado</div>
                                    <div class="post-ad-badge">
                                        <i class="fas fa-ad"></i>
                                        <span>Publicidad</span>
                                    </div>
                                </div>
                            </div>
                            <a href="@Url.Action("RedirectAnuncio", "FeedPublico", new { id = anuncioFeed.Id })" target="_blank" class="post-ad-media">
                                @if (anuncioFeed.TipoCreativo == TipoCreativo.Video && !string.IsNullOrEmpty(anuncioFeed.UrlCreativo))
                                {
                                    <video src="@Url.Content($"~{anuncioFeed.UrlCreativo}")" muted autoplay loop playsinline></video>
                                }
                                else if (!string.IsNullOrEmpty(anuncioFeed.UrlCreativo))
                                {
                                    <img src="@Url.Content($"~{anuncioFeed.UrlCreativo}")" alt="Anuncio">
                                }
                            </a>
                            <div class="post-ad-content">
                                <a href="@Url.Action("RedirectAnuncio", "FeedPublico", new { id = anuncioFeed.Id })" target="_blank" class="post-ad-cta">
                                    @anuncioFeed.TextoBotonDisplay
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        </article>
                    }
                }
            }
            else
            {
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <path d="M21 15l-5-5L5 21"></path>
                    </svg>
                    <h3>No hay contenido disponible</h3>
                    <p>Se el primero en compartir algo increible</p>
                </div>
            }
        </div>
    </div>

    <!-- SIDEBAR -->
    <aside class="feed-sidebar">
        <!-- Sugerencias para ti (solo para usuarios autenticados) -->
        @if (estaAutenticado)
        {
            // Filtrar creadores sugeridos para excluir los que ya aparecen en creadores premium
            var creadoresPremiumIds = creadoresPremium.Select(c => c.Id).ToHashSet();
            var sugerenciasFiltradas = creadoresSugeridos.Where(c => !creadoresPremiumIds.Contains(c.Id)).ToList();

            if (sugerenciasFiltradas.Any())
            {
            <div class="sidebar-section">
                <h3 class="sidebar-title">Sugerencias para ti</h3>
                @foreach (var creador in sugerenciasFiltradas.Take(5))
                {
                    // Para sugerencias (LadoA), usar siempre datos de LadoA
                    var fotoSugerido = creador.FotoPerfil;
                    var nombreSugerido = creador.NombreCompleto ?? creador.NombrePublico;
                    <div class="suggested-user">
                        @if (!string.IsNullOrEmpty(fotoSugerido))
                        {
                            <img src="@Url.Content($"~{fotoSugerido}")" alt="@nombreSugerido" class="suggested-avatar">
                        }
                        else
                        {
                            <div class="suggested-avatar-placeholder">
                                @nombreSugerido?.Substring(0, 1).ToUpper()
                            </div>
                        }
                        <div class="suggested-info">
                            <div class="suggested-name">
                                @nombreSugerido
                                @if (creador.CreadorVerificado)
                                {
                                    <svg class="verified-badge" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                                    </svg>
                                }
                            </div>
                            <span class="suggested-meta">@creador.NumeroSeguidores seguidores</span>
                        </div>
                        @if (estaAutenticado)
                        {
                            <a href="@Url.Action("Perfil", "Feed", new { id = creador.Id })" class="btn-follow-sm">Seguir</a>
                        }
                        else
                        {
                            <a href="@Url.Action("VerPerfil", "FeedPublico", new { id = creador.Id })" class="btn-follow-sm">Ver</a>
                        }
                    </div>
                }
            </div>
            }
        }

        <!-- Creadores Premium -->
        @if (creadoresPremium.Any())
        {
            <div class="sidebar-section">
                <h3 class="sidebar-title">Creadores Premium</h3>
                @foreach (var creador in creadoresPremium.Take(4))
                {
                    // Para creadores premium usar foto de LadoB si existe, sino la normal
                    var fotoPremium = creador.FotoPerfilLadoB ?? creador.FotoPerfil;
                    var nombrePremium = creador.Seudonimo ?? creador.NombrePublico;
                    <div class="premium-creator">
                        <div class="premium-avatar">
                            @if (!string.IsNullOrEmpty(fotoPremium))
                            {
                                <img src="@Url.Content($"~{fotoPremium}")" alt="@nombrePremium" class="suggested-avatar">
                            }
                            else
                            {
                                <div class="suggested-avatar-placeholder">
                                    @nombrePremium?.Substring(0, 1).ToUpper()
                                </div>
                            }
                            <div class="premium-badge-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                        </div>
                        <div class="suggested-info">
                            <div class="suggested-name">
                                @nombrePremium
                            </div>
                            <span class="suggested-meta">Contenido exclusivo</span>
                        </div>
                        @if (estaAutenticado)
                        {
                            <a href="@Url.Action("Perfil", "Feed", new { id = creador.Id })" class="btn-follow-sm">Suscribir</a>
                        }
                        else
                        {
                            <a href="@Url.Action("VerPerfil", "FeedPublico", new { id = creador.Id })" class="btn-follow-sm">Ver</a>
                        }
                    </div>
                }
            </div>
        }

        <!-- CTA para registro -->
        @if (!estaAutenticado)
        {
            <div class="cta-sidebar">
                <h4>Unete a LADO</h4>
                <p>Crea tu cuenta para seguir creadores, dar likes y acceder a contenido exclusivo</p>
                <a href="@Url.Action("Register", "Account")" class="btn">Crear cuenta gratis</a>
            </div>
        }
    </aside>
</div>

<!-- Modal de Login Prompt -->
<div class="login-prompt-modal" id="loginPromptModal">
    <div class="login-prompt-content">
        <div class="icon-wrapper">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        </div>
        <h3>Inicia sesion para continuar</h3>
        <p id="loginPromptMessage">Para realizar esta accion necesitas una cuenta</p>
        <div class="login-prompt-buttons">
            <a href="@Url.Action("Register", "Account")" class="btn-primary">Crear cuenta gratis</a>
            <a href="@Url.Action("Login", "Account")" class="btn-primary" style="background: transparent; color: var(--primary); border: 2px solid var(--primary);">Ya tengo cuenta</a>
            <button type="button" class="btn-secondary" onclick="hideLoginPrompt()">Cancelar</button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showLoginPrompt(action) {
            const modal = document.getElementById('loginPromptModal');
            const message = document.getElementById('loginPromptMessage');
            message.textContent = `Para ${action} necesitas una cuenta en LADO`;
            modal.classList.add('show');
        }

        function hideLoginPrompt() {
            const modal = document.getElementById('loginPromptModal');
            modal.classList.remove('show');
        }

        // Cerrar modal al hacer click fuera
        document.getElementById('loginPromptModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideLoginPrompt();
            }
        });

        // Cerrar con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideLoginPrompt();
            }
        });
    </script>
}
