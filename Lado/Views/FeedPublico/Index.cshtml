@model IEnumerable<Lado.Models.Contenido>
@using Lado.Models
@{
    ViewData["Title"] = "LADO - Descubre";
    Layout = "~/Views/Shared/_LayoutPublico.cshtml";
    var contenidoLista = Model?.ToList() ?? new List<Contenido>();
    var estaAutenticado = ViewBag.EstaAutenticado as bool? ?? false;
}

<style>
    /* ========================================
       RESET Y BASE
       ======================================== */
    .mosaic-page {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        background: #000;
        z-index: 1;
    }

    /* ========================================
       MOSAICO DE IMAGENES
       ======================================== */
    .mosaic-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: grid;
        gap: 4px;
        animation: mosaicFloat 20s ease-in-out infinite;
    }

    @@keyframes mosaicFloat {
        0%, 100% { transform: translate(-50%, -50%) scale(1); }
        50% { transform: translate(-50%, -51%) scale(1.02); }
    }

    .mosaic-item {
        position: relative;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        border-radius: 4px;
    }

    .mosaic-item::before {
        content: '';
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.2);
        z-index: 1;
        transition: background 0.3s ease;
    }

    .mosaic-item:hover {
        transform: scale(1.15);
        z-index: 100;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
    }

    .mosaic-item:hover::before {
        background: rgba(0, 0, 0, 0);
    }

    .mosaic-item img,
    .mosaic-item video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.4s ease, opacity 0.5s ease;
    }

    /* Estado inicial: oculto hasta que cargue */
    .mosaic-item img:not(.loaded),
    .mosaic-item video:not(.loaded) {
        opacity: 0;
    }

    .mosaic-item img.loaded,
    .mosaic-item video.loaded {
        opacity: 1;
    }

    /* Skeleton/placeholder mientras carga */
    .mosaic-item {
        background: linear-gradient(
            110deg,
            #1a1a1a 8%,
            #2a2a2a 18%,
            #1a1a1a 33%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s linear infinite;
    }

    .mosaic-item.media-loaded {
        background: none;
        animation: none;
    }

    @@keyframes shimmer {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    .mosaic-item:hover img,
    .mosaic-item:hover video {
        transform: scale(1.1);
    }

    /* ========================================
       OVERLAY OSCURO CON GRADIENTE
       ======================================== */
    .mosaic-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 10;
    }

    .mosaic-overlay::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 40%;
        background: linear-gradient(to bottom,
            rgba(0, 0, 0, 1) 0%,
            rgba(0, 0, 0, 0.9) 20%,
            rgba(0, 0, 0, 0.6) 50%,
            rgba(0, 0, 0, 0) 100%
        );
    }

    .mosaic-overlay::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 45%;
        background: linear-gradient(to top,
            rgba(0, 0, 0, 1) 0%,
            rgba(0, 0, 0, 0.95) 25%,
            rgba(0, 0, 0, 0.7) 50%,
            rgba(0, 0, 0, 0) 100%
        );
    }

    /* Gradientes laterales */
    .mosaic-overlay-left,
    .mosaic-overlay-right {
        position: fixed;
        top: 0;
        bottom: 0;
        width: 15%;
        pointer-events: none;
        z-index: 10;
    }

    .mosaic-overlay-left {
        left: 0;
        background: linear-gradient(to right, rgba(0, 0, 0, 0.8), transparent);
    }

    .mosaic-overlay-right {
        right: 0;
        background: linear-gradient(to left, rgba(0, 0, 0, 0.8), transparent);
    }

    /* ========================================
       CONTENIDO CENTRAL (LOGO Y CTA)
       ======================================== */
    .mosaic-content {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
        text-align: center;
        pointer-events: none;
    }

    .mosaic-logo {
        font-size: 5rem;
        font-weight: 900;
        color: #fff;
        letter-spacing: -3px;
        margin-bottom: 16px;
        text-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        animation: logoGlow 3s ease-in-out infinite alternate;
    }

    @@keyframes logoGlow {
        from { text-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); }
        to { text-shadow: 0 4px 60px rgba(70, 130, 180, 0.3), 0 0 100px rgba(70, 130, 180, 0.1); }
    }

    .mosaic-tagline {
        font-size: 1.4rem;
        color: rgba(255, 255, 255, 0.85);
        margin-bottom: 40px;
        font-weight: 400;
        letter-spacing: 2px;
        text-transform: uppercase;
    }

    .mosaic-buttons {
        display: flex;
        gap: 16px;
        justify-content: center;
        pointer-events: auto;
    }

    .mosaic-btn {
        padding: 16px 40px;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }

    .mosaic-btn-primary {
        background: linear-gradient(135deg, #4682B4 0%, #2c5f8a 100%);
        color: #fff;
        box-shadow: 0 8px 30px rgba(70, 130, 180, 0.4);
    }

    .mosaic-btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 40px rgba(70, 130, 180, 0.6);
    }

    .mosaic-btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
    }

    .mosaic-btn-secondary:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-3px);
    }

    .mosaic-btn svg {
        width: 20px;
        height: 20px;
    }

    /* ========================================
       DEGRADADO INFERIOR ADICIONAL
       ======================================== */
    .mosaic-bottom-fade {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 120px;
        background: linear-gradient(to top, #000 0%, transparent 100%);
        pointer-events: none;
        z-index: 9;
        opacity: 0.8;
    }

    /* ========================================
       BADGE DE VIDEO
       ======================================== */
    .video-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.6);
        border-radius: 4px;
        padding: 4px 6px;
        z-index: 5;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .video-badge svg {
        width: 12px;
        height: 12px;
        fill: #fff;
    }

    /* ========================================
       RESPONSIVE - TABLETS
       ======================================== */
    @@media (max-width: 1024px) {
        .mosaic-logo {
            font-size: 4rem;
        }

        .mosaic-tagline {
            font-size: 1.2rem;
        }
    }

    /* ========================================
       RESPONSIVE - MOVILES
       ======================================== */
    @@media (max-width: 768px) {
        .mosaic-logo {
            font-size: 3.5rem;
            letter-spacing: -2px;
        }

        .mosaic-tagline {
            font-size: 0.95rem;
            padding: 0 20px;
            letter-spacing: 1px;
            margin-bottom: 30px;
        }

        .mosaic-buttons {
            flex-direction: column;
            padding: 0 30px;
            gap: 12px;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            align-items: center;
        }

        .mosaic-btn {
            padding: 14px 24px;
            font-size: 14px;
            justify-content: center;
            width: 100%;
            text-align: center;
        }

        .mosaic-content {
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Ajustar overlays para moviles */
        .mosaic-overlay::before {
            height: 35%;
        }

        .mosaic-overlay::after {
            height: 40%;
        }

        .mosaic-overlay-left,
        .mosaic-overlay-right {
            width: 10%;
        }

        /* Items mas pequenos en movil */
        .mosaic-item {
            border-radius: 3px;
        }

        .video-badge {
            top: 4px;
            right: 4px;
            padding: 2px 4px;
        }

        .video-badge svg {
            width: 10px;
            height: 10px;
        }
    }

    /* ========================================
       RESPONSIVE - MOVILES PEQUENOS
       ======================================== */
    @@media (max-width: 480px) {
        .mosaic-logo {
            font-size: 2.8rem;
        }

        .mosaic-tagline {
            font-size: 0.85rem;
            margin-bottom: 24px;
        }

        .mosaic-buttons {
            padding: 0 24px;
            max-width: 280px;
            margin: 0 auto;
            align-items: center;
        }

        .mosaic-btn {
            padding: 12px 20px;
            font-size: 13px;
            text-align: center;
        }

        .mosaic-btn svg {
            width: 18px;
            height: 18px;
        }

        .mosaic-content {
            width: 95%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

    }

    /* ========================================
       SOPORTE TACTIL (iOS/Android)
       ======================================== */
    @@media (hover: none) and (pointer: coarse) {
        /* En dispositivos tactiles, no usar hover para agrandar */
        .mosaic-item:hover {
            transform: none;
            z-index: auto;
            box-shadow: none;
        }

        .mosaic-item:hover::before {
            background: rgba(0, 0, 0, 0.2);
        }

        .mosaic-item:hover img,
        .mosaic-item:hover video {
            transform: none;
        }

        /* Efecto de tap en lugar de hover */
        .mosaic-item:active {
            transform: scale(0.95);
            opacity: 0.9;
        }

        /* Botones mas grandes para tocar */
        .mosaic-btn {
            min-height: 48px;
            -webkit-tap-highlight-color: transparent;
        }

        /* Desactivar parallax en moviles */
        .mosaic-container {
            animation: none !important;
        }
    }

    /* ========================================
       iOS SAFE AREAS
       ======================================== */
    @@supports (padding-top: env(safe-area-inset-top)) {
        .mosaic-page {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

    }

    /* ========================================
       LANDSCAPE EN MOVILES
       ======================================== */
    @@media (max-height: 500px) and (orientation: landscape) {
        .mosaic-logo {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }

        .mosaic-tagline {
            font-size: 0.8rem;
            margin-bottom: 16px;
        }

        .mosaic-buttons {
            flex-direction: row;
            gap: 10px;
        }

        .mosaic-btn {
            padding: 10px 20px;
            font-size: 12px;
        }
    }

    /* Ocultar todo el header, navbar y footer en esta pagina */
    .navbar, footer, .mobile-nav, header, .header,
    .top-bar, .site-header, nav, .nav-container,
    .navbar-brand, .public-header {
        display: none !important;
        height: 0 !important;
        min-height: 0 !important;
        max-height: 0 !important;
        overflow: hidden !important;
    }

    body {
        overflow: hidden !important;
        padding-top: 0 !important;
        margin-top: 0 !important;
    }

    html {
        padding-top: 0 !important;
    }

    main, .main-content, #main-content, .public-main {
        padding-top: 0 !important;
        margin-top: 0 !important;
        min-height: 100vh !important;
    }
</style>

<div class="mosaic-page">
    <!-- Mosaico de imagenes -->
    <div class="mosaic-container" id="mosaicGrid">
        @{
            // Crear un grid de imagenes aleatorias
            var random = new Random();
            var contenidoAleatorio = contenidoLista
                .Where(c => !string.IsNullOrEmpty(c.RutaArchivo))
                .OrderBy(x => random.Next())
                .ToList();

            // Necesitamos suficientes items para llenar toda la pantalla
            // Para pantalla 1920x1080 con items de 100px = ~20 cols x 12 rows = 240 items
            var itemsNecesarios = 250;
            while (contenidoAleatorio.Count < itemsNecesarios && contenidoLista.Any())
            {
                contenidoAleatorio.AddRange(contenidoLista
                    .Where(c => !string.IsNullOrEmpty(c.RutaArchivo))
                    .OrderBy(x => random.Next()));
            }

            var itemsParaMostrar = contenidoAleatorio.Take(itemsNecesarios).ToList();
        }

        @foreach (var item in itemsParaMostrar)
        {
            var esVideo = item.TipoContenido == TipoContenido.Video;
            // Usar thumbnail si existe para carga más rápida
            var imagenSrc = !string.IsNullOrEmpty(item.Thumbnail) ? item.Thumbnail : item.RutaArchivo;
            <div class="mosaic-item" data-tipo="@(esVideo ? "video" : "image")" onclick="window.location.href='@Url.Action("Login", "Account")'">
                @if (esVideo)
                {
                    <video data-src="@item.RutaArchivo" muted loop playsinline preload="none" poster="@(item.Thumbnail ?? "")"></video>
                    <div class="video-badge">
                        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </div>
                }
                else
                {
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E"
                         data-src="@imagenSrc"
                         alt=""
                         loading="lazy"
                         decoding="async">
                }
            </div>
        }
    </div>

    <!-- Overlays oscuros -->
    <div class="mosaic-overlay"></div>
    <div class="mosaic-overlay-left"></div>
    <div class="mosaic-overlay-right"></div>

    <!-- Contenido central -->
    <div class="mosaic-content">
        <div class="mosaic-logo">LADO</div>
        <div class="mosaic-tagline">Descubre contenido exclusivo</div>

        @if (!estaAutenticado)
        {
            <div class="mosaic-buttons">
                <a href="@Url.Action("Register", "Account")" class="mosaic-btn mosaic-btn-primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <line x1="20" y1="8" x2="20" y2="14"></line>
                        <line x1="23" y1="11" x2="17" y2="11"></line>
                    </svg>
                    Crear cuenta gratis
                </a>
                <a href="@Url.Action("Login", "Account")" class="mosaic-btn mosaic-btn-secondary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                        <polyline points="10 17 15 12 10 7"></polyline>
                        <line x1="15" y1="12" x2="3" y2="12"></line>
                    </svg>
                    Iniciar sesion
                </a>
            </div>
        }
        else
        {
            <div class="mosaic-buttons">
                <a href="@Url.Action("Index", "Feed")" class="mosaic-btn mosaic-btn-primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="9" y1="3" x2="9" y2="21"></line>
                    </svg>
                    Ir al Feed
                </a>
            </div>
        }
    </div>

</div>

@section Scripts {
    <script>
        (function() {
            const grid = document.getElementById('mosaicGrid');
            if (!grid) return;

            const items = grid.querySelectorAll('.mosaic-item');

            // Detectar si es dispositivo tactil
            const isTouchDevice = ('ontouchstart' in window) ||
                (navigator.maxTouchPoints > 0) ||
                (navigator.msMaxTouchPoints > 0);

            // Detectar iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

            // ========================================
            // SISTEMA DE CARGA OPTIMIZADO CON INTERSECTION OBSERVER
            // ========================================

            // Imagen de fallback en caso de error (gradiente sutil)
            const fallbackSrc = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%231a1a2e'/%3E%3Cstop offset='100%25' style='stop-color:%232d2d44'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='100' height='100'/%3E%3C/svg%3E";

            // Tracking de items cargados
            const loadedItems = new Set();
            let observerActive = true;

            // Función para cargar una imagen
            function loadMedia(item) {
                if (loadedItems.has(item)) return;

                const img = item.querySelector('img');
                const video = item.querySelector('video');

                if (img && img.hasAttribute('data-src')) {
                    const src = img.getAttribute('data-src');

                    // Marcar como en proceso
                    loadedItems.add(item);

                    // Cargar imagen
                    img.onload = function() {
                        img.classList.add('loaded');
                        item.classList.add('media-loaded');
                        img.removeAttribute('data-src');
                    };

                    img.onerror = function() {
                        // Usar fallback en lugar de ocultar
                        img.src = fallbackSrc;
                        img.classList.add('loaded');
                        item.classList.add('media-loaded');
                        img.removeAttribute('data-src');
                    };

                    img.src = src;
                }

                if (video && video.hasAttribute('data-src')) {
                    const src = video.getAttribute('data-src');

                    loadedItems.add(item);

                    video.onloadeddata = function() {
                        video.classList.add('loaded');
                        item.classList.add('media-loaded');
                    };

                    video.onerror = function() {
                        item.classList.add('media-loaded');
                        // Ocultar el badge de video si falla
                        const badge = item.querySelector('.video-badge');
                        if (badge) badge.style.display = 'none';
                    };

                    video.src = src;
                    video.removeAttribute('data-src');
                }
            }

            // Crear Intersection Observer con margen más amplio
            const observerOptions = {
                root: null,
                rootMargin: '500px', // Pre-cargar 500px antes de entrar en viewport
                threshold: 0
            };

            const imageObserver = new IntersectionObserver((entries) => {
                if (!observerActive) return;

                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        loadMedia(entry.target);
                        imageObserver.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            // Observar todos los items
            items.forEach(item => {
                imageObserver.observe(item);
            });

            // Cargar items visibles inmediatamente (los del centro)
            function loadVisibleItems() {
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                const centerX = viewportWidth / 2;
                const centerY = viewportHeight / 2;

                // Ordenar por distancia al centro
                const sortedItems = Array.from(items).map(item => {
                    const rect = item.getBoundingClientRect();
                    const itemCenterX = rect.left + rect.width / 2;
                    const itemCenterY = rect.top + rect.height / 2;
                    const distance = Math.sqrt(
                        Math.pow(itemCenterX - centerX, 2) +
                        Math.pow(itemCenterY - centerY, 2)
                    );
                    return { item, distance, visible: item.style.display !== 'none' };
                })
                .filter(i => i.visible)
                .sort((a, b) => a.distance - b.distance);

                // Cargar primero los 20 más cercanos al centro
                const priorityItems = sortedItems.slice(0, 20);

                priorityItems.forEach(({ item }, index) => {
                    setTimeout(() => loadMedia(item), index * 20);
                });
            }

            // Cargar todos los items restantes después de un delay
            function loadRemainingItems() {
                let delay = 0;
                items.forEach(item => {
                    if (!loadedItems.has(item)) {
                        // Cargar todos los items, incluso los ocultos (por si se muestran después)
                        setTimeout(() => loadMedia(item), delay);
                        delay += 15; // Reducido de 30 a 15ms para carga más rápida
                    }
                });
            }

            // Forzar carga de TODOS los items después de 3 segundos
            function forceLoadAll() {
                items.forEach(item => {
                    if (!loadedItems.has(item)) {
                        loadMedia(item);
                    }
                });
            }

            // Iniciar carga
            function initLoading() {
                requestAnimationFrame(() => {
                    // Primero cargar items visibles/cercanos al centro
                    loadVisibleItems();

                    // Después de 500ms, cargar el resto progresivamente
                    setTimeout(loadRemainingItems, 500);

                    // Forzar carga de todos los items restantes después de 3 segundos
                    setTimeout(forceLoadAll, 3000);
                });
            }

            // Ejecutar cuando el DOM esté listo
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                setTimeout(initLoading, 50);
            } else {
                document.addEventListener('DOMContentLoaded', initLoading);
            }

            function setupGrid() {
                const vw = window.innerWidth;
                const vh = window.innerHeight;

                let cols, itemSize, gap;

                // Determinar tamano de items y columnas segun ancho
                if (vw > 1600) {
                    itemSize = 110; gap = 4;
                } else if (vw > 1400) {
                    itemSize = 100; gap = 4;
                } else if (vw > 1200) {
                    itemSize = 95; gap = 4;
                } else if (vw > 1024) {
                    itemSize = 90; gap = 3;
                } else if (vw > 768) {
                    itemSize = 80; gap = 3;
                } else if (vw > 480) {
                    itemSize = 65; gap = 2;
                } else {
                    itemSize = 55; gap = 2;
                }

                // Calcular columnas y filas para LLENAR toda la pantalla + extra
                cols = Math.ceil(vw / (itemSize + gap)) + 2;
                let rows = Math.ceil(vh / (itemSize + gap)) + 2;

                // Asegurar minimo de filas para que el mosaico cubra todo
                rows = Math.max(rows, 10);

                grid.style.gridTemplateColumns = `repeat(${cols}, ${itemSize}px)`;
                grid.style.gridTemplateRows = `repeat(${rows}, ${itemSize}px)`;
                grid.style.gap = `${gap}px`;

                const maxItems = cols * rows;
                items.forEach((item, index) => {
                    const shouldShow = index < maxItems;
                    item.style.display = shouldShow ? 'block' : 'none';

                    // Cargar items que ahora son visibles pero no estaban cargados
                    if (shouldShow && !loadedItems.has(item)) {
                        loadMedia(item);
                    }
                });
            }

            setupGrid();

            // Debounce para resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(setupGrid, 100);
            });
            window.addEventListener('orientationchange', () => {
                setTimeout(setupGrid, 100);
            });

            // Manejo de videos - solo después de que se carguen
            if (!isTouchDevice) {
                // Desktop: hover para reproducir (solo si el video ya cargó)
                items.forEach(item => {
                    const video = item.querySelector('video');
                    if (video) {
                        item.addEventListener('mouseenter', () => {
                            // Solo reproducir si ya tiene src y está cargado
                            if (video.src && video.readyState >= 2) {
                                video.play().catch(() => {});
                            }
                        });
                        item.addEventListener('mouseleave', () => {
                            video.pause();
                            video.currentTime = 0;
                        });
                    }
                });
            } else {
                // Movil: reproducir algunos videos después de cargarlos
                setTimeout(() => {
                    const videos = Array.from(grid.querySelectorAll('video'))
                        .filter(v => v.src && v.readyState >= 2);
                    const videosToPlay = videos.slice(0, Math.min(2, videos.length));

                    videosToPlay.forEach(video => {
                        video.muted = true;
                        video.playsInline = true;
                        video.setAttribute('playsinline', '');
                        video.setAttribute('webkit-playsinline', '');
                        video.play().catch(() => {});
                    });
                }, 2000); // Esperar a que carguen
            }

            // Animar stats
            function animateValue(id, start, end, duration) {
                const obj = document.getElementById(id);
                if (!obj) return;

                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    const current = Math.floor(easeOut * (end - start) + start);

                    if (current >= 1000) {
                        obj.textContent = (current / 1000).toFixed(1) + 'K';
                    } else {
                        obj.textContent = current;
                    }

                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }

            setTimeout(() => {
                animateValue('statCreadores', 0, @(ViewBag.TotalCreadores ?? 50), 2000);
                animateValue('statContenido', 0, @(ViewBag.TotalContenido ?? 500), 2000);
                animateValue('statComunidad', 0, @(ViewBag.TotalUsuarios ?? 1000), 2000);
            }, 500);

            // Parallax solo en desktop
            if (!isTouchDevice) {
                document.addEventListener('mousemove', (e) => {
                    const x = (e.clientX / window.innerWidth - 0.5) * 10;
                    const y = (e.clientY / window.innerHeight - 0.5) * 10;
                    grid.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                });
            }

            // Prevenir scroll en iOS
            if (isIOS) {
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
                document.body.style.height = '100%';
            }

            // Prevenir zoom en doble tap (iOS)
            let lastTouchEnd = 0;
            document.addEventListener('touchend', (e) => {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        })();
    </script>
}
