@model List<Lado.Models.Transaccion>
@{
    ViewData["Title"] = "Historial Completo";
}

<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2>
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#0d6efd" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Historial Completo
                    </h2>
                    <p class="text-muted mb-0">Todas tus transacciones</p>
                </div>
                <a href="/FanBilletera/Index" class="btn btn-outline-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    Volver
                </a>
            </div>
        </div>
    </div>

    <!-- Resumen -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <h6 class="text-muted mb-2">Saldo Actual</h6>
                    <h3 class="mb-0 text-primary">$@(ViewBag.SaldoActual.ToString("N2"))</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <h6 class="text-muted mb-2">Total Transacciones</h6>
                    <h3 class="mb-0">@Model.Count</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <h6 class="text-muted mb-2">Total Movimientos</h6>
                    <h3 class="mb-0 text-success">$@Model.Sum(t => t.Monto).ToString("N2")</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de Transacciones -->
    <div class="card shadow-sm">
        <div class="card-header bg-white">
            <h5 class="mb-0">Todas las Transacciones</h5>
        </div>
        <div class="card-body p-0">
            @if (Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Fecha y Hora</th>
                                <th>Tipo</th>
                                <th>Descripción</th>
                                <th class="text-end">Monto</th>
                                <th>Método</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var transaccion in Model)
                            {
                                var esRecarga = transaccion.TipoTransaccion == Lado.Models.TipoTransaccion.Recarga;
                                var esBonificacion = transaccion.TipoTransaccion == Lado.Models.TipoTransaccion.Bonificacion;
                                var colorMonto = (esRecarga || esBonificacion) ? "text-success" : "text-danger";
                                var signoMonto = (esRecarga || esBonificacion) ? "+" : "-";
                                var iconoTipo = transaccion.TipoTransaccion switch
                                {
                                    Lado.Models.TipoTransaccion.Recarga => "💰",
                                    Lado.Models.TipoTransaccion.Suscripcion => "⭐",
                                    Lado.Models.TipoTransaccion.Tip => "💝",
                                    Lado.Models.TipoTransaccion.Reembolso => "🔄",
                                    Lado.Models.TipoTransaccion.Bonificacion => "🎁",
                                    _ => "📄"
                                };

                                <tr>
                                    <td><small class="text-muted">#@transaccion.Id</small></td>
                                    <td>
                                        <div>@transaccion.FechaTransaccion.ToString("dd/MM/yyyy")</div>
                                        <small class="text-muted">@transaccion.FechaTransaccion.ToString("HH:mm:ss")</small>
                                    </td>
                                    <td>
                                        <span class="badge
                                            @(transaccion.TipoTransaccion == Lado.Models.TipoTransaccion.Recarga ? "bg-success" :
                                              transaccion.TipoTransaccion == Lado.Models.TipoTransaccion.Suscripcion ? "bg-primary" :
                                              transaccion.TipoTransaccion == Lado.Models.TipoTransaccion.Tip ? "bg-info" :
                                              transaccion.TipoTransaccion == Lado.Models.TipoTransaccion.Reembolso ? "bg-warning" :
                                              "bg-secondary")">
                                            @iconoTipo @transaccion.TipoTransaccion.ToString()
                                        </span>
                                    </td>
                                    <td>
                                        <div>@transaccion.Descripcion</div>
                                        @if (!string.IsNullOrEmpty(transaccion.Notas))
                                        {
                                            <small class="text-muted">@transaccion.Notas</small>
                                        }
                                    </td>
                                    <td class="text-end fw-bold @colorMonto">
                                        @signoMonto$@transaccion.Monto.ToString("N2")
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(transaccion.MetodoPago))
                                        {
                                            <small class="text-muted">@transaccion.MetodoPago</small>
                                        }
                                        else
                                        {
                                            <small class="text-muted">-</small>
                                        }
                                    </td>
                                    <td>
                                        <span class="badge
                                            @(transaccion.EstadoPago == "Completado" ? "bg-success" :
                                              transaccion.EstadoPago == "Pendiente" ? "bg-warning" :
                                              transaccion.EstadoPago == "Fallido" ? "bg-danger" :
                                              "bg-secondary")">
                                            @transaccion.EstadoPago
                                        </span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-3">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    <h5>No hay transacciones</h5>
                    <p class="text-muted">Comienza cargando saldo en tu billetera</p>
                    <a href="/FanBilletera/Index" class="btn btn-primary">
                        Cargar Saldo
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .table th {
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .table tbody tr {
        transition: background-color 0.2s;
    }

        .table tbody tr:hover {
            background-color: rgba(13, 110, 253, 0.05);
        }
</style>