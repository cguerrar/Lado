@model IEnumerable<Lado.Models.ApplicationUser>
@{
    ViewData["Title"] = "Explorar Creadores";
    var suscripcionesIds = ViewBag.SuscripcionesIds as List<string> ?? new List<string>();
}

<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="fw-bold mb-2">Explorar Creadores</h2>
            <p class="text-muted">Descubre contenido exclusivo de creadores increíbles</p>
        </div>
    </div>

    <!-- Búsqueda y Filtros -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form asp-action="Index" method="get">
                        <div class="row g-3">
                            <div class="col-lg-8">
                                <div class="input-group">
                                    <span class="input-group-text bg-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="11" cy="11" r="8"></circle>
                                            <path d="m21 21-4.35-4.35"></path>
                                        </svg>
                                    </span>
                                    <input type="text" name="buscar" class="form-control border-start-0"
                                           placeholder="Buscar creadores por nombre, usuario o biografía..."
                                           value="@ViewBag.BuscarTexto">
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-6">
                                <select name="categoria" class="form-select">
                                    <option value="todos">Todas las categorías</option>
                                    <option value="fitness">Fitness</option>
                                    <option value="gaming">Gaming</option>
                                    <option value="musica">Música</option>
                                    <option value="arte">Arte</option>
                                    <option value="cocina">Cocina</option>
                                </select>
                            </div>
                            <div class="col-lg-2 col-md-6">
                                <button type="submit" class="btn btn-primary w-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                    Buscar
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Creadores -->
    @if (Model.Any())
    {
        <div class="row g-4">
            @foreach (var creador in Model)
            {
                var estaSuscrito = suscripcionesIds.Contains(creador.Id);

                <div class="col-sm-6 col-lg-4 col-xl-3">
                    <div class="card creador-card h-100 shadow-sm">
                        <!-- Cover/Banner -->
                        <div class="card-cover position-relative">
                            @if (!string.IsNullOrEmpty(creador.FotoPortada))
                            {
                                <img src="@creador.FotoPortada" alt="Portada" class="w-100 h-100 object-fit-cover">
                            }
                            else
                            {
                                <div class="cover-gradient"></div>
                            }

                            <!-- Badge Suscrito -->
                            @if (estaSuscrito)
                            {
                                <span class="badge bg-success position-absolute top-0 end-0 m-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    Suscrito
                                </span>
                            }
                        </div>

                        <div class="card-body text-center pt-0">
                            <!-- Avatar -->
                            <div class="avatar-container">
                                @if (!string.IsNullOrEmpty(creador.FotoPerfil))
                                {
                                    <img src="@creador.FotoPerfil" class="avatar" alt="@creador.UserName">
                                }
                                else
                                {
                                    <div class="avatar avatar-placeholder">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                    </div>
                                }
                            </div>

                            <!-- Info -->
                            <h5 class="mb-1 mt-2">@creador.NombreCompleto</h5>
                            <p class="text-muted small mb-2">@@@creador.UserName</p>

                            @if (!string.IsNullOrEmpty(creador.Biografia))
                            {
                                <p class="text-muted small mb-3" style="min-height: 40px;">
                                    @(creador.Biografia.Length > 60 ? creador.Biografia.Substring(0, 60) + "..." : creador.Biografia)
                                </p>
                            }
                            else
                            {
                                <p class="text-muted small fst-italic mb-3" style="min-height: 40px;">
                                    Sin biografía
                                </p>
                            }

                            <!-- Stats -->
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <div class="stat-box">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-1">
                                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="9" cy="7" r="4"></circle>
                                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                        </svg>
                                        <div class="fw-bold">@creador.NumeroSeguidores</div>
                                        <small class="text-muted">Seguidores</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="stat-box">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-1">
                                            <line x1="12" y1="1" x2="12" y2="23"></line>
                                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                        </svg>
                                        <div class="fw-bold text-success">$@creador.PrecioSuscripcion.ToString("N2")</div>
                                        <small class="text-muted">/mes</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Botones -->
                            <div class="d-grid gap-2">
                                <a href="/Explorar/Perfil/@creador.Id" class="btn btn-outline-primary btn-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Ver Perfil
                                </a>

                                @if (estaSuscrito)
                                {
                                    <button class="btn btn-outline-danger btn-sm" onclick="cancelarSuscripcion('@creador.Id')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                        Cancelar
                                    </button>
                                }
                                else
                                {
                                    <button class="btn btn-primary btn-sm" onclick="suscribirse('@creador.Id', @creador.PrecioSuscripcion)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                        </svg>
                                        Suscribirse
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="card shadow-sm">
            <div class="card-body text-center py-5">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-muted mb-3">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <h4 class="text-muted">No se encontraron creadores</h4>
                <p class="text-muted mb-0">Intenta con otros términos de búsqueda</p>
            </div>
        </div>
    }
</div>

<style>
    .creador-card {
        transition: all 0.3s ease;
        overflow: hidden;
        border-radius: 15px;
    }

        .creador-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15) !important;
        }

    .card-cover {
        height: 120px;
        overflow: hidden;
    }

        .card-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .cover-gradient {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .avatar-container {
        margin-top: -40px;
        position: relative;
        z-index: 10;
    }

    .avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 4px solid white;
        object-fit: cover;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .avatar-placeholder {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .stat-box {
        background: #f8f9fa;
        padding: 12px 8px;
        border-radius: 10px;
        transition: all 0.3s;
    }

        .stat-box:hover {
            background: #e9ecef;
            transform: scale(1.05);
        }

        .stat-box svg {
            color: var(--bs-primary);
        }

    /* Responsivo */
    @@media (max-width: 576px) {
        .card-cover

    {
        height: 100px;
    }

    .avatar {
        width: 70px;
        height: 70px;
    }

    .avatar-container {
        margin-top: -35px;
    }

    .stat-box {
        padding: 10px 6px;
    }

    }
</style>

@section Scripts {
    <script>
        async function suscribirse(creadorId, precio) {
            if (!confirm(`¿Confirmas que quieres suscribirte por $${precio.toFixed(2)} al mes?`)) {
                return;
            }

            try {
                const response = await fetch('/Explorar/Suscribirse', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ creadorId: creadorId })
                });

                const data = await response.json();

                if (data.success) {
                    alert(data.message || '¡Suscripción exitosa!');
                    location.reload();
                } else {
                    alert(data.message || 'Error al procesar la suscripción');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al procesar la suscripción');
            }
        }

        async function cancelarSuscripcion(creadorId) {
            if (!confirm('¿Seguro que quieres cancelar tu suscripción?')) {
                return;
            }

            try {
                const response = await fetch('/Explorar/Cancelar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ creadorId: creadorId })
                });

                const data = await response.json();

                if (data.success) {
                    alert(data.message || 'Suscripción cancelada');
                    location.reload();
                } else {
                    alert(data.message || 'Error al cancelar');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cancelar la suscripción');
            }
        }
    </script>
}