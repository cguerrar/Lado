@{
    ViewData["Title"] = "Exportaciones";
    Layout = "_AdminLayout";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0"><i class="bi bi-download me-2"></i>Exportaciones</h2>
    </div>

    <div class="row g-4">
        <!-- Usuarios -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-people me-2"></i>Exportar Usuarios</h5>
                </div>
                <div class="card-body">
                    <form id="formUsuarios">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Desde</label>
                                <input type="date" name="desde" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Hasta</label>
                                <input type="date" name="hasta" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="soloCreadores" id="soloCreadores">
                                    <label class="form-check-label" for="soloCreadores">Solo creadores</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="soloVerificados" id="soloVerificados">
                                    <label class="form-check-label" for="soloVerificados">Solo verificados</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-white">
                    <button class="btn btn-primary" onclick="exportar('Usuarios', 'formUsuarios')">
                        <i class="bi bi-download me-1"></i>Descargar CSV
                    </button>
                </div>
            </div>
        </div>

        <!-- Contenidos -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-images me-2"></i>Exportar Contenidos</h5>
                </div>
                <div class="card-body">
                    <form id="formContenidos">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Desde</label>
                                <input type="date" name="desde" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Hasta</label>
                                <input type="date" name="hasta" class="form-control">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Tipo</label>
                                <select name="tipo" class="form-select">
                                    <option value="">Todos</option>
                                    <option value="0">Imagen</option>
                                    <option value="1">Video</option>
                                    <option value="2">Galería</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-white">
                    <button class="btn btn-info" onclick="exportar('Contenidos', 'formContenidos')">
                        <i class="bi bi-download me-1"></i>Descargar CSV
                    </button>
                </div>
            </div>
        </div>

        <!-- Transacciones -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-cash-stack me-2"></i>Exportar Transacciones</h5>
                </div>
                <div class="card-body">
                    <form id="formTransacciones">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Desde</label>
                                <input type="date" name="desde" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Hasta</label>
                                <input type="date" name="hasta" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tipo</label>
                                <select name="tipo" class="form-select">
                                    <option value="">Todos</option>
                                    <option value="0">Recarga</option>
                                    <option value="1">Retiro</option>
                                    <option value="2">Suscripción</option>
                                    <option value="3">Compra</option>
                                    <option value="4">Propina</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Estado</label>
                                <select name="estado" class="form-select">
                                    <option value="">Todos</option>
                                    <option value="0">Pendiente</option>
                                    <option value="1">Completada</option>
                                    <option value="2">Fallida</option>
                                    <option value="3">Cancelada</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-white">
                    <button class="btn btn-success" onclick="exportar('Transacciones', 'formTransacciones')">
                        <i class="bi bi-download me-1"></i>Descargar CSV
                    </button>
                </div>
            </div>
        </div>

        <!-- Reportes -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="bi bi-flag me-2"></i>Exportar Reportes</h5>
                </div>
                <div class="card-body">
                    <form id="formReportes">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Desde</label>
                                <input type="date" name="desde" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Hasta</label>
                                <input type="date" name="hasta" class="form-control">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Estado</label>
                                <select name="estado" class="form-select">
                                    <option value="">Todos</option>
                                    <option value="0">Pendiente</option>
                                    <option value="1">En Revisión</option>
                                    <option value="2">Resuelto</option>
                                    <option value="3">Rechazado</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-white">
                    <button class="btn btn-warning" onclick="exportar('Reportes', 'formReportes')">
                        <i class="bi bi-download me-1"></i>Descargar CSV
                    </button>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Exportar Logs</h5>
                </div>
                <div class="card-body">
                    <form id="formLogs">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Desde</label>
                                <input type="date" name="desde" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Hasta</label>
                                <input type="date" name="hasta" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Categoría</label>
                                <select name="categoria" class="form-select">
                                    <option value="">Todas</option>
                                    <option value="0">Sistema</option>
                                    <option value="1">Auth</option>
                                    <option value="2">Usuario</option>
                                    <option value="3">Pago</option>
                                    <option value="4">Contenido</option>
                                    <option value="5">Admin</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tipo</label>
                                <select name="tipo" class="form-select">
                                    <option value="">Todos</option>
                                    <option value="0">Error</option>
                                    <option value="1">Warning</option>
                                    <option value="2">Info</option>
                                    <option value="3">Evento</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-white">
                    <button class="btn btn-dark" onclick="exportar('Logs', 'formLogs')">
                        <i class="bi bi-download me-1"></i>Descargar CSV
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function exportar(tipo, formId) {
            const form = document.getElementById(formId);
            const formData = new FormData(form);
            const params = new URLSearchParams();

            for (const [key, value] of formData.entries()) {
                if (value) params.append(key, value);
            }

            // Checkboxes
            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                if (cb.checked) params.set(cb.name, 'true');
            });

            const url = `/Admin/Exportar${tipo}?${params.toString()}`;

            // Descargar archivo
            window.location.href = url;
        }
    </script>
}
