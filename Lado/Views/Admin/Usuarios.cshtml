@model List<(Lado.Models.ApplicationUser, string)>
@{
    ViewData["Title"] = "Gestión de Usuarios";
    var verificacionesPendientes = (List<Lado.Models.CreatorVerificationRequest>)ViewBag.VerificacionesPendientes ?? new List<Lado.Models.CreatorVerificationRequest>();
}

<style>
    /* Page Header */
    .page-header {
        margin-bottom: 32px;
    }

    .page-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.75rem;
        font-weight: 800;
        color: var(--text-dark);
        margin: 0 0 8px 0;
        letter-spacing: -0.02em;
    }

    .page-subtitle {
        color: var(--text-gray);
        margin: 0;
        font-size: 0.9375rem;
    }

    .btn-back {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        color: var(--text-dark);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.875rem;
        transition: all var(--transition-fast);
        background: var(--bg-white);
    }

    .btn-back:hover {
        background: var(--bg-light);
        border-color: var(--primary);
        color: var(--primary);
    }

    /* Tabs */
    .nav-tabs {
        border-bottom: 2px solid var(--border-color);
        margin-bottom: 32px;
        gap: 4px;
    }

    .nav-tabs .nav-link {
        color: var(--text-gray);
        border: none;
        padding: 14px 24px;
        font-weight: 600;
        font-size: 0.9375rem;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: transparent;
        transition: all var(--transition-fast);
        border-radius: var(--radius-md) var(--radius-md) 0 0;
    }

    .nav-tabs .nav-link:hover {
        color: var(--primary);
        background: var(--primary-pale);
    }

    .nav-tabs .nav-link.active {
        color: var(--primary);
        background: var(--primary-pale);
        border-bottom: 3px solid var(--primary);
    }

    /* User Card */
    .user-card {
        background: var(--bg-white);
        border-radius: var(--radius-lg);
        padding: 24px;
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-fast);
        border: 1px solid var(--border-color);
        margin-bottom: 16px;
    }

    .user-card:hover {
        box-shadow: var(--shadow-md);
        border-color: var(--primary);
    }

    .user-card.user-blocked {
        opacity: 0.7;
        background: rgba(239, 68, 68, 0.05);
        border-color: rgba(239, 68, 68, 0.3);
    }

    .user-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--border-color);
    }

    .user-avatar-placeholder {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary-gradient);
        color: var(--text-white);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        border: 3px solid var(--border-color);
        box-shadow: var(--shadow-sm);
    }

    .user-info h5 {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--text-dark);
        margin: 0 0 4px 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .user-info p {
        color: var(--text-gray);
        margin: 0 0 12px 0;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    /* Button styles */
    .btn-success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .btn-success:hover {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .btn-warning {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }

    .btn-warning:hover {
        background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
        box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
    }

    .btn-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    }

    .btn-danger:hover {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
    }

    .btn-sm {
        padding: 10px 16px;
        font-size: 0.8125rem;
    }

    .btn-group-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    /* Forms */
    .form-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .form-control, .form-select {
        padding: 12px 16px;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        transition: all var(--transition-fast);
        background: var(--bg-white);
        font-family: inherit;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 4px var(--primary-pale);
        outline: none;
    }

    /* Modal */
    .modal-content {
        border-radius: var(--radius-xl);
        border: none;
        box-shadow: var(--shadow-xl);
        overflow: hidden;
    }

    .modal-header {
        padding: 24px 28px;
        border-bottom: 1px solid var(--border-color);
    }

    .modal-header.bg-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: var(--text-white);
        border-bottom: none;
    }

    .modal-body {
        padding: 28px;
    }

    .modal-footer {
        padding: 20px 28px;
        border-top: 1px solid var(--border-color);
    }

    /* Alert */
    .alert {
        padding: 16px 20px;
        border-radius: var(--radius-md);
        border: 1px solid;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .alert-danger {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
        color: #b91c1c;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
    }

    .empty-state svg {
        margin-bottom: 24px;
        opacity: 0.4;
        color: var(--primary);
    }

    .empty-state h5 {
        color: var(--text-gray);
        font-weight: 600;
        font-size: 1rem;
    }

    /* Icon Utilities */
    .icon {
        width: 20px;
        height: 20px;
        display: inline-block;
        vertical-align: middle;
    }

    .icon-sm {
        width: 16px;
        height: 16px;
    }

    .icon-md {
        width: 24px;
        height: 24px;
    }

    .icon-lg {
        width: 32px;
        height: 32px;
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .page-header {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 16px;
        }

        .btn-back {
            width: 100%;
            justify-content: center;
        }
    }

    @@media (max-width: 768px) {
        .page-title {
            font-size: 1.5rem;
        }

        .nav-tabs .nav-link {
            padding: 12px 16px;
            font-size: 0.875rem;
        }

        .user-card {
            padding: 20px;
        }

        .user-avatar, .user-avatar-placeholder {
            width: 50px;
            height: 50px;
            font-size: 1.25rem;
        }

        .user-info h5 {
            font-size: 1rem;
        }

        .btn-group-actions {
            width: 100%;
            margin-top: 16px;
        }

        .btn-group-actions .btn {
            flex: 1;
            font-size: 0.75rem;
            padding: 10px 12px;
        }
    }

    @@media (max-width: 576px) {
        .page-title {
            font-size: 1.25rem;
        }

        .btn-group-actions {
            flex-direction: column;
        }

        .btn-group-actions .btn {
            width: 100%;
        }
    }
</style>

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center page-header">
                <div>
                    <h2 class="page-title">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                        </svg>
                        Gestión de Usuarios
                    </h2>
                    <p class="page-subtitle">Administra todos los usuarios y verificaciones de la plataforma</p>
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#crearUsuarioModal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="8.5" cy="7" r="4" />
                            <line x1="20" y1="8" x2="20" y2="14" />
                            <line x1="23" y1="11" x2="17" y2="11" />
                        </svg>
                        Crear Usuario
                    </button>
                    <a href="/Admin" class="btn-back">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                        Volver
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Estadísticas -->
    <div class="row g-3 mb-4">
        <div class="col-md-3 col-sm-6">
            <div class="stat-card">
                <div class="stat-icon bg-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                    </svg>
                </div>
                <div class="stat-content">
                    <p>Total</p>
                    <h3>@Model.Count</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="stat-card">
                <div class="stat-icon bg-success">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                    </svg>
                </div>
                <div class="stat-content">
                    <p>Creadores</p>
                   
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="stat-card">
                <div class="stat-icon bg-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <polyline points="12 6 12 12 16 14" />
                    </svg>
                </div>
                <div class="stat-content">
                    <p>Pendientes</p>
                    <h3>@verificacionesPendientes.Count</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="stat-card">
                <div class="stat-icon bg-danger">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07" />
                    </svg>
                </div>
                <div class="stat-content">
                    <p>Bloqueados</p>
                    <h3>@Model.Count(u => !u.Item1.EstaActivo)</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#usuarios">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                </svg>
                Todos los Usuarios
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#verificaciones">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12" />
                </svg>
                Verificaciones
                @if (verificacionesPendientes.Count > 0)
                {
                    <span class="badge bg-warning text-dark ms-2">@verificacionesPendientes.Count</span>
                }
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- TAB USUARIOS -->
        <div class="tab-pane fade show active" id="usuarios">
            <!-- Filtros -->
            <div class="card">
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="8" />
                                    <path d="m21 21-4.35-4.35" />
                                </svg>
                                Buscar
                            </label>
                            <input type="text" name="buscar" class="form-control" placeholder="Nombre, email o usuario">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Tipo</label>
                            <select name="tipo" class="form-select">
                                <option value="">Todos</option>
                                <option value="1">Creadores</option>
                                <option value="0">Fans</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Estado</label>
                            <select name="activo" class="form-select">
                                <option value="">Todos</option>
                                <option value="true">Activos</option>
                                <option value="false">Bloqueados</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="8" />
                                    <path d="m21 21-4.35-4.35" />
                                </svg>
                                Filtrar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Lista Usuarios -->
            @if (Model.Any())
            {
                <div class="row">
                    @foreach (var (usuario, rol) in Model)
                    {
                        <div class="col-12">
                            <div class="user-card @(!usuario.EstaActivo ? "user-blocked" : "")">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        @if (!string.IsNullOrEmpty(usuario.FotoPerfil))
                                        {
                                            <img src="@usuario.FotoPerfil" alt="@usuario.UserName" class="user-avatar">
                                        }
                                        else
                                        {
                                            <div class="user-avatar-placeholder">
                                                @usuario.NombreCompleto?.Substring(0, 1).ToUpper()
                                            </div>
                                        }
                                    </div>

                                    <div class="col">
                                        <div class="d-flex align-items-start justify-content-between flex-wrap">
                                            <div class="mb-2 mb-md-0 user-info">
                                                <h5>
                                                    @usuario.NombreCompleto
                                                    @if (usuario.CreadorVerificado)
                                                    {
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#4682B4" stroke="white" stroke-width="2" title="Creador Verificado">
                                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                                                            <polyline points="22 4 12 14.01 9 11.01" />
                                                        </svg>
                                                    }
                                                    @if (!usuario.EstaActivo)
                                                    {
                                                        <span class="badge bg-danger">BLOQUEADO</span>
                                                    }
                                                </h5>
                                                <p>
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                                                        <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                                                    </svg>
                                                    @usuario.Email
                                                </p>
                                                <div class="d-flex flex-wrap gap-2">
                                                    @if (rol == "Admin")
                                                    {
                                                        <span class="badge bg-danger">Admin</span>
                                                    }
                                                    else if (usuario.EsCreador)
                                                    {
                                                        <span class="badge bg-success">Creador</span>
                                                        @if (usuario.TieneLadoB())
                                                        {
                                                            <span class="badge bg-purple" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">LadoB</span>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-info">Fan</span>
                                                    }
                                                    <small class="text-muted">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                                            <line x1="16" y1="2" x2="16" y2="6" />
                                                            <line x1="8" y1="2" x2="8" y2="6" />
                                                            <line x1="3" y1="10" x2="21" y2="10" />
                                                        </svg>
                                                        @usuario.FechaRegistro.ToString("dd/MM/yyyy")
                                                    </small>
                                                </div>
                                            </div>

                                            <!-- Acciones -->
                                            <div class="btn-group-actions">
                                                <a href="/Admin/DetalleUsuario/@usuario.Id" class="btn btn-outline-primary btn-sm">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                                        <circle cx="12" cy="12" r="3" />
                                                    </svg>
                                                    Ver
                                                </a>

                                                @if (rol != "Admin")
                                                {
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#cambiarContrasenaModal" data-userid="@usuario.Id" data-username="@usuario.NombreCompleto">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                                        </svg>
                                                        Contraseña
                                                    </button>

                                                    @if (usuario.EstaActivo)
                                                    {
                                                        <form method="post" asp-action="BloquearUsuario" asp-route-id="@usuario.Id" class="d-inline" onsubmit="return confirm('¿Bloquear a @usuario.NombreCompleto?')">
                                                            @Html.AntiForgeryToken()
                                                            <button type="submit" class="btn btn-warning btn-sm">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                                    <circle cx="12" cy="12" r="10" />
                                                                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07" />
                                                                </svg>
                                                                Bloquear
                                                            </button>
                                                        </form>
                                                    }
                                                    else
                                                    {
                                                        <form method="post" asp-action="DesbloquearUsuario" asp-route-id="@usuario.Id" class="d-inline" onsubmit="return confirm('¿Desbloquear a @usuario.NombreCompleto?')">
                                                            @Html.AntiForgeryToken()
                                                            <button type="submit" class="btn btn-success btn-sm">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                                    <polyline points="20 6 9 17 4 12" />
                                                                </svg>
                                                                Desbloquear
                                                            </button>
                                                        </form>
                                                    }

                                                    @if (usuario.EsCreador || rol == "Creador")
                                                    {
                                                        <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#comisionModal"
                                                                data-userid="@usuario.Id"
                                                                data-username="@usuario.NombreCompleto"
                                                                data-comision="@usuario.ComisionRetiro"
                                                                data-minimo="@usuario.MontoMinimoRetiro"
                                                                data-pais="@(usuario.Pais ?? "")"
                                                                data-paisnombre="@(Lado.Models.RetencionesPredeterminadas.Paises.ContainsKey(usuario.Pais ?? "") ? Lado.Models.RetencionesPredeterminadas.Paises[usuario.Pais!].Nombre : "No definido")"
                                                                data-paisretencion="@(Lado.Models.RetencionesPredeterminadas.Paises.ContainsKey(usuario.Pais ?? "") ? Lado.Models.RetencionesPredeterminadas.Paises[usuario.Pais!].Retencion : 0)"
                                                                data-usarretencionpais="@usuario.UsarRetencionPais.ToString().ToLower()"
                                                                data-retencion="@(usuario.RetencionImpuestos ?? 0)">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                                            </svg>
                                                            Comisión
                                                        </button>
                                                    }

                                                    <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#eliminarModal" data-userid="@usuario.Id" data-username="@usuario.NombreCompleto">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <polyline points="3 6 5 6 21 6"></polyline>
                                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            <line x1="10" y1="11" x2="10" y2="17"></line>
                                                            <line x1="14" y1="11" x2="14" y2="17"></line>
                                                        </svg>
                                                        Eliminar
                                                    </button>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="card">
                    <div class="card-body empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="8" x2="12" y2="12" />
                            <line x1="12" y1="16" x2="12.01" y2="16" />
                        </svg>
                        <h5>No se encontraron usuarios</h5>
                    </div>
                </div>
            }
        </div>

        <!-- TAB VERIFICACIONES -->
        <div class="tab-pane fade" id="verificaciones">
            @if (verificacionesPendientes.Count > 0)
            {
                <div class="row g-3">
                    @foreach (var solicitud in verificacionesPendientes)
                    {
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-warning bg-opacity-10">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-warning text-dark">Pendiente</span>
                                        <small class="text-muted">@solicitud.FechaSolicitud.ToString("dd/MM/yyyy")</small>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        @if (!string.IsNullOrEmpty(solicitud.User.FotoPerfil))
                                        {
                                            <img src="@solicitud.User.FotoPerfil" alt="@solicitud.User.UserName" class="rounded-circle me-3" style="width: 50px; height: 50px; object-fit: cover;">
                                        }
                                        else
                                        {
                                            <div class="rounded-circle bg-primary text-white me-3 d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                                <strong>@solicitud.User.NombreCompleto?.Substring(0, 1).ToUpper()</strong>
                                            </div>
                                        }
                                        <div>
                                            <h6 class="mb-0">@solicitud.User.UserName</h6>
                                            <small class="text-muted">@solicitud.User.Email</small>
                                        </div>
                                    </div>

                                    <hr />

                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <small class="text-muted d-block">Nombre</small>
                                            <strong>@solicitud.NombreCompleto</strong>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">Documento</small>
                                            <strong>@solicitud.TipoDocumento @solicitud.NumeroDocumento</strong>
                                        </div>
                                    </div>

                                    <div class="d-grid">
                                        <a href="/CreatorVerification/Review/@solicitud.Id" class="btn btn-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                                <circle cx="12" cy="12" r="3" />
                                            </svg>
                                            Revisar
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="card">
                    <div class="card-body empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        <h5 class="text-success">No hay verificaciones pendientes</h5>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<!-- Modal Eliminar Usuario -->
<div class="modal fade" id="eliminarModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                        <line x1="12" y1="9" x2="12" y2="13" />
                        <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                    Eliminar Usuario Permanentemente
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" id="formEliminar">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="15" y1="9" x2="9" y2="15" />
                            <line x1="9" y1="9" x2="15" y2="15" />
                        </svg>
                        <strong>¡ADVERTENCIA!</strong> Esta acción es irreversible.
                    </div>
                    <p>¿Estás seguro de eliminar permanentemente al usuario <strong id="modalUsername"></strong>?</p>
                    <p class="text-muted small">Se eliminarán:</p>
                    <ul class="text-muted small">
                        <li>Toda su información personal</li>
                        <li>Todo su contenido publicado</li>
                        <li>Sus suscripciones y transacciones</li>
                        <li>Sus mensajes y comentarios</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Eliminar Permanentemente
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Cambiar Contraseña -->
<div class="modal fade" id="cambiarContrasenaModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #4682B4 0%, #36648B 100%); color: white;">
                <h5 class="modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    Cambiar Contraseña
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" id="formCambiarContrasena">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <p class="mb-3">Cambiar contraseña de: <strong id="modalPasswordUsername"></strong></p>

                    <div class="mb-3">
                        <label class="form-label">Nueva Contraseña</label>
                        <div class="input-group">
                            <input type="password" name="nuevaContrasena" id="nuevaContrasenaInput" class="form-control" required minlength="8" placeholder="Minimo 8 caracteres">
                            <button type="button" class="btn btn-outline-secondary" onclick="togglePasswordVisibility()">
                                <svg id="eyeIconModal" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                        <small class="form-text text-muted">La contraseña debe tener al menos 8 caracteres, una letra minuscula y un numero.</small>
                    </div>

                    <div class="alert alert-warning border-0 mb-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm me-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <strong>Importante:</strong> El usuario debera usar esta nueva contraseña para ingresar.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Guardar Contraseña
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Configurar Comisión y Retención -->
<div class="modal fade" id="comisionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #4682B4 0%, #36648B 100%); color: white;">
                <h5 class="modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    Configurar Comisión y Retención
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" asp-action="ActualizarComisionUsuario" id="formComision">
                @Html.AntiForgeryToken()
                <input type="hidden" name="userId" id="comisionUserId" />
                <div class="modal-body">
                    <div class="alert alert-info border-0 mb-4">
                        <strong>Creador:</strong> <span id="comisionUsername"></span>
                        <span class="badge bg-secondary ms-2" id="paisUsuario"></span>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-3">COMISIÓN LADOAPP</h6>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Comisión de Retiro (%)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" name="comisionRetiro" id="comisionRetiroInput"
                                           step="0.1" min="0" max="100" required style="font-size: 1.1rem; font-weight: 600;">
                                    <span class="input-group-text">%</span>
                                </div>
                                <small class="text-muted">Porcentaje que LadoApp retiene</small>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Monto Mínimo de Retiro</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" name="montoMinimoRetiro" id="montoMinimoInput"
                                           step="1" min="0" required style="font-size: 1.1rem; font-weight: 600;">
                                    <span class="input-group-text">USD</span>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <h6 class="text-muted mb-3">RETENCIÓN DE IMPUESTOS</h6>

                            <div class="mb-3">
                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" name="usarRetencionPais"
                                           id="usarRetencionPaisCheck" value="true" checked>
                                    <label class="form-check-label fw-bold" for="usarRetencionPaisCheck">
                                        Usar retención del país
                                    </label>
                                </div>
                                <small class="text-muted d-block mb-3">
                                    Retención del país (<span id="paisRetencionNombre">-</span>):
                                    <strong><span id="paisRetencionValor">0</span>%</strong>
                                </small>
                            </div>

                            <div class="mb-3" id="retencionPersonalizadaDiv" style="display: none;">
                                <label class="form-label fw-bold">Retención Personalizada (%)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" name="retencionImpuestos" id="retencionImpuestosInput"
                                           step="0.1" min="0" max="100" style="font-size: 1.1rem; font-weight: 600;">
                                    <span class="input-group-text">%</span>
                                </div>
                                <small class="text-muted">Retención específica para este usuario</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="card bg-light border-0">
                        <div class="card-body">
                            <h6 class="mb-3">Ejemplo de retiro de $100 USD:</h6>
                            <div class="row">
                                <div class="col-6">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Monto bruto:</span>
                                        <strong>$100.00</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2 text-danger">
                                        <span>Comisión (<span id="ejemploComision">20</span>%):</span>
                                        <strong>-$<span id="ejemploDescuento">20.00</span></strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2 text-warning">
                                        <span>Impuestos (<span id="ejemploImpuesto">0</span>%):</span>
                                        <strong>-$<span id="ejemploImpuestoMonto">0.00</span></strong>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Total descuentos:</span>
                                        <strong class="text-danger">-$<span id="ejemploTotalDescuento">20.00</span></strong>
                                    </div>
                                    <hr class="my-2">
                                    <div class="d-flex justify-content-between">
                                        <span class="fw-bold">Neto a recibir:</span>
                                        <strong class="text-success fs-5">$<span id="ejemploNeto">80.00</span></strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Guardar Configuración
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Crear Usuario -->
<div class="modal fade" id="crearUsuarioModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                <h5 class="modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                        <circle cx="8.5" cy="7" r="4" />
                        <line x1="20" y1="8" x2="20" y2="14" />
                        <line x1="23" y1="11" x2="17" y2="11" />
                    </svg>
                    Crear Nuevo Usuario
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" asp-action="CrearUsuario" id="formCrearUsuario">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="row g-3">
                        <!-- Nombre completo -->
                        <div class="col-md-6">
                            <label class="form-label">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg>
                                Nombre Completo <span class="text-danger">*</span>
                            </label>
                            <input type="text" name="nombreCompleto" class="form-control" required placeholder="Ej: Juan Perez">
                        </div>

                        <!-- Nombre de usuario -->
                        <div class="col-md-6">
                            <label class="form-label">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="4" />
                                    <path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94" />
                                </svg>
                                Nombre de Usuario <span class="text-danger">*</span>
                            </label>
                            <input type="text" name="userName" class="form-control" required placeholder="Ej: juanperez" pattern="[a-zA-Z0-9_]+" title="Solo letras, numeros y guion bajo">
                        </div>

                        <!-- Email -->
                        <div class="col-md-6">
                            <label class="form-label">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                                    <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                                </svg>
                                Email <span class="text-danger">*</span>
                            </label>
                            <input type="email" name="email" class="form-control" required placeholder="correo@ejemplo.com">
                        </div>

                        <!-- Contraseña temporal -->
                        <div class="col-md-6">
                            <label class="form-label">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                                Contraseña Temporal <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <input type="password" name="password" id="crearPasswordInput" class="form-control" required minlength="8" placeholder="Minimo 8 caracteres">
                                <button type="button" class="btn btn-outline-secondary" onclick="toggleCrearPasswordVisibility()">
                                    <svg id="crearEyeIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                                <button type="button" class="btn btn-outline-primary" onclick="generarPassword()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                                    </svg>
                                </button>
                            </div>
                            <small class="text-muted">Minimo 8 caracteres, una letra y un numero</small>
                        </div>

                        <!-- Rol -->
                        <div class="col-md-6">
                            <label class="form-label">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                                </svg>
                                Rol <span class="text-danger">*</span>
                            </label>
                            <select name="rol" class="form-select" required>
                                <option value="Usuario">Usuario (Fan)</option>
                                <option value="Creador">Creador</option>
                                <option value="Admin">Administrador</option>
                            </select>
                        </div>

                        <!-- Tipo de creador (solo si es creador) -->
                        <div class="col-md-6" id="tipoCreadorDiv" style="display: none;">
                            <label class="form-label">Tipo de Creador</label>
                            <select name="esCreador" class="form-select">
                                <option value="true">Creador con perfil</option>
                                <option value="false">Solo rol (sin perfil de creador)</option>
                            </select>
                        </div>

                        <div class="col-12">
                            <hr class="my-2">
                        </div>

                        <!-- Opciones adicionales -->
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="emailConfirmado" id="emailConfirmadoCheck" value="true" checked>
                                <label class="form-check-label" for="emailConfirmadoCheck">
                                    <strong>Email verificado</strong>
                                    <br><small class="text-muted">El usuario no necesitara confirmar su email</small>
                                </label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="creadorVerificado" id="creadorVerificadoCheck" value="true">
                                <label class="form-check-label" for="creadorVerificadoCheck">
                                    <strong>Creador verificado</strong>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#4682B4" stroke="white" stroke-width="2">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                                        <polyline points="22 4 12 14.01 9 11.01" />
                                    </svg>
                                    <br><small class="text-muted">Mostrar insignia de verificado</small>
                                </label>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="enviarEmailBienvenida" id="enviarEmailCheck" value="true">
                                <label class="form-check-label" for="enviarEmailCheck">
                                    <strong>Enviar email de bienvenida</strong>
                                    <br><small class="text-muted">Enviar credenciales al usuario por email</small>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="alertaCrearUsuario" class="alert alert-danger mt-3" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-success" id="btnCrearUsuario">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="8.5" cy="7" r="4" />
                            <line x1="20" y1="8" x2="20" y2="14" />
                            <line x1="23" y1="11" x2="17" y2="11" />
                        </svg>
                        Crear Usuario
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Modal Eliminar
    document.getElementById('eliminarModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var userId = button.getAttribute('data-userid');
        var username = button.getAttribute('data-username');
        document.getElementById('formEliminar').action = '/Admin/EliminarUsuario/' + userId;
        document.getElementById('modalUsername').textContent = username;
    });

    // Modal Cambiar Contraseña
    document.getElementById('cambiarContrasenaModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var userId = button.getAttribute('data-userid');
        var username = button.getAttribute('data-username');
        document.getElementById('formCambiarContrasena').action = '/Admin/CambiarContrasena/' + userId;
        document.getElementById('modalPasswordUsername').textContent = username;
        document.getElementById('nuevaContrasenaInput').value = '';
    });

    // Toggle password visibility
    function togglePasswordVisibility() {
        var input = document.getElementById('nuevaContrasenaInput');
        var eyeIcon = document.getElementById('eyeIconModal');
        if (input.type === 'password') {
            input.type = 'text';
            eyeIcon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
        } else {
            input.type = 'password';
            eyeIcon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
        }
    }

    // Modal Configurar Comisión y Retención
    document.getElementById('comisionModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var userId = button.getAttribute('data-userid');
        var username = button.getAttribute('data-username');
        var comision = parseFloat(button.getAttribute('data-comision')) || 20;
        var minimo = parseFloat(button.getAttribute('data-minimo')) || 50;
        var pais = button.getAttribute('data-pais') || '';
        var paisNombre = button.getAttribute('data-paisnombre') || 'No definido';
        var paisRetencion = parseFloat(button.getAttribute('data-paisretencion')) || 0;
        var usarRetencionPais = button.getAttribute('data-usarretencionpais') === 'true';
        var retencionPersonalizada = parseFloat(button.getAttribute('data-retencion')) || 0;

        document.getElementById('comisionUserId').value = userId;
        document.getElementById('comisionUsername').textContent = username;
        document.getElementById('comisionRetiroInput').value = comision;
        document.getElementById('montoMinimoInput').value = minimo;
        document.getElementById('paisUsuario').textContent = pais || 'Sin país';
        document.getElementById('paisRetencionNombre').textContent = paisNombre;
        document.getElementById('paisRetencionValor').textContent = paisRetencion.toFixed(1);
        document.getElementById('usarRetencionPaisCheck').checked = usarRetencionPais;
        document.getElementById('retencionImpuestosInput').value = retencionPersonalizada;

        // Mostrar/ocultar campo de retención personalizada
        toggleRetencionPersonalizada(usarRetencionPais);

        // Calcular ejemplo
        var retencionActual = usarRetencionPais ? paisRetencion : retencionPersonalizada;
        actualizarEjemploCompleto(comision, retencionActual);
    });

    // Toggle retención personalizada
    document.getElementById('usarRetencionPaisCheck').addEventListener('change', function() {
        toggleRetencionPersonalizada(this.checked);
        recalcularEjemplo();
    });

    function toggleRetencionPersonalizada(usarPais) {
        var div = document.getElementById('retencionPersonalizadaDiv');
        div.style.display = usarPais ? 'none' : 'block';
    }

    // Actualizar ejemplo en tiempo real
    document.getElementById('comisionRetiroInput').addEventListener('input', recalcularEjemplo);
    document.getElementById('retencionImpuestosInput').addEventListener('input', recalcularEjemplo);

    function recalcularEjemplo() {
        var comision = parseFloat(document.getElementById('comisionRetiroInput').value) || 0;
        var usarPais = document.getElementById('usarRetencionPaisCheck').checked;
        var retencion = usarPais
            ? parseFloat(document.getElementById('paisRetencionValor').textContent) || 0
            : parseFloat(document.getElementById('retencionImpuestosInput').value) || 0;
        actualizarEjemploCompleto(comision, retencion);
    }

    function actualizarEjemploCompleto(comision, retencion) {
        var montoBruto = 100;
        var descuentoComision = (montoBruto * comision / 100);
        var descuentoImpuesto = (montoBruto * retencion / 100);
        var totalDescuento = descuentoComision + descuentoImpuesto;
        var neto = montoBruto - totalDescuento;

        document.getElementById('ejemploComision').textContent = comision.toFixed(1);
        document.getElementById('ejemploDescuento').textContent = descuentoComision.toFixed(2);
        document.getElementById('ejemploImpuesto').textContent = retencion.toFixed(1);
        document.getElementById('ejemploImpuestoMonto').textContent = descuentoImpuesto.toFixed(2);
        document.getElementById('ejemploTotalDescuento').textContent = totalDescuento.toFixed(2);
        document.getElementById('ejemploNeto').textContent = neto.toFixed(2);
    }

    // ========================================
    // Modal Crear Usuario
    // ========================================

    // Toggle visibilidad contraseña crear usuario
    function toggleCrearPasswordVisibility() {
        var input = document.getElementById('crearPasswordInput');
        var eyeIcon = document.getElementById('crearEyeIcon');
        if (input.type === 'password') {
            input.type = 'text';
            eyeIcon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
        } else {
            input.type = 'password';
            eyeIcon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
        }
    }

    // Generar contraseña aleatoria
    function generarPassword() {
        var chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@@#$%';
        var password = '';
        // Asegurar al menos una minuscula, una mayuscula y un numero
        password += 'abcdefghijklmnopqrstuvwxyz'.charAt(Math.floor(Math.random() * 26));
        password += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.charAt(Math.floor(Math.random() * 26));
        password += '0123456789'.charAt(Math.floor(Math.random() * 10));
        // Completar hasta 12 caracteres
        for (var i = 0; i < 9; i++) {
            password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        // Mezclar
        password = password.split('').sort(() => Math.random() - 0.5).join('');
        document.getElementById('crearPasswordInput').value = password;
        document.getElementById('crearPasswordInput').type = 'text';
    }

    // Mostrar/ocultar opciones de creador segun rol seleccionado
    document.querySelector('select[name="rol"]').addEventListener('change', function() {
        var tipoCreadorDiv = document.getElementById('tipoCreadorDiv');
        var creadorVerificadoCheck = document.getElementById('creadorVerificadoCheck');

        if (this.value === 'Creador') {
            tipoCreadorDiv.style.display = 'block';
        } else {
            tipoCreadorDiv.style.display = 'none';
        }

        // Habilitar/deshabilitar verificado segun rol
        if (this.value === 'Usuario') {
            creadorVerificadoCheck.checked = false;
            creadorVerificadoCheck.disabled = true;
        } else {
            creadorVerificadoCheck.disabled = false;
        }
    });

    // Reset modal al cerrar
    document.getElementById('crearUsuarioModal').addEventListener('hidden.bs.modal', function () {
        document.getElementById('formCrearUsuario').reset();
        document.getElementById('tipoCreadorDiv').style.display = 'none';
        document.getElementById('alertaCrearUsuario').style.display = 'none';
        document.getElementById('crearPasswordInput').type = 'password';
    });
</script>