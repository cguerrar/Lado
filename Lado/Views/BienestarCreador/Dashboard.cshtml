@using Lado.Services
@{
    ViewData["Title"] = "Bienestar del Creador";

    var configVacaciones = ViewBag.ConfigVacaciones as Lado.Models.ConfiguracionVacaciones;
    var alertasBurnout = ViewBag.AlertasBurnout as List<AlertaBienestar> ?? new List<AlertaBienestar>();
    var celebraciones = ViewBag.Celebraciones as List<Celebracion> ?? new List<Celebracion>();
    var proyeccion = ViewBag.Proyeccion as ProyeccionIngresos ?? new ProyeccionIngresos();
    var metricas = ViewBag.Metricas as MetricasBienestar ?? new MetricasBienestar();
    var contenidoProgramado = ViewBag.ContenidoProgramado as List<Lado.Models.ContenidoProgramado> ?? new List<Lado.Models.ContenidoProgramado>();
    var usuario = ViewBag.Usuario as Lado.Models.ApplicationUser;

    var vacacionesActivas = configVacaciones?.EstaActivo == true;
}

<style>
    /* ========================================
       ESTILOS BIENESTAR - Tono calido y positivo
       ======================================== */

    .bienestar-header {
        background: linear-gradient(135deg, #e0f2fe 0%, #fef3c7 50%, #fce7f3 100%);
        border-radius: var(--radius-lg);
        padding: 28px 32px;
        margin-bottom: 28px;
        border: 1px solid rgba(70, 130, 180, 0.2);
    }

    [data-theme="dark"] .bienestar-header {
        background: linear-gradient(135deg, rgba(70, 130, 180, 0.15) 0%, rgba(251, 191, 36, 0.1) 50%, rgba(244, 114, 182, 0.1) 100%);
        border-color: rgba(70, 130, 180, 0.3);
    }

    .bienestar-header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--fg);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .bienestar-header p {
        color: var(--muted);
        font-size: 1rem;
    }

    .bienestar-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 24px;
    }

    .bienestar-card {
        background: var(--surface);
        border: 1px solid var(--line);
        border-radius: var(--radius-lg);
        padding: 24px;
        box-shadow: var(--shadow-sm);
        transition: all 0.2s ease;
    }

    .bienestar-card:hover {
        box-shadow: var(--shadow-md);
    }

    .bienestar-card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
    }

    .bienestar-card-icon {
        width: 44px;
        height: 44px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .bienestar-card-icon svg {
        width: 22px;
        height: 22px;
        stroke: white;
    }

    .bienestar-card-icon.vacaciones {
        background: linear-gradient(135deg, #06b6d4, #0891b2);
    }

    .bienestar-card-icon.alertas {
        background: linear-gradient(135deg, #f97316, #ea580c);
    }

    .bienestar-card-icon.celebraciones {
        background: linear-gradient(135deg, #a855f7, #9333ea);
    }

    .bienestar-card-icon.ingresos {
        background: linear-gradient(135deg, #22c55e, #16a34a);
    }

    .bienestar-card-icon.metricas {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
    }

    .bienestar-card-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--fg);
    }

    .bienestar-card-subtitle {
        font-size: 0.875rem;
        color: var(--muted);
    }

    /* Vacaciones Toggle */
    .vacaciones-status {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        margin-bottom: 16px;
    }

    .vacaciones-status.activo {
        background: rgba(6, 182, 212, 0.1);
        border: 1px solid rgba(6, 182, 212, 0.3);
    }

    .vacaciones-badge {
        padding: 6px 12px;
        border-radius: var(--radius-lg);
        font-size: 0.8125rem;
        font-weight: 600;
    }

    .vacaciones-badge.activo {
        background: #06b6d4;
        color: white;
    }

    .vacaciones-badge.inactivo {
        background: var(--line);
        color: var(--muted);
    }

    .vacaciones-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .vacaciones-form .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    /* Alertas de Bienestar */
    .alerta-item {
        display: flex;
        gap: 14px;
        padding: 16px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        margin-bottom: 12px;
        border-left: 4px solid transparent;
        transition: all 0.2s;
    }

    .alerta-item:hover {
        background: var(--surface-hover);
    }

    .alerta-item.warning {
        border-left-color: #f59e0b;
        background: rgba(245, 158, 11, 0.08);
    }

    .alerta-item.info {
        border-left-color: #3b82f6;
        background: rgba(59, 130, 246, 0.08);
    }

    .alerta-item.success {
        border-left-color: #22c55e;
        background: rgba(34, 197, 94, 0.08);
    }

    .alerta-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .alerta-icon.warning { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .alerta-icon.info { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .alerta-icon.success { background: rgba(34, 197, 94, 0.2); color: #22c55e; }

    .alerta-content h4 {
        font-size: 0.9375rem;
        font-weight: 600;
        color: var(--fg);
        margin-bottom: 4px;
    }

    .alerta-content p {
        font-size: 0.875rem;
        color: var(--muted);
        line-height: 1.5;
        margin-bottom: 8px;
    }

    .alerta-sugerencia {
        font-size: 0.8125rem;
        color: var(--primary);
        font-weight: 500;
    }

    /* Celebraciones */
    .celebracion-item {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 16px;
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.08) 0%, rgba(236, 72, 153, 0.08) 100%);
        border-radius: var(--radius-md);
        margin-bottom: 10px;
        border: 1px solid rgba(168, 85, 247, 0.2);
        position: relative;
        overflow: hidden;
    }

    .celebracion-item.nueva::before {
        content: 'NUEVO';
        position: absolute;
        top: 8px;
        right: -24px;
        background: #a855f7;
        color: white;
        font-size: 9px;
        font-weight: 700;
        padding: 2px 28px;
        transform: rotate(45deg);
    }

    .celebracion-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #a855f7, #ec4899);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        flex-shrink: 0;
    }

    .celebracion-content h4 {
        font-size: 0.9375rem;
        font-weight: 600;
        color: var(--fg);
    }

    .celebracion-content p {
        font-size: 0.8125rem;
        color: var(--muted);
    }

    /* Proyeccion de Ingresos */
    .proyeccion-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 20px;
    }

    .proyeccion-stat {
        padding: 16px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        text-align: center;
    }

    .proyeccion-stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--fg);
    }

    .proyeccion-stat-value.positive { color: #22c55e; }
    .proyeccion-stat-value.negative { color: #ef4444; }

    .proyeccion-stat-label {
        font-size: 0.8125rem;
        color: var(--muted);
        margin-top: 4px;
    }

    .proyeccion-chart {
        height: 220px;
        margin: 20px 0;
    }

    .proyeccion-alerta {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 12px;
        background: rgba(59, 130, 246, 0.08);
        border-radius: var(--radius-sm);
        margin-top: 8px;
        font-size: 0.875rem;
        color: var(--fg);
    }

    .proyeccion-alerta svg {
        width: 18px;
        height: 18px;
        color: #3b82f6;
        flex-shrink: 0;
        margin-top: 2px;
    }

    /* Metricas de Bienestar */
    .score-bienestar {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 24px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-lg);
        margin-bottom: 20px;
    }

    .score-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 12px;
        position: relative;
    }

    .score-circle::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 50%;
        border: 6px solid var(--line);
    }

    .score-circle.excellent { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
    .score-circle.excellent::before { border-color: #22c55e; }

    .score-circle.good { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
    .score-circle.good::before { border-color: #3b82f6; }

    .score-circle.warning { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
    .score-circle.warning::before { border-color: #f59e0b; }

    .score-circle.alert { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .score-circle.alert::before { border-color: #ef4444; }

    .score-mensaje {
        font-size: 0.9375rem;
        color: var(--fg);
        text-align: center;
    }

    .metricas-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .metrica-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-sm);
    }

    .metrica-label {
        font-size: 0.875rem;
        color: var(--muted);
    }

    .metrica-value {
        font-size: 0.9375rem;
        font-weight: 600;
        color: var(--fg);
    }

    /* Contenido Programado */
    .programado-item {
        display: flex;
        gap: 12px;
        padding: 12px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        margin-bottom: 10px;
    }

    .programado-thumb {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-sm);
        object-fit: cover;
        background: var(--line);
    }

    .programado-info {
        flex: 1;
    }

    .programado-fecha {
        font-size: 0.8125rem;
        color: var(--primary);
        font-weight: 600;
    }

    .programado-desc {
        font-size: 0.875rem;
        color: var(--muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Botones */
    .btn-bienestar {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 18px;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 0.875rem;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-bienestar.primary {
        background: var(--primary);
        color: white;
    }

    .btn-bienestar.primary:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
    }

    .btn-bienestar.secondary {
        background: var(--bg-tertiary);
        color: var(--fg);
        border: 1px solid var(--line);
    }

    .btn-bienestar.secondary:hover {
        background: var(--line);
    }

    .btn-bienestar.danger {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .btn-bienestar.danger:hover {
        background: rgba(239, 68, 68, 0.2);
    }

    /* Form Inputs */
    .bienestar-input {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid var(--line);
        border-radius: var(--radius-md);
        background: var(--surface);
        color: var(--fg);
        font-size: 0.9375rem;
        transition: border-color 0.2s;
    }

    .bienestar-input:focus {
        outline: none;
        border-color: var(--primary);
    }

    .bienestar-textarea {
        min-height: 80px;
        resize: vertical;
    }

    .bienestar-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--fg);
        margin-bottom: 6px;
    }

    /* Responsive */
    .card-vacaciones { grid-column: span 6; }
    .card-alertas { grid-column: span 6; }
    .card-celebraciones { grid-column: span 4; }
    .card-ingresos { grid-column: span 8; }
    .card-metricas { grid-column: span 4; }
    .card-programados { grid-column: span 8; }

    @@media (max-width: 1200px) {
        .card-vacaciones,
        .card-alertas { grid-column: span 6; }
        .card-celebraciones { grid-column: span 12; }
        .card-ingresos { grid-column: span 12; }
        .card-metricas { grid-column: span 6; }
        .card-programados { grid-column: span 6; }
    }

    @@media (max-width: 768px) {
        .bienestar-grid {
            grid-template-columns: 1fr;
        }

        .card-vacaciones,
        .card-alertas,
        .card-celebraciones,
        .card-ingresos,
        .card-metricas,
        .card-programados {
            grid-column: span 1;
        }

        .vacaciones-form .form-row {
            grid-template-columns: 1fr;
        }

        .proyeccion-stats {
            grid-template-columns: 1fr;
        }
    }

    /* Empty states */
    .empty-state {
        text-align: center;
        padding: 32px 20px;
        color: var(--muted);
    }

    .empty-state svg {
        width: 48px;
        height: 48px;
        margin-bottom: 12px;
        opacity: 0.5;
    }

    .empty-state p {
        font-size: 0.9375rem;
    }

    /* Help Banner */
    .help-banner {
        background: linear-gradient(135deg, rgba(236, 72, 153, 0.08) 0%, rgba(219, 39, 119, 0.08) 100%);
        border: 1px solid rgba(236, 72, 153, 0.25);
        border-radius: var(--radius-lg);
        padding: 20px 24px;
        margin-bottom: 24px;
    }

    .help-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
    }

    .help-header h3 {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 15px;
        font-weight: 600;
        color: #be185d;
        margin: 0;
    }

    [data-theme="dark"] .help-header h3 {
        color: #f472b6;
    }

    .help-header svg {
        color: #ec4899;
    }

    .help-toggle {
        background: none;
        border: none;
        color: #be185d;
        cursor: pointer;
        padding: 4px;
        display: flex;
        align-items: center;
        transition: transform 0.3s;
    }

    [data-theme="dark"] .help-toggle {
        color: #f472b6;
    }

    .help-toggle.collapsed {
        transform: rotate(-90deg);
    }

    .help-content {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid rgba(236, 72, 153, 0.15);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 16px;
    }

    .help-content.hidden {
        display: none;
    }

    .help-item {
        display: flex;
        gap: 12px;
    }

    .help-icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: rgba(236, 72, 153, 0.12);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        color: #ec4899;
    }

    .help-text h4 {
        font-size: 13px;
        font-weight: 600;
        color: var(--fg);
        margin: 0 0 4px 0;
    }

    .help-text p {
        font-size: 12px;
        color: var(--muted);
        margin: 0;
        line-height: 1.4;
    }
</style>

<!-- Header -->
<div class="bienestar-header">
    <h1>
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
        </svg>
        Bienestar del Creador
    </h1>
    <p>Tu salud y equilibrio son importantes. Aqui puedes gestionar tu descanso, ver tus logros y proyectar tus ingresos.</p>
</div>

<!-- Ayuda -->
<div class="help-banner" id="helpBanner">
    <div class="help-header" onclick="toggleHelp()">
        <h3>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            ¿Qué puedo hacer aquí?
        </h3>
        <button class="help-toggle" id="helpToggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </button>
    </div>
    <div class="help-content" id="helpContent">
        <div class="help-item">
            <div class="help-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path>
                    <path d="M2 12h20"></path>
                </svg>
            </div>
            <div class="help-text">
                <h4>Modo Vacaciones</h4>
                <p>Activa el modo vacaciones para auto-responder mensajes y proteger tus suscriptores.</p>
            </div>
        </div>
        <div class="help-item">
            <div class="help-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 20V10"></path>
                    <path d="M18 20V4"></path>
                    <path d="M6 20v-4"></path>
                </svg>
            </div>
            <div class="help-text">
                <h4>Alertas de Burnout</h4>
                <p>Te avisamos si detectamos signos de fatiga o exceso de trabajo.</p>
            </div>
        </div>
        <div class="help-item">
            <div class="help-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                    <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                    <path d="M4 22h16"></path>
                    <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                    <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                    <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                </svg>
            </div>
            <div class="help-text">
                <h4>Celebra tus logros</h4>
                <p>Reconocemos tus hitos: suscriptores, ingresos y rachas de publicación.</p>
            </div>
        </div>
        <div class="help-item">
            <div class="help-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
            </div>
            <div class="help-text">
                <h4>Proyección de Ingresos</h4>
                <p>Visualiza tus ingresos y proyecciones para los próximos meses.</p>
            </div>
        </div>
    </div>
</div>

<div class="bienestar-grid">
    <!-- Card: Modo Vacaciones -->
    <div class="bienestar-card card-vacaciones">
        <div class="bienestar-card-header">
            <div class="bienestar-card-icon vacaciones">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/>
                    <path d="M2 12h20"/>
                </svg>
            </div>
            <div>
                <div class="bienestar-card-title">Modo Vacaciones</div>
                <div class="bienestar-card-subtitle">Toma un descanso sin perder suscriptores</div>
            </div>
        </div>

        <div class="vacaciones-status @(vacacionesActivas ? "activo" : "")">
            <span class="vacaciones-badge @(vacacionesActivas ? "activo" : "inactivo")">
                @(vacacionesActivas ? "ACTIVO" : "INACTIVO")
            </span>
            @if (vacacionesActivas && configVacaciones?.FechaFin != null)
            {
                <span style="color: var(--muted); font-size: 0.875rem;">
                    Hasta el @configVacaciones.FechaFin.Value.ToString("dd/MM/yyyy")
                </span>
            }
        </div>

        @if (vacacionesActivas)
        {
            <p style="color: var(--muted); font-size: 0.875rem; margin-bottom: 16px;">
                <strong>Mensaje de auto-respuesta:</strong><br>
                @(configVacaciones?.MensajeAutorespuesta ?? "Sin mensaje configurado")
            </p>
            <button class="btn-bienestar danger" onclick="desactivarVacaciones()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                Desactivar Modo Vacaciones
            </button>
        }
        else
        {
            <form id="formVacaciones" class="vacaciones-form">
                <div class="form-row">
                    <div>
                        <label class="bienestar-label">Fecha inicio</label>
                        <input type="date" id="fechaInicio" class="bienestar-input" min="@DateTime.Today.ToString("yyyy-MM-dd")" required>
                    </div>
                    <div>
                        <label class="bienestar-label">Fecha fin</label>
                        <input type="date" id="fechaFin" class="bienestar-input" required>
                    </div>
                </div>
                <div>
                    <label class="bienestar-label">Mensaje de auto-respuesta</label>
                    <textarea id="mensajeAutorespuesta" class="bienestar-input bienestar-textarea" placeholder="Estoy de vacaciones y respondere pronto. Gracias por tu paciencia."></textarea>
                </div>
                <div>
                    <label class="bienestar-label">Mensaje en perfil (opcional)</label>
                    <input type="text" id="mensajePerfil" class="bienestar-input" placeholder="De vacaciones, vuelvo pronto">
                </div>
                <button type="submit" class="btn-bienestar primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>
                    Activar Modo Vacaciones
                </button>
            </form>
        }
    </div>

    <!-- Card: Alertas de Bienestar -->
    <div class="bienestar-card card-alertas">
        <div class="bienestar-card-header">
            <div class="bienestar-card-icon alertas">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                    <line x1="12" y1="9" x2="12" y2="13"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
            </div>
            <div>
                <div class="bienestar-card-title">Tu Bienestar</div>
                <div class="bienestar-card-subtitle">Recomendaciones basadas en tu actividad</div>
            </div>
        </div>

        @if (alertasBurnout.Any())
        {
            foreach (var alerta in alertasBurnout)
            {
                <div class="alerta-item @alerta.ColorClase">
                    <div class="alerta-icon @alerta.ColorClase">
                        @switch (alerta.Icono)
                        {
                            case "coffee":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" y1="2" x2="6" y2="4"/><line x1="10" y1="2" x2="10" y2="4"/><line x1="14" y1="2" x2="14" y2="4"/></svg>
                                break;
                            case "smile":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
                                break;
                            case "moon":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                                break;
                            case "zap":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                                break;
                            case "heart":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                                break;
                            default:
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                                break;
                        }
                    </div>
                    <div class="alerta-content">
                        <h4>@alerta.Titulo</h4>
                        <p>@alerta.Mensaje</p>
                        @if (!string.IsNullOrEmpty(alerta.Sugerencia))
                        {
                            <span class="alerta-sugerencia">@alerta.Sugerencia</span>
                        }
                    </div>
                </div>
            }
        }
        else
        {
            <div class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
                <p>Todo se ve bien. Sigue asi.</p>
            </div>
        }
    </div>

    <!-- Card: Celebraciones -->
    <div class="bienestar-card card-celebraciones">
        <div class="bienestar-card-header">
            <div class="bienestar-card-icon celebraciones">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="8" r="6"/>
                    <path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/>
                </svg>
            </div>
            <div>
                <div class="bienestar-card-title">Tus Logros</div>
                <div class="bienestar-card-subtitle">Celebra tus exitos</div>
            </div>
        </div>

        @if (celebraciones.Any())
        {
            foreach (var cel in celebraciones.Take(5))
            {
                <div class="celebracion-item @(cel.EsNuevo ? "nueva" : "")">
                    <div class="celebracion-icon">
                        @switch (cel.Icono)
                        {
                            case "users":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                break;
                            case "dollar-sign":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                                break;
                            case "award":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>
                                break;
                            case "edit":
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                break;
                            default:
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                break;
                        }
                    </div>
                    <div class="celebracion-content">
                        <h4>@cel.Titulo</h4>
                        <p>@cel.Mensaje</p>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <p>Sigue creando para desbloquear logros</p>
            </div>
        }
    </div>

    <!-- Card: Proyeccion de Ingresos -->
    <div class="bienestar-card card-ingresos">
        <div class="bienestar-card-header">
            <div class="bienestar-card-icon ingresos">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="1" x2="12" y2="23"/>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
            </div>
            <div>
                <div class="bienestar-card-title">Proyeccion de Ingresos</div>
                <div class="bienestar-card-subtitle">Estima tus ganancias del proximo mes</div>
            </div>
        </div>

        <div class="proyeccion-stats">
            <div class="proyeccion-stat">
                <div class="proyeccion-stat-value">$@proyeccion.IngresoProyectadoTotal.ToString("N0")</div>
                <div class="proyeccion-stat-label">Proyeccion proximo mes</div>
            </div>
            <div class="proyeccion-stat">
                <div class="proyeccion-stat-value @(proyeccion.CambioMensual >= 0 ? "positive" : "negative")">
                    @(proyeccion.CambioMensual >= 0 ? "+" : "")@proyeccion.CambioMensual%
                </div>
                <div class="proyeccion-stat-label">vs. mes anterior</div>
            </div>
            <div class="proyeccion-stat">
                <div class="proyeccion-stat-value">@proyeccion.SuscriptoresActuales</div>
                <div class="proyeccion-stat-label">Suscriptores actuales</div>
            </div>
            <div class="proyeccion-stat">
                <div class="proyeccion-stat-value">@proyeccion.ChurnRate%</div>
                <div class="proyeccion-stat-label">Tasa de cancelacion</div>
            </div>
        </div>

        <div class="proyeccion-chart">
            <canvas id="chartProyeccion"></canvas>
        </div>

        @if (proyeccion.Alertas.Any())
        {
            foreach (var alerta in proyeccion.Alertas)
            {
                <div class="proyeccion-alerta">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                    <span>@alerta</span>
                </div>
            }
        }
    </div>

    <!-- Card: Metricas de Bienestar -->
    <div class="bienestar-card card-metricas">
        <div class="bienestar-card-header">
            <div class="bienestar-card-icon metricas">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                </svg>
            </div>
            <div>
                <div class="bienestar-card-title">Tu Score de Bienestar</div>
                <div class="bienestar-card-subtitle">Balance trabajo-descanso</div>
            </div>
        </div>

        <div class="score-bienestar">
            @{
                var scoreClass = metricas.ScoreBienestar >= 80 ? "excellent" :
                                metricas.ScoreBienestar >= 60 ? "good" :
                                metricas.ScoreBienestar >= 40 ? "warning" : "alert";
            }
            <div class="score-circle @scoreClass">@metricas.ScoreBienestar</div>
            <div class="score-mensaje">@metricas.MensajeBienestar</div>
        </div>

        <div class="metricas-list">
            <div class="metrica-item">
                <span class="metrica-label">Publicaciones esta semana</span>
                <span class="metrica-value">@metricas.PublicacionesEstaSemana</span>
            </div>
            <div class="metrica-item">
                <span class="metrica-label">Dias sin descanso</span>
                <span class="metrica-value">@metricas.DiasSinDescanso dias</span>
            </div>
            <div class="metrica-item">
                <span class="metrica-label">Hora promedio publicacion</span>
                <span class="metrica-value">@metricas.HoraPromedioPublicacion:00</span>
            </div>
            <div class="metrica-item">
                <span class="metrica-label">Tasa respuesta mensajes</span>
                <span class="metrica-value">@metricas.TasaRespuestaMensajes%</span>
            </div>
            <div class="metrica-item">
                <span class="metrica-label">Dias en la plataforma</span>
                <span class="metrica-value">@metricas.DiasEnPlataforma</span>
            </div>
        </div>
    </div>

    <!-- Card: Contenido Programado -->
    <div class="bienestar-card card-programados">
        <div class="bienestar-card-header">
            <div class="bienestar-card-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
            </div>
            <div>
                <div class="bienestar-card-title">Contenido Programado</div>
                <div class="bienestar-card-subtitle">Publicaciones automaticas durante vacaciones</div>
            </div>
        </div>

        @if (contenidoProgramado.Any())
        {
            foreach (var prog in contenidoProgramado.Take(5))
            {
                <div class="programado-item">
                    @if (!string.IsNullOrEmpty(prog.ContenidoBorrador?.Thumbnail))
                    {
                        <img src="@prog.ContenidoBorrador.Thumbnail" class="programado-thumb" alt="">
                    }
                    else
                    {
                        <div class="programado-thumb"></div>
                    }
                    <div class="programado-info">
                        <div class="programado-fecha">@prog.FechaProgramada.ToString("dd/MM/yyyy HH:mm")</div>
                        <div class="programado-desc">@(prog.ContenidoBorrador?.Descripcion ?? "Sin descripcion")</div>
                    </div>
                    <button class="btn-bienestar secondary" onclick="cancelarProgramacion(@prog.Id)" title="Cancelar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
            }
        }
        else
        {
            <div class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                <p>No tienes contenido programado.</p>
                <a href="/Contenido" class="btn-bienestar secondary" style="margin-top: 12px;">
                    Ver mis borradores
                </a>
            </div>
        }
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // Toggle ayuda
    function toggleHelp() {
        const content = document.getElementById('helpContent');
        const toggle = document.getElementById('helpToggle');
        const isHidden = content.classList.toggle('hidden');
        toggle.classList.toggle('collapsed', isHidden);
        localStorage.setItem('bienestar-help-hidden', isHidden);
    }

    // Grafico de Proyeccion
    document.addEventListener('DOMContentLoaded', function() {
        // Restaurar estado de ayuda
        if (localStorage.getItem('bienestar-help-hidden') === 'true') {
            document.getElementById('helpContent').classList.add('hidden');
            document.getElementById('helpToggle').classList.add('collapsed');
        }
        const ctx = document.getElementById('chartProyeccion');
        if (ctx) {
            const historial = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(proyeccion.HistorialIngresos));

            const labels = historial.map(h => h.etiqueta);
            const valores = historial.map(h => h.valor);
            const esProyeccion = historial.map(h => h.esProyeccion);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ingresos',
                        data: valores,
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: valores.map((v, i) => esProyeccion[i] ? 6 : 4),
                        pointBackgroundColor: valores.map((v, i) => esProyeccion[i] ? '#8b5cf6' : '#22c55e'),
                        pointBorderColor: valores.map((v, i) => esProyeccion[i] ? '#8b5cf6' : '#22c55e'),
                        borderDash: [],
                        segment: {
                            borderDash: ctx2 => {
                                const idx = ctx2.p0DataIndex;
                                return esProyeccion[idx + 1] ? [5, 5] : [];
                            }
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const idx = context.dataIndex;
                                    const suffix = esProyeccion[idx] ? ' (proyectado)' : '';
                                    return '$' + value.toLocaleString() + suffix;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
    });

    // Formulario de vacaciones
    const formVacaciones = document.getElementById('formVacaciones');
    if (formVacaciones) {
        formVacaciones.addEventListener('submit', async function(e) {
            e.preventDefault();

            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;
            const mensaje = document.getElementById('mensajeAutorespuesta').value;
            const mensajePerfil = document.getElementById('mensajePerfil').value;

            if (!fechaInicio || !fechaFin) {
                alert('Por favor selecciona las fechas de inicio y fin');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('fechaInicio', fechaInicio);
                formData.append('fechaFin', fechaFin);
                formData.append('mensajeAutorespuesta', mensaje);
                formData.append('mensajePerfilPublico', mensajePerfil);

                const response = await fetch('/BienestarCreador/ConfigurarVacaciones', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    }
                });

                const data = await response.json();
                if (data.success) {
                    location.reload();
                } else {
                    alert(data.message || 'Error al activar vacaciones');
                }
            } catch (error) {
                console.error(error);
                alert('Error al procesar la solicitud');
            }
        });
    }

    async function desactivarVacaciones() {
        if (!confirm('Deseas desactivar el modo vacaciones?')) return;

        try {
            const response = await fetch('/BienestarCreador/DesactivarVacaciones', {
                method: 'POST',
                headers: {
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || '',
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Error al desactivar vacaciones');
            }
        } catch (error) {
            console.error(error);
            alert('Error al procesar la solicitud');
        }
    }

    async function cancelarProgramacion(id) {
        if (!confirm('Deseas cancelar esta programacion?')) return;

        try {
            const formData = new FormData();
            formData.append('programacionId', id);

            const response = await fetch('/BienestarCreador/CancelarProgramacion', {
                method: 'POST',
                body: formData,
                headers: {
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                }
            });

            const data = await response.json();
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Error al cancelar');
            }
        } catch (error) {
            console.error(error);
            alert('Error al procesar la solicitud');
        }
    }
</script>
