@using Microsoft.AspNetCore.Identity
@using Lado.Models
@using Lado.Data
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject ApplicationDbContext Context
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery

@{
	var usuario = await UserManager.GetUserAsync(User);

	int mensajesNoLeidos = 0;
	Lado.Models.Agencia? agenciaUsuario = null;
	if (usuario != null)
	{
		mensajesNoLeidos = Context.MensajesPrivados
			.Count(m => m.DestinatarioId == usuario.Id && !m.Leido && !m.EliminadoPorDestinatario);

		// Cargar agencia del usuario si existe y está activa
		agenciaUsuario = Context.Agencias
			.FirstOrDefault(a => a.UsuarioId == usuario.Id && a.Estado == Lado.Models.EstadoAgencia.Activa);
	}

	// Obtener versión del ensamblado
	var version = System.Reflection.Assembly.GetExecutingAssembly().GetName().Version;
	var versionString = version != null ? $"v{version.Major}.{version.Minor}.{version.Build}" : "v1.0.0";
}

<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
	<!-- iOS PWA Support -->
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<!-- PWA Manifest -->
	<link rel="manifest" href="/manifest.json">
	<meta name="theme-color" content="#4682B4">
	<link rel="apple-touch-icon" href="/images/icons/icon-192x192.png">
	<title>@ViewData["Title"] - Lado</title>

	<!-- Open Graph Meta Tags para compartir en redes sociales -->
	<meta property="og:site_name" content="Lado" />
	<meta property="og:locale" content="es_ES" />
	@if (ViewData["OgTitle"] != null)
	{
		<meta property="og:title" content="@ViewData["OgTitle"]" />
	}
	else
	{
		<meta property="og:title" content="@ViewData["Title"] - Lado" />
	}
	@if (ViewData["OgDescription"] != null)
	{
		<meta property="og:description" content="@ViewData["OgDescription"]" />
	}
	else
	{
		<meta name="description" content="Lado - Plataforma de contenido exclusivo" />
		<meta property="og:description" content="Lado - Plataforma de contenido exclusivo" />
	}
	@if (ViewData["OgImage"] != null)
	{
		<meta property="og:image" content="@ViewData["OgImage"]" />
		<meta property="og:image:width" content="1200" />
		<meta property="og:image:height" content="630" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:image" content="@ViewData["OgImage"]" />
	}
	else
	{
		<meta property="og:image" content="https://ladoapp.com/images/og-default.jpg" />
		<meta name="twitter:card" content="summary" />
	}
	@if (ViewData["OgUrl"] != null)
	{
		<meta property="og:url" content="@ViewData["OgUrl"]" />
	}
	<meta property="og:type" content="@(ViewData["OgType"] ?? "website")" />
	<meta name="twitter:title" content="@(ViewData["OgTitle"] ?? ViewData["Title"])" />
	<meta name="twitter:description" content="@(ViewData["OgDescription"] ?? "Lado - Plataforma de contenido exclusivo")" />

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="~/css/reels-creator.css" asp-append-version="true">
	<!-- iOS Safari Compatibility Fixes -->
	<link rel="stylesheet" href="~/css/ios-fixes.css" asp-append-version="true">
	<style>
		/* ========================================
		   SISTEMA DE TEMAS - MODO CLARO/OSCURO
		   ======================================== */
		:root {
			/* Colores primarios - Steel Blue */
			--primary: #4682B4;
			--primary-dark: #36648B;
			--primary-light: #B0C4DE;
			--primary-gradient: linear-gradient(135deg, #4682B4 0%, #36648B 50%, #2C5278 100%);
			--primary-glow: 0 0 20px rgba(70, 130, 180, 0.4);

			/* Colores de acento */
			--accent: #8b5cf6;
			--accent-light: #ede9fe;
			--accent-gradient: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);

			/* Colores semánticos */
			--success: #4682B4;
			--warning: #f59e0b;
			--danger: #ef4444;
			--info: #3b82f6;

			/* Modo claro - Fondos */
			--bg: #ffffff;
			--bg-secondary: #f8fafc;
			--bg-tertiary: #f1f5f9;
			--surface: #ffffff;
			--surface-hover: #f8fafc;

			/* Modo claro - Textos */
			--fg: #0f172a;
			--fg-secondary: #475569;
			--muted: #64748b;
			--muted-light: #94a3b8;

			/* Bordes y líneas */
			--line: #e2e8f0;
			--line-light: #f1f5f9;

			/* Sombras - Modo claro */
			--shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
			--shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
			--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
			--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
			--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

			/* Radios */
			--radius-xs: 6px;
			--radius-sm: 8px;
			--radius-md: 12px;
			--radius-lg: 16px;
			--radius-xl: 20px;
			--radius-2xl: 24px;

			/* Layout */
			--sidebar-width: 260px;

			/* Transiciones */
			--transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
			--transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
			--transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
		}

		/* ========================================
		   MODO OSCURO
		   ======================================== */
		[data-theme="dark"] {
			/* Fondos oscuros con profundidad */
			--bg: #0f172a;
			--bg-secondary: #1e293b;
			--bg-tertiary: #334155;
			--surface: #1e293b;
			--surface-hover: #334155;

			/* Textos claros */
			--fg: #f8fafc;
			--fg-secondary: #e2e8f0;
			--muted: #94a3b8;
			--muted-light: #64748b;

			/* Colores primarios ajustados para oscuro - Steel Blue */
			--primary: #6CA6CD;
			--primary-dark: #4682B4;
			--primary-light: rgba(108, 166, 205, 0.15);
			--primary-glow: 0 0 30px rgba(70, 130, 180, 0.4);

			/* Acentos ajustados */
			--accent: #a78bfa;
			--accent-light: rgba(167, 139, 250, 0.15);

			/* Bordes sutiles */
			--line: #334155;
			--line-light: #1e293b;

			/* Sombras para modo oscuro */
			--shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.3);
			--shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4), 0 1px 2px rgba(0, 0, 0, 0.3);
			--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.4);
			--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.4);
			--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.5);
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: var(--bg-secondary);
			color: var(--fg);
			overflow-x: hidden;
			transition: background-color var(--transition-slow), color var(--transition-slow);
		}

		/* Smooth transitions para cambio de tema */
		*, *::before, *::after {
			transition: background-color var(--transition-base),
						border-color var(--transition-base),
						box-shadow var(--transition-base);
		}

		/* ========================================
										   FIX COMPLETO DE Z-INDEX
										   ======================================== */

		/* SIDEBAR */
		.sidebar {
			position: fixed;
			left: 0;
			top: 0;
			bottom: 0;
			width: var(--sidebar-width);
			background: var(--surface);
			border-right: 1px solid var(--line);
			box-shadow: var(--shadow-lg);
			z-index: 1000 !important;
			overflow-y: auto;
			transition: transform 0.3s ease, background-color var(--transition-base);
		}

		/* Logo */
		.sidebar-brand {
			padding: 24px 20px;
			border-bottom: 1px solid var(--line);
			display: flex;
			align-items: center;
			text-decoration: none;
			background: var(--surface);
		}

		.brand {
			display: flex;
			align-items: center;
			gap: 12px;
			text-decoration: none;
			color: var(--fg);
			font-weight: 800;
			font-size: 1.5rem;
			letter-spacing: -0.02em;
			transition: transform var(--transition-base);
		}

			.brand:hover {
				transform: scale(1.02);
			}

		.brand-badge {
			width: 36px;
			height: 36px;
			border-radius: var(--radius-md);
			background: var(--primary-gradient);
			color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 700;
			font-size: 1.1rem;
			box-shadow: var(--primary-glow);
		}

		.sidebar-nav {
			padding: 16px 12px;
		}

		.nav-item {
			margin-bottom: 2px;
		}

		.nav-link {
			padding: 12px 16px;
			color: var(--muted);
			display: flex;
			align-items: center;
			transition: all var(--transition-fast);
			border-radius: var(--radius-md);
			text-decoration: none;
			font-size: 0.9375rem;
			font-weight: 500;
			margin: 0 4px;
			position: relative;
		}

			.nav-link:hover {
				background: var(--bg-tertiary);
				color: var(--fg);
			}

			.nav-link.active {
				background: var(--primary-light);
				color: var(--primary);
				font-weight: 600;
			}

			.nav-link.active::before {
				content: '';
				position: absolute;
				left: 0;
				top: 50%;
				transform: translateY(-50%);
				width: 3px;
				height: 60%;
				background: var(--primary);
				border-radius: 0 2px 2px 0;
			}

			.nav-link svg {
				width: 20px;
				height: 20px;
				margin-right: 12px;
				stroke: currentColor;
				fill: none;
				flex-shrink: 0;
			}

		.badge-notify {
			background: var(--danger);
			color: white;
			border-radius: 20px;
			padding: 2px 8px;
			font-size: 0.6875rem;
			margin-left: auto;
			font-weight: 600;
			min-width: 20px;
			text-align: center;
		}

		/* MAIN CONTENT */
		.main-content {
			margin-left: var(--sidebar-width);
			min-height: 100vh;
			transition: margin-left 0.3s ease;
			position: relative;
			z-index: 1 !important;
		}

		/* Sin sidebar para usuarios no autenticados */
		body.no-sidebar .main-content {
			margin-left: 0;
		}

		body.no-sidebar .hamburger-btn {
			display: none;
		}

		/* TOP NAVBAR - DEBE ESTAR SOBRE TODO */
		.top-navbar {
			background: var(--surface);
			box-shadow: var(--shadow-sm);
			padding: 16px 30px;
			margin-bottom: 0;
			position: sticky;
			top: 0;
			z-index: 1050 !important;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-bottom: 1px solid var(--line);
			backdrop-filter: blur(12px);
			background: rgba(var(--surface), 0.95);
		}

		[data-theme="dark"] .top-navbar {
			background: rgba(30, 41, 59, 0.95);
		}

		.hamburger-btn {
			display: none;
			background: none;
			border: none;
			padding: 8px;
			cursor: pointer;
			color: var(--muted);
			transition: color 0.2s, transform 0.1s;
			border-radius: var(--radius-sm);
			/* Fix para móviles */
			-webkit-tap-highlight-color: transparent;
			touch-action: manipulation;
			user-select: none;
			-webkit-user-select: none;
			min-width: 44px;
			min-height: 44px;
		}

			.hamburger-btn:hover {
				color: var(--primary);
				background: var(--light-bg);
			}

			.hamburger-btn:active {
				opacity: 0.7;
				transform: scale(0.95);
			}

			.hamburger-btn svg {
				width: 24px;
				height: 24px;
				stroke: currentColor;
				pointer-events: none;
			}

		.search-box {
			flex: 1;
			max-width: 480px;
			position: relative;
		}

			.search-box svg {
				position: absolute;
				left: 16px;
				top: 50%;
				transform: translateY(-50%);
				width: 18px;
				height: 18px;
				stroke: var(--muted);
				transition: stroke var(--transition-fast);
			}

			.search-box input {
				width: 100%;
				padding: 12px 16px 12px 48px;
				border: 1px solid var(--line);
				border-radius: var(--radius-lg);
				outline: none;
				transition: all var(--transition-fast);
				background: var(--bg-tertiary);
				font-family: inherit;
				font-size: 0.9375rem;
				color: var(--fg);
			}

			.search-box input::placeholder {
				color: var(--muted);
			}

				.search-box input:focus {
					border-color: var(--primary);
					box-shadow: 0 0 0 3px var(--primary-light);
					background: var(--surface);
				}

				.search-box input:focus + svg,
				.search-box:focus-within svg {
					stroke: var(--primary);
				}

		/* USER MENU */
		.user-menu {
			display: flex;
			align-items: center;
			gap: 16px;
			position: relative;
			z-index: 1055 !important;
		}

		.notification-icon {
			position: relative;
			cursor: pointer;
			padding: 8px;
			transition: all 0.2s ease;
			border-radius: var(--radius-sm);
		}

			.notification-icon:hover {
				background: var(--light-bg);
			}

			.notification-icon svg {
				width: 22px;
				height: 22px;
				stroke: var(--muted);
			}

		.notification-badge {
			position: absolute;
			top: 4px;
			right: 4px;
			background: #ef4444;
			color: white;
			border-radius: 10px;
			padding: 2px 6px;
			font-size: 10px;
			font-weight: 600;
		}

		/* ========================================
		   DROPDOWN DE NOTIFICACIONES
		   ======================================== */
		.notification-wrapper {
			position: relative;
		}

		.notifications-dropdown {
			position: absolute;
			top: calc(100% + 12px);
			right: 0;
			width: 380px;
			max-height: 500px;
			background: var(--surface);
			border: 1px solid var(--line);
			border-radius: var(--radius-lg);
			box-shadow: var(--shadow-xl);
			z-index: 1070;
			display: none;
			flex-direction: column;
			overflow: hidden;
		}

		.notifications-dropdown.active {
			display: flex;
			animation: notifSlideIn 0.2s ease;
		}

		@@keyframes notifSlideIn {
			from {
				opacity: 0;
				transform: translateY(-10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.notifications-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 16px 20px;
			border-bottom: 1px solid var(--line);
			background: var(--bg-tertiary);
		}

		.notifications-header h4 {
			margin: 0;
			font-size: 1rem;
			font-weight: 600;
			color: var(--fg);
		}

		.mark-all-read {
			background: none;
			border: none;
			color: var(--muted);
			cursor: pointer;
			padding: 6px;
			border-radius: var(--radius-sm);
			transition: all 0.2s;
		}

		.mark-all-read:hover {
			background: var(--primary-light);
			color: var(--primary);
		}

		.notifications-list {
			flex: 1;
			overflow-y: auto;
			max-height: 380px;
		}

		.notifications-loading {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 40px;
			color: var(--muted);
			gap: 12px;
		}

		.notifications-loading .spinner {
			width: 24px;
			height: 24px;
			border: 2px solid var(--line);
			border-top-color: var(--primary);
			border-radius: 50%;
			animation: spin 0.8s linear infinite;
		}

		@@keyframes spin {
			to { transform: rotate(360deg); }
		}

		.notification-item {
			display: flex;
			align-items: center;
			border-bottom: 1px solid var(--line-light);
			transition: background 0.2s;
			position: relative;
		}

		.notification-item:hover {
			background: var(--bg-tertiary);
		}

		.notification-item.unread {
			background: var(--primary-light);
		}

		.notification-item.unread:hover {
			background: rgba(70, 130, 180, 0.15);
		}

		.notification-link {
			display: flex;
			gap: 12px;
			padding: 14px 20px;
			padding-right: 45px;
			flex: 1;
			text-decoration: none;
			color: var(--fg);
			cursor: pointer;
		}

		.notification-delete {
			position: absolute;
			right: 8px;
			top: 50%;
			transform: translateY(-50%);
			width: 28px;
			height: 28px;
			border: none;
			background: transparent;
			border-radius: 50%;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			transition: all 0.2s;
		}

		.notification-delete svg {
			width: 14px;
			height: 14px;
			stroke: var(--muted);
		}

		.notification-item:hover .notification-delete {
			opacity: 1;
		}

		.notification-delete:hover {
			background: rgba(239, 68, 68, 0.1);
		}

		.notification-delete:hover svg {
			stroke: #ef4444;
		}

		.notification-avatar {
			width: 44px;
			height: 44px;
			border-radius: 50%;
			background: var(--bg-tertiary);
			display: flex;
			align-items: center;
			justify-content: center;
			flex-shrink: 0;
			overflow: hidden;
		}

		.notification-avatar img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.notification-avatar svg {
			width: 22px;
			height: 22px;
			stroke: var(--muted);
		}

		.notification-avatar.type-mensaje { background: rgba(59, 130, 246, 0.1); }
		.notification-avatar.type-mensaje svg { stroke: #3b82f6; }

		.notification-avatar.type-seguidor { background: rgba(168, 85, 247, 0.1); }
		.notification-avatar.type-seguidor svg { stroke: #a855f7; }

		.notification-avatar.type-like { background: rgba(239, 68, 68, 0.1); }
		.notification-avatar.type-like svg { stroke: #ef4444; }

		.notification-avatar.type-comentario { background: rgba(16, 185, 129, 0.1); }
		.notification-avatar.type-comentario svg { stroke: #10b981; }

		.notification-avatar.type-contenido { background: rgba(70, 130, 180, 0.1); }
		.notification-avatar.type-contenido svg { stroke: #4682B4; }

		.notification-avatar.type-pago { background: rgba(245, 158, 11, 0.1); }
		.notification-avatar.type-pago svg { stroke: #f59e0b; }

		.notification-content {
			flex: 1;
			min-width: 0;
		}

		.notification-text {
			font-size: 0.875rem;
			color: var(--fg);
			line-height: 1.4;
			margin-bottom: 4px;
		}

		.notification-text strong {
			font-weight: 600;
		}

		.notification-time {
			font-size: 0.75rem;
			color: var(--muted);
		}

		.notification-empty {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 50px 20px;
			color: var(--muted);
			text-align: center;
		}

		.notification-empty svg {
			width: 48px;
			height: 48px;
			stroke: var(--muted-light);
			margin-bottom: 12px;
		}

		.notification-empty p {
			margin: 0;
			font-size: 0.9375rem;
		}

		.notifications-footer {
			padding: 12px 20px;
			border-top: 1px solid var(--line);
			text-align: center;
			background: var(--bg-tertiary);
		}

		.notifications-footer a {
			color: var(--primary);
			font-size: 0.875rem;
			font-weight: 500;
			text-decoration: none;
		}

		.notifications-footer a:hover {
			text-decoration: underline;
		}

		@@media (max-width: 480px) {
			.notifications-dropdown {
				position: fixed;
				top: 60px;
				left: 10px;
				right: 10px;
				width: auto;
				max-height: calc(100vh - 80px);
			}
		}

		.user-avatar {
			width: 40px;
			height: 40px;
			border-radius: 50%;
			background: var(--primary-gradient);
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-weight: 600;
			cursor: pointer;
			transition: all var(--transition-fast);
			position: relative;
			z-index: 1055 !important;
			box-shadow: var(--shadow-sm);
		}

			.user-avatar:hover {
				transform: scale(1.05);
				box-shadow: var(--primary-glow);
			}

			.user-avatar img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				border-radius: 50%;
			}

		/* NAV ACTION BUTTONS (Feed, Crear) */
		.nav-action-btn {
			width: 40px;
			height: 40px;
			border-radius: var(--radius-md);
			border: none;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all var(--transition-fast);
			text-decoration: none;
			box-shadow: var(--shadow-sm);
		}

			.nav-action-btn:hover {
				transform: scale(1.08);
			}

			.nav-action-btn svg {
				width: 20px;
				height: 20px;
			}

		/* Feed Button - Outlined style */
		.feed-btn {
			background: var(--surface);
			border: 2px solid var(--primary);
			color: var(--primary);
		}

			.feed-btn:hover {
				background: var(--primary);
				color: white;
				box-shadow: var(--primary-glow);
			}

		/* Create Post Button - Same style as Feed button */
		.create-post-btn {
			background: var(--surface);
			border: 2px solid var(--primary);
			color: var(--primary);
		}

			.create-post-btn:hover {
				background: var(--primary);
				color: white;
				box-shadow: var(--primary-glow);
			}

		/* FullView Button - Same style as Feed button */
		.fullview-btn {
			background: var(--surface);
			border: 2px solid var(--primary);
			color: var(--primary);
		}

			.fullview-btn:hover {
				background: var(--primary);
				color: white;
				box-shadow: var(--primary-glow);
			}

		/* Create Reel Button - Primary gradient */
		.add-content-btn {
			background: var(--primary-gradient);
			color: white;
		}

			.add-content-btn:hover {
				box-shadow: var(--primary-glow);
				color: white;
			}

		/* THEME TOGGLE BUTTON */
		.theme-toggle {
			width: 40px;
			height: 40px;
			border-radius: var(--radius-md);
			background: var(--bg-tertiary);
			border: 1px solid var(--line);
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all var(--transition-fast);
			color: var(--muted);
		}

			.theme-toggle:hover {
				background: var(--primary-light);
				border-color: var(--primary);
				color: var(--primary);
				transform: scale(1.05);
			}

			.theme-toggle svg {
				width: 20px;
				height: 20px;
				transition: transform var(--transition-base);
			}

			.theme-toggle:hover svg {
				transform: rotate(15deg);
			}

		.theme-toggle .sun-icon { display: none; }
		.theme-toggle .moon-icon { display: block; }

		[data-theme="dark"] .theme-toggle .sun-icon { display: block; }
		[data-theme="dark"] .theme-toggle .moon-icon { display: none; }

		/* CONTENT AREA */
		.content-area {
			padding: 32px 30px;
			position: relative;
			z-index: 1 !important;
		}

		/* OVERLAY PARA MÓVIL */
		.sidebar-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.5);
			z-index: 999;
			opacity: 0;
			transition: opacity 0.3s ease;
		}

			.sidebar-overlay.active {
				opacity: 1;
			}

		/* DROPDOWN EN SIDEBAR */
		.sidebar .dropdown-menu {
			position: static !important;
			transform: none !important;
			border: none;
			box-shadow: none;
			background: transparent;
			padding-left: 36px;
			margin-top: 4px;
		}

		.sidebar .dropdown-item {
			padding: 8px 20px;
			color: var(--muted);
			border-radius: var(--radius-sm);
			transition: all 0.2s ease;
			font-size: 0.875rem;
		}

			.sidebar .dropdown-item:hover {
				background: var(--light-bg);
				color: var(--primary);
			}

		.sidebar .dropdown-toggle::after {
			float: right;
			margin-top: 8px;
		}

		/* DROPDOWN MENU TOP - DEBE ESTAR SOBRE TODO */
		.dropdown-menu {
			background: var(--surface);
			border: 1px solid var(--line);
			border-radius: var(--radius-lg);
			box-shadow: var(--shadow-xl);
			padding: 8px;
			margin-top: 8px;
			z-index: 1060 !important;
			position: absolute !important;
			min-width: 200px;
		}

			.dropdown-menu.show {
				z-index: 1060 !important;
			}

		.dropdown-item {
			padding: 10px 16px;
			border-radius: var(--radius-sm);
			font-size: 0.9375rem;
			transition: all var(--transition-fast);
			color: var(--fg);
		}

			.dropdown-item:hover {
				background: var(--bg-tertiary);
				color: var(--primary);
			}

		.dropdown-divider {
			border-color: var(--line);
			margin: 8px 0;
		}

		.user-info-dropdown {
			padding: 12px 16px;
			border-bottom: 1px solid var(--line);
			margin-bottom: 8px;
		}

		.user-info-name {
			font-weight: 600;
			color: var(--fg);
			font-size: 0.9375rem;
			margin-bottom: 2px;
		}

		.user-info-pseudo {
			font-size: 0.8125rem;
			color: var(--muted);
		}

		/* SCROLLBAR */
		.sidebar::-webkit-scrollbar {
			width: 6px;
		}

		.sidebar::-webkit-scrollbar-track {
			background: var(--light-bg);
		}

		.sidebar::-webkit-scrollbar-thumb {
			background: var(--line);
			border-radius: 3px;
		}

			.sidebar::-webkit-scrollbar-thumb:hover {
				background: var(--muted);
			}

		/* ESTILOS GLOBALES */
		.card {
			background: var(--surface);
			border: 1px solid var(--line);
			border-radius: var(--radius-lg);
			box-shadow: var(--shadow-sm);
		}

		.btn-primary {
			background: var(--primary-gradient);
			border: none;
			color: white;
			font-weight: 600;
			padding: 10px 20px;
			border-radius: var(--radius-md);
			transition: all var(--transition-fast);
		}

			.btn-primary:hover {
				background: var(--primary-dark);
				transform: translateY(-2px);
				box-shadow: var(--primary-glow);
			}

		/* FIX ADICIONAL PARA CONTENIDO DEL FEED */
		.feed-wrapper,
		.feed-container,
		.feed-main,
		.profile-wrapper {
			position: relative;
			z-index: 1 !important;
		}

		/* RESPONSIVE */
		@@media (max-width: 991px) {
			.sidebar {
				transform: translateX(-100%);
				z-index: 1100 !important;
			}

				.sidebar.active {
					transform: translateX(0);
				}

			.main-content {
				margin-left: 0;
			}

			.hamburger-btn {
				display: flex;
			}

			.top-navbar {
				padding: 12px 15px;
			}

			.search-box {
				max-width: none;
				margin: 0 10px;
			}

			.content-area {
				padding: 24px 15px;
			}

			body.sidebar-open .sidebar-overlay {
				display: block;
			}

			body.sidebar-open {
				overflow: hidden;
			}

			.sidebar-overlay {
				z-index: 1099 !important;
			}
		}

		@@media (max-width: 768px) {
			.search-box {
				display: none;
			}

			.user-menu {
				gap: 10px;
			}
		}

		@@media (max-width: 576px) {
			.sidebar-brand {
				padding: 20px 15px;
			}

			.brand {
				font-size: 1.3rem;
			}

			.brand-badge {
				width: 30px;
				height: 30px;
			}

			.nav-link {
				padding: 10px 15px;
				font-size: 0.875rem;
			}

			.top-navbar {
				padding: 10px;
			}

			.content-area {
				padding: 20px 10px;
			}
		}

		@@media (min-width: 1400px) {
			.content-area {
				max-width: 1320px;
				margin: 0 auto;
			}
		}

		.toast-notification {
			position: fixed;
			top: 80px;
			right: -500px;
			min-width: 350px;
			max-width: 450px;
			background: white;
			border-radius: 12px;
			box-shadow: 0 12px 48px rgba(0, 0, 0, 0.25);
			padding: 20px;
			display: flex;
			align-items: flex-start;
			gap: 16px;
			z-index: 999999;
			transition: right 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
		}

			.toast-notification.show {
				right: 20px;
			}

			.toast-notification.success {
				border-left: 4px solid #4682B4;
			}

			.toast-notification.error {
				border-left: 4px solid #EF4444;
			}

			.toast-notification.warning {
				border-left: 4px solid #F59E0B;
			}

		.toast-icon {
			flex-shrink: 0;
			width: 40px;
			height: 40px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.toast-notification.success .toast-icon {
			background: rgba(70, 130, 180, 0.1);
		}

		.toast-notification.error .toast-icon {
			background: rgba(239, 68, 68, 0.1);
		}

		.toast-notification.warning .toast-icon {
			background: rgba(245, 158, 11, 0.1);
		}

		.toast-content {
			flex: 1;
		}

			.toast-content h4 {
				font-size: 16px;
				font-weight: 600;
				color: #111827;
				margin: 0 0 4px 0;
			}

			.toast-content p {
				font-size: 14px;
				color: #6B7280;
				margin: 0;
				line-height: 1.4;
			}

		.toast-close {
			flex-shrink: 0;
			width: 24px;
			height: 24px;
			border: none;
			background: transparent;
			color: #9CA3AF;
			cursor: pointer;
			padding: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 4px;
			transition: all 0.2s;
		}

			.toast-close:hover {
				background: #F3F4F6;
				color: #111827;
			}

		@@media (max-width: 768px) {
			.toast-notification {
				min-width: 300px;
				max-width: 90%;
				top: 70px;
				right: -500px;
			}

				.toast-notification.show {
					right: 10px;
				}
		}

		/* ========================================
		   FIX GLOBAL: Modales Bootstrap siempre encima
		   ======================================== */
		.modal {
			z-index: 10000000 !important;
			position: fixed !important;
			top: 0 !important;
			left: 0 !important;
			width: 100% !important;
			height: 100% !important;
			pointer-events: auto !important;
		}
		.modal-backdrop {
			z-index: 9999999 !important;
			position: fixed !important;
			top: 0 !important;
			left: 0 !important;
			width: 100vw !important;
			height: 100vh !important;
		}
		.modal.show {
			display: flex !important;
			align-items: center;
			justify-content: center;
			pointer-events: auto !important;
		}
		.modal-dialog {
			pointer-events: auto !important;
			position: relative !important;
			z-index: 10000001 !important;
			margin: auto !important;
		}
		.modal-content {
			pointer-events: auto !important;
			position: relative !important;
			z-index: 10000002 !important;
		}
		.modal input,
		.modal textarea,
		.modal button,
		.modal select,
		.modal a,
		.modal label,
		.modal .form-control,
		.modal .form-select,
		.modal .btn {
			pointer-events: auto !important;
			position: relative !important;
			z-index: 10000003 !important;
		}
		/* Asegurar que el modal-body sea scrolleable si es necesario */
		.modal-body {
			pointer-events: auto !important;
			overflow-y: auto !important;
		}

	</style>

	<!-- CSRF Token para peticiones AJAX -->
	@{
		var tokens = Antiforgery.GetAndStoreTokens(ViewContext.HttpContext);
	}
	<script>
		// Token CSRF global para peticiones AJAX
		window.csrfToken = '@tokens.RequestToken';
		window.csrfHeaderName = '@tokens.HeaderName';

		// Helper para hacer peticiones POST con CSRF
		window.fetchWithCsrf = async function(url, options = {}) {
			const defaultOptions = {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'@tokens.HeaderName': '@tokens.RequestToken'
				}
			};
			const mergedOptions = {
				...defaultOptions,
				...options,
				headers: {
					...defaultOptions.headers,
					...(options.headers || {})
				}
			};
			return fetch(url, mergedOptions);
		};
	</script>
</head>
<body class="@(User.Identity?.IsAuthenticated != true ? "no-sidebar" : "")">
	@if (User.Identity?.IsAuthenticated == true)
	{
		<div class="sidebar-overlay" id="sidebarOverlay"></div>
	<script>
	(function(){
		var o = document.getElementById('sidebarOverlay');
		if (!o) return;
		function close(e) {
			if (e) { e.preventDefault(); }
			var s = document.getElementById('sidebar');
			if (s) s.classList.remove('active');
			o.classList.remove('active');
			document.body.classList.remove('sidebar-open');
		}
		o.addEventListener('click', close);
		o.addEventListener('touchstart', close, {passive: false});
	})();
	</script>

		<!-- SIDEBAR -->
		<div class="sidebar" id="sidebar">
		<div class="sidebar-brand" style="display: flex; flex-direction: column; align-items: center; padding: 20px 12px; position: relative;">
			<a href="/Feed" class="brand">
				<img src="/images/logo.png" alt="Lado" style="height: 96px; width: auto; border-radius: 8px;">
			</a>
			<span style="position: absolute; bottom: 8px; right: 12px; font-size: 10px; color: var(--muted); font-weight: 500; letter-spacing: 0.5px;">@versionString</span>
		</div>

		<nav class="sidebar-nav">
			<ul class="nav flex-column">
				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Dashboard" ? "active" : "")" href="/Dashboard">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
							<polyline points="9 22 9 12 15 12 15 22"></polyline>
						</svg>
						@Localizer.Get("Nav_Dashboard")
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Feed" && ViewContext.RouteData.Values["action"]?.ToString() == "Index" ? "active" : "")" href="/Feed">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path>
							<circle cx="12" cy="12" r="3"></circle>
						</svg>
						@Localizer.Get("Nav_Feed")
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Feed" && ViewContext.RouteData.Values["action"]?.ToString() == "Explorar" ? "active" : "")" href="/Feed/Explorar">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="11" cy="11" r="8"></circle>
							<path d="m21 21-4.35-4.35"></path>
						</svg>
						@Localizer.Get("Nav_Explore")
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Feed" && ViewContext.RouteData.Values["action"]?.ToString() == "MisFavoritos" ? "active" : "")" href="/Feed/MisFavoritos">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
						</svg>
						@Localizer.Get("Nav_Favorites")
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Contenido" ? "active" : "")" href="/Contenido">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
							<circle cx="8.5" cy="8.5" r="1.5"></circle>
							<polyline points="21 15 16 10 5 21"></polyline>
						</svg>
						@Localizer.Get("Nav_MyContent")
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Mensajes" ? "active" : "")" href="/Mensajes">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
						</svg>
						@Localizer.Get("Nav_Messages")
						@if (mensajesNoLeidos > 0)
						{
							<span class="badge-notify">@mensajesNoLeidos</span>
						}
					</a>
				</li>

				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle @(ViewContext.RouteData.Values["controller"]?.ToString() == "Desafios" ? "active" : "")"
					   href="#"
					   id="desafiosDropdown"
					   role="button"
					   data-bs-toggle="dropdown"
					   aria-expanded="false">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
							<path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
							<path d="M4 22h16"></path>
							<path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
							<path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
							<path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
						</svg>
						@Localizer.Get("Nav_Challenges")
					</a>
					<ul class="dropdown-menu" aria-labelledby="desafiosDropdown">
						<li><a class="dropdown-item" href="/Desafios/FeedPublico">@Localizer.Get("Challenge_PublicFeed")</a></li>
						<li><a class="dropdown-item" href="/Desafios/MisDesafios">@Localizer.Get("Challenge_MyChallenges")</a></li>
						<li><a class="dropdown-item" href="/Desafios/DesafiosRecibidos">@Localizer.Get("Challenge_Received")</a></li>
						<li><a class="dropdown-item" href="/Desafios/MisPropuestas">@Localizer.Get("Challenge_MyProposals")</a></li>
					</ul>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "MisSuscripciones" ? "active" : "")" href="/Suscripciones/MisSuscripciones">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
							<circle cx="9" cy="7" r="4"></circle>
							<path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
							<path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
						</svg>
						@Localizer.Get("Nav_Subscriptions")
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Billetera" ? "active" : "")" href="/Billetera">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"></path>
							<path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"></path>
						</svg>
						@Localizer.Get("Nav_Wallet")
						@if (usuario != null && usuario.Saldo > 0)
						{
							<span class="badge-notify" style="background: var(--primary);">$@usuario.Saldo.ToString("N0")</span>
						}
					</a>
				</li>

				@if (agenciaUsuario != null)
				{
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle @(ViewContext.RouteData.Values["controller"]?.ToString() == "Agencia" ? "active" : "")"
					   href="#"
					   id="agenciaDropdown"
					   role="button"
					   data-bs-toggle="dropdown"
					   aria-expanded="false">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
							<polyline points="9 22 9 12 15 12 15 22"></polyline>
						</svg>
						@Localizer.Get("Nav_MyAgency")
						<span class="badge-notify" style="background: var(--primary);">$@agenciaUsuario.SaldoPublicitario.ToString("N0")</span>
					</a>
					<ul class="dropdown-menu" aria-labelledby="agenciaDropdown">
						<li><a class="dropdown-item" href="/Agencia">@Localizer.Get("Nav_Dashboard")</a></li>
						<li><a class="dropdown-item" href="/Agencia/Anuncios">@Localizer.Get("Agency_MyAds")</a></li>
						<li><a class="dropdown-item" href="/Agencia/CrearAnuncio">@Localizer.Get("Agency_CreateAd")</a></li>
						<li><a class="dropdown-item" href="/Agencia/RecargarSaldo">@Localizer.Get("Agency_Recharge")</a></li>
					</ul>
				</li>
				}

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Estadisticas" ? "active" : "")" href="/Usuario/Estadisticas">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M3 3v18h18"></path>
							<path d="m19 9-5 5-4-4-3 3"></path>
						</svg>
						@Localizer.Get("Nav_Statistics")
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Configuracion" ? "active" : "")" href="/Usuario/Configuracion">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="3"></circle>
							<path d="M12 1v6m0 6v6m5.2-12.8 4.2-4.2m-4.2 4.2-4.2-4.2m0 4.2L8.8 6M6 6l4.2 4.2M1 12h6m6 0h6m-12.8 5.2-4.2 4.2m4.2-4.2L6 18m12.2-1.8 4.2 4.2m-4.2-4.2L18 18"></path>
						</svg>
						@Localizer.Get("Nav_Settings")
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Ayuda" ? "active" : "")" href="/Ayuda">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="10"></circle>
							<path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
							<line x1="12" y1="17" x2="12.01" y2="17"></line>
						</svg>
						@Localizer.Get("Nav_Help")
					</a>
				</li>

				<li class="nav-item mt-3">
					<a class="nav-link" href="/Account/Logout">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
							<polyline points="16 17 21 12 16 7"></polyline>
							<line x1="21" y1="12" x2="9" y2="12"></line>
						</svg>
						@Localizer.Get("Nav_Logout")
					</a>
				</li>
			</ul>
		</nav>
	</div>
	}

	<!-- MAIN CONTENT -->
	<div class="main-content">
		<div class="top-navbar">
			<button class="hamburger-btn" aria-label="Toggle menu" id="hamburgerBtn">
				<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<line x1="3" y1="12" x2="21" y2="12"></line>
					<line x1="3" y1="6" x2="21" y2="6"></line>
					<line x1="3" y1="18" x2="21" y2="18"></line>
				</svg>
			</button>
			<script>
			(function(){
				var btn = document.getElementById('hamburgerBtn');
				if (!btn) return;
				function toggle(e) {
					if (e) { e.preventDefault(); e.stopPropagation(); }
					var s = document.getElementById('sidebar');
					var o = document.querySelector('.sidebar-overlay');
					if (s) s.classList.toggle('active');
					if (o) o.classList.toggle('active');
					document.body.classList.toggle('sidebar-open');
				}
				btn.addEventListener('click', toggle);
				btn.addEventListener('touchstart', function(e) {
					e.preventDefault();
					toggle();
				}, {passive: false});
			})();
			</script>

			<div class="search-box">
				<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<circle cx="11" cy="11" r="8"></circle>
					<path d="m21 21-4.35-4.35"></path>
				</svg>
				<input type="text" class="form-control" placeholder="@Localizer.Get("Nav_Search")">
			</div>

			<div class="user-menu">
				<!-- Feed Button -->
				<a href="/Feed" class="nav-action-btn feed-btn" title="@Localizer.Get("Nav_Feed")">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
						<polyline points="9 22 9 12 15 12 15 22"></polyline>
					</svg>
				</a>

				<!-- FullView Button - Abre vista fullscreen estilo TikTok/Reels -->
				<button type="button" onclick="abrirFullView()" class="nav-action-btn fullview-btn" title="FullView">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<rect x="2" y="2" width="20" height="20" rx="2"></rect>
						<path d="M9 9l6 3-6 3V9z"></path>
					</svg>
				</button>

				<!-- Crear Post Button - Goes to /Contenido/Crear (blanco) -->
				<a href="/Contenido/Crear" class="nav-action-btn create-post-btn" title="Crear Post">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
						<line x1="12" y1="8" x2="12" y2="16"></line>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg>
				</a>

				<!-- Crear Reel Button - Opens Reels Creator (color) -->
				<button type="button" onclick="abrirCreadorReels()" class="nav-action-btn add-content-btn" title="Crear Reel">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
						<line x1="12" y1="8" x2="12" y2="16"></line>
						<line x1="8" y1="12" x2="16" y2="12"></line>
					</svg>
				</button>

				<!-- Theme Toggle -->
				<button type="button" class="theme-toggle" id="themeToggleBtn" aria-label="@Localizer.Get("Settings_Theme")">
					<svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
					</svg>
					<svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<circle cx="12" cy="12" r="5"></circle>
						<line x1="12" y1="1" x2="12" y2="3"></line>
						<line x1="12" y1="21" x2="12" y2="23"></line>
						<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
						<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
						<line x1="1" y1="12" x2="3" y2="12"></line>
						<line x1="21" y1="12" x2="23" y2="12"></line>
						<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
						<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
					</svg>
				</button>

				<div class="notification-wrapper">
					<div class="notification-icon" onclick="toggleNotificaciones()" id="notificationBell">
						<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
							<path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
						</svg>
						<span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
					</div>
					<!-- Dropdown de Notificaciones -->
					<div class="notifications-dropdown" id="notificationsDropdown">
						<div class="notifications-header">
							<h4>Notificaciones</h4>
							<button type="button" class="mark-all-read" onclick="marcarTodasLeidas()" title="Marcar todas como leídas">
								<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
									<polyline points="9 11 12 14 22 4"></polyline>
									<path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
								</svg>
							</button>
						</div>
						<div class="notifications-list" id="notificationsList">
							<div class="notifications-loading">
								<div class="spinner"></div>
								<span>Cargando...</span>
							</div>
						</div>
						<div class="notifications-footer">
							<a href="/Usuario/Notificaciones">Ver todas las notificaciones</a>
						</div>
					</div>
				</div>

				<div class="dropdown">
					<div class="user-avatar" data-bs-toggle="dropdown" aria-expanded="false">
						@if (!string.IsNullOrEmpty(usuario?.FotoPerfil))
						{
							<img src="@usuario.FotoPerfil" alt="@usuario.NombreCompleto">
						}
						else
						{
							<span>@(usuario?.NombreCompleto?.Substring(0, 1).ToUpper() ?? "U")</span>
						}
					</div>
					<ul class="dropdown-menu dropdown-menu-end">
						@if (usuario != null)
						{
							<li class="user-info-dropdown">
								<div class="user-info-name">@usuario.NombreCompleto</div>
								<div class="user-info-pseudo">@@@usuario.UserName</div>
							</li>
						}
						<li><a class="dropdown-item" href="/Usuario/Perfil/@usuario?.Id">@Localizer.Get("Profile_MyProfile")</a></li>
						<li><a class="dropdown-item" href="/Usuario/Configuracion">@Localizer.Get("Nav_Settings")</a></li>
						<li><hr class="dropdown-divider"></li>
						<li><a class="dropdown-item" href="/Account/Logout">@Localizer.Get("Nav_Logout")</a></li>
					</ul>
				</div>
			</div>
		</div>

		<div class="content-area">
			@RenderBody()
		</div>
	</div>

	<!-- Toast Notification Global -->
	<div class="toast-notification" id="toastNotification">
		<div class="toast-icon" id="toastIcon"></div>
		<div class="toast-content">
			<h4 id="toastTitle">Título</h4>
			<p id="toastMessage">Mensaje</p>
		</div>
		<button type="button" class="toast-close" id="toastClose">
			<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
				<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
			</svg>
		</button>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<!-- iOS Audio/Video Compatibility Fix -->
	<script src="~/js/ios-audio-fix.js" asp-append-version="true"></script>

	<!-- FIX GLOBAL: Asegurar que todos los modales Bootstrap funcionen correctamente -->
	<script>
	(function() {
		// Esperar a que el DOM esté listo
		document.addEventListener('DOMContentLoaded', function() {
			// Mover todos los modales al body para evitar problemas de stacking context
			var modales = document.querySelectorAll('.modal');
			modales.forEach(function(modal) {
				if (modal.parentElement !== document.body) {
					document.body.appendChild(modal);
				}
			});

			// Configurar cada modal para asegurar interactividad
			modales.forEach(function(modal) {
				// Cuando el modal se muestra
				modal.addEventListener('show.bs.modal', function() {
					// Eliminar cualquier estilo inline que pueda interferir
					document.body.style.overflow = 'hidden';
					document.body.style.paddingRight = '0px';
				});

				modal.addEventListener('shown.bs.modal', function() {
					// Asegurar que el modal sea interactivo
					this.style.pointerEvents = 'auto';
					this.style.display = 'block';

					var dialog = this.querySelector('.modal-dialog');
					var content = this.querySelector('.modal-content');

					if (dialog) {
						dialog.style.pointerEvents = 'auto';
						dialog.style.transform = 'none';
					}
					if (content) {
						content.style.pointerEvents = 'auto';
					}

					// Asegurar que todos los inputs sean interactivos
					var inputs = this.querySelectorAll('input, select, textarea, button');
					inputs.forEach(function(input) {
						input.style.pointerEvents = 'auto';
					});

					// Enfocar el primer input
					var primerInput = this.querySelector('input:not([type="hidden"]), select, textarea');
					if (primerInput) {
						setTimeout(function() { primerInput.focus(); }, 100);
					}
				});

				modal.addEventListener('hidden.bs.modal', function() {
					document.body.style.overflow = '';
					document.body.style.paddingRight = '';
				});
			});
		});

		// También manejar modales que se agreguen dinámicamente
		var observer = new MutationObserver(function(mutations) {
			mutations.forEach(function(mutation) {
				mutation.addedNodes.forEach(function(node) {
					if (node.nodeType === 1 && node.classList && node.classList.contains('modal')) {
						if (node.parentElement !== document.body) {
							document.body.appendChild(node);
						}
					}
				});
			});
		});

		observer.observe(document.documentElement, { childList: true, subtree: true });
	})();
	</script>

	<script>
		// ========================================
		// THEME TOGGLE - Modo Oscuro/Claro
		// Compatible con Safari/iOS (modo privado incluido)
		// ========================================

		// Función segura para acceder a storage (localStorage o sessionStorage fallback)
		const ThemeStorage = {
			_storage: null,
			_memoryFallback: {},

			init: function() {
				// Intentar localStorage primero
				try {
					const test = '__storage_test__';
					localStorage.setItem(test, test);
					localStorage.removeItem(test);
					this._storage = localStorage;
					return;
				} catch (e) {
					// localStorage no disponible (Safari privado)
				}

				// Intentar sessionStorage como fallback
				try {
					const test = '__storage_test__';
					sessionStorage.setItem(test, test);
					sessionStorage.removeItem(test);
					this._storage = sessionStorage;
					return;
				} catch (e) {
					// sessionStorage tampoco disponible
				}

				// Usar memoria como último recurso
				this._storage = null;
			},

			getItem: function(key) {
				if (this._storage) {
					try {
						return this._storage.getItem(key);
					} catch (e) {
						return this._memoryFallback[key] || null;
					}
				}
				return this._memoryFallback[key] || null;
			},

			setItem: function(key, value) {
				if (this._storage) {
					try {
						this._storage.setItem(key, value);
						return;
					} catch (e) {
						// Fallback a memoria
					}
				}
				this._memoryFallback[key] = value;
			}
		};

		// Inicializar storage
		ThemeStorage.init();

		// Aplicar tema guardado al cargar
		(function() {
			const savedTheme = ThemeStorage.getItem('theme') || 'light';
			document.documentElement.setAttribute('data-theme', savedTheme);
		})();

		function toggleTheme() {
			const html = document.documentElement;
			const currentTheme = html.getAttribute('data-theme') || 'light';
			const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

			// Aplicar el nuevo tema inmediatamente
			html.setAttribute('data-theme', newTheme);

			// Guardar preferencia
			ThemeStorage.setItem('theme', newTheme);

			// Forzar repaint en iOS (fix para algunos dispositivos)
			html.style.display = 'none';
			html.offsetHeight; // Trigger reflow
			html.style.display = '';
		}

		// Agregar event listener robusto para el toggle de tema
		(function() {
			let isToggling = false;

			function setupThemeToggle() {
				const themeBtn = document.getElementById('themeToggleBtn');
				if (!themeBtn) return;

				// Solo usar click - es el más confiable cross-browser
				themeBtn.addEventListener('click', function(e) {
					e.preventDefault();

					// Prevenir doble ejecución
					if (isToggling) return;
					isToggling = true;

					toggleTheme();

					// Reset flag después de un pequeño delay
					setTimeout(() => { isToggling = false; }, 100);
				});

				// CSS para evitar delay en móviles
				themeBtn.style.touchAction = 'manipulation';
			}

			// Ejecutar cuando el DOM esté listo
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', setupThemeToggle);
			} else {
				setupThemeToggle();
			}
		})();

		function toggleSidebar(e) {
			if (e) {
				e.preventDefault();
				e.stopPropagation();
			}
			const sidebar = document.getElementById('sidebar');
			const overlay = document.querySelector('.sidebar-overlay');
			const body = document.body;

			sidebar.classList.toggle('active');
			overlay.classList.toggle('active');
			body.classList.toggle('sidebar-open');
		}


		document.querySelectorAll('.sidebar .nav-link').forEach(link => {
			link.addEventListener('click', function() {
				if (window.innerWidth <= 991) {
					toggleSidebar();
				}
			});
		});

		window.addEventListener('resize', function() {
			if (window.innerWidth > 991) {
				const sidebar = document.getElementById('sidebar');
				const overlay = document.querySelector('.sidebar-overlay');
				const body = document.body;

				sidebar.classList.remove('active');
				overlay.classList.remove('active');
				body.classList.remove('sidebar-open');
			}
		});

		const sidebarBodyObserver = new MutationObserver(function(mutations) {
			mutations.forEach(function(mutation) {
				if (mutation.attributeName === 'class') {
					const body = mutation.target;
					if (body.classList.contains('sidebar-open')) {
						body.style.overflow = 'hidden';
					} else {
						body.style.overflow = '';
					}
				}
			});
		});

		sidebarBodyObserver.observe(document.body, {
			attributes: true
		});

		// Fix adicional para asegurar que dropdowns funcionen
		document.addEventListener('DOMContentLoaded', function() {
			const navbar = document.querySelector('.top-navbar');
			if (navbar) {
				navbar.style.zIndex = '1050';
			}

			const userMenu = document.querySelector('.user-menu');
			if (userMenu) {
				userMenu.style.zIndex = '1055';
			}
		});

		// Fix para cuando se abre el dropdown
		document.addEventListener('shown.bs.dropdown', function(event) {
			const dropdown = event.target.querySelector('.dropdown-menu');
			if (dropdown) {
				dropdown.style.zIndex = '1060';
			}
		});

		// ========================================
		// SISTEMA DE NOTIFICACIONES
		// ========================================
		let notificacionesDropdownAbierto = false;

		function toggleNotificaciones() {
			const dropdown = document.getElementById('notificationsDropdown');
			const bell = document.getElementById('notificationBell');

			notificacionesDropdownAbierto = !notificacionesDropdownAbierto;

			if (notificacionesDropdownAbierto) {
				dropdown.classList.add('active');
				bell.style.color = 'var(--primary)';
				// Siempre recargar al abrir para mostrar nuevas notificaciones
				cargarNotificaciones();
			} else {
				dropdown.classList.remove('active');
				bell.style.color = '';
			}
		}

		// Cerrar dropdown al hacer clic fuera
		document.addEventListener('click', function(e) {
			const wrapper = document.querySelector('.notification-wrapper');
			if (wrapper && !wrapper.contains(e.target)) {
				const dropdown = document.getElementById('notificationsDropdown');
				const bell = document.getElementById('notificationBell');
				if (dropdown && dropdown.classList.contains('active')) {
					dropdown.classList.remove('active');
					bell.style.color = '';
					notificacionesDropdownAbierto = false;
				}
			}
		});

		async function cargarNotificaciones() {
			const lista = document.getElementById('notificationsList');

			// Mostrar loading mientras carga
			lista.innerHTML = `
				<div class="notification-empty">
					<div class="spinner-border spinner-border-sm" role="status"></div>
					<p>Cargando...</p>
				</div>
			`;

			try {
				const response = await fetch('/Usuario/ObtenerNotificaciones');
				const data = await response.json();

				if (data.success && data.notificaciones && data.notificaciones.length > 0) {
					lista.innerHTML = data.notificaciones.map(n => renderizarNotificacion(n)).join('');
					// Actualizar badge
					actualizarBadgeNotificaciones(data.noLeidas || 0);
				} else if (data.success) {
					lista.innerHTML = `
						<div class="notification-empty">
							<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
								<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
								<path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
							</svg>
							<p>No tienes notificaciones</p>
						</div>
					`;
					actualizarBadgeNotificaciones(0);
				} else {
					console.error('Error del servidor:', data.message);
					lista.innerHTML = `
						<div class="notification-empty">
							<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
								<circle cx="12" cy="12" r="10"></circle>
								<line x1="12" y1="8" x2="12" y2="12"></line>
								<line x1="12" y1="16" x2="12.01" y2="16"></line>
							</svg>
							<p>No tienes notificaciones</p>
						</div>
					`;
				}
			} catch (error) {
				console.error('Error cargando notificaciones:', error);
				lista.innerHTML = `
					<div class="notification-empty">
						<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
							<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
							<path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
						</svg>
						<p>No tienes notificaciones</p>
					</div>
				`;
			}
		}

		function renderizarNotificacion(n) {
			const tipoClase = obtenerClaseTipo(n.tipo);
			const iconoSvg = obtenerIconoTipo(n.tipo);
			const unreadClass = n.leida ? '' : 'unread';

			const avatarHtml = n.imagenUrl
				? `<img src="${n.imagenUrl}" alt="">`
				: iconoSvg;

			return `
				<div class="notification-item ${unreadClass}" data-id="${n.id}">
					<a href="${n.urlDestino || '#'}" class="notification-link"
					   onclick="marcarNotificacionLeida(${n.id}, event)">
						<div class="notification-avatar ${tipoClase}">
							${avatarHtml}
						</div>
						<div class="notification-content">
							<div class="notification-text">${n.mensaje}</div>
							<div class="notification-time">${n.tiempoRelativo}</div>
						</div>
					</a>
					<button class="notification-delete" onclick="eliminarNotificacion(${n.id}, event)" title="Eliminar">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<line x1="18" y1="6" x2="6" y2="18"></line>
							<line x1="6" y1="6" x2="18" y2="18"></line>
						</svg>
					</button>
				</div>
			`;
		}

		function obtenerClaseTipo(tipo) {
			const clases = {
				0: 'type-mensaje',      // NuevoMensaje
				1: 'type-seguidor',     // NuevoSeguidor
				2: 'type-contenido',    // NuevoContenido
				3: 'type-like',         // NuevoLike
				4: 'type-comentario',   // NuevoComentario
				5: 'type-seguidor',     // NuevaSuscripcion
				6: 'type-contenido',    // NuevoDesafio
				7: 'type-contenido',    // PropuestaDesafio
				8: 'type-pago',         // PagoRecibido
				9: 'type-pago',         // RetiroCompletado
				10: 'type-contenido'    // Sistema
			};
			return clases[tipo] || '';
		}

		function obtenerIconoTipo(tipo) {
			const iconos = {
				0: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',
				1: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>',
				2: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>',
				3: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
				4: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',
				5: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',
				6: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>',
				7: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>',
				8: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>',
				9: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>',
				10: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'
			};
			return iconos[tipo] || iconos[10];
		}

		async function marcarNotificacionLeida(id, event) {
			// No prevenir navegación, solo marcar como leída
			try {
				await fetch('/Usuario/MarcarNotificacionLeida', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ notificacionId: id })
				});

				// Marcar visualmente como leída (buscar el contenedor padre)
				const item = document.querySelector(`.notification-item[data-id="${id}"]`);
				if (item && item.classList.contains('unread')) {
					item.classList.remove('unread');

					// Actualizar badge
					const badge = document.getElementById('notificationBadge');
					let count = parseInt(badge.textContent) || 0;
					if (count > 0) {
						actualizarBadgeNotificaciones(count - 1);
					}
				}
			} catch (error) {
				console.error('Error marcando notificación:', error);
			}
		}

		async function marcarTodasLeidas() {
			try {
				const response = await fetch('/Usuario/MarcarTodasLeidas', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' }
				});

				const data = await response.json();

				if (data.success) {
					// Quitar clase unread de todas las notificaciones
					document.querySelectorAll('.notification-item.unread').forEach(item => {
						item.classList.remove('unread');
					});

					// Actualizar badge
					actualizarBadgeNotificaciones(0);

					if (window.showToast) {
						showToast('success', 'Listo', 'Todas las notificaciones marcadas como leídas');
					}
				}
			} catch (error) {
				console.error('Error marcando todas:', error);
			}
		}

		async function eliminarNotificacion(id, event) {
			event.preventDefault();
			event.stopPropagation();

			const item = document.querySelector(`.notification-item[data-id="${id}"]`);
			if (!item) return;

			// Animación de salida
			item.style.transition = 'all 0.3s ease';
			item.style.opacity = '0';
			item.style.transform = 'translateX(100%)';

			try {
				// Enviar como FormData con token antiforgery
				const formData = new FormData();
				formData.append('NotificacionId', id);
				const token = document.querySelector('input[name="__RequestVerificationToken"]')?.value;
				if (token) {
					formData.append('__RequestVerificationToken', token);
				}

				const response = await fetch('/Usuario/EliminarNotificacion', {
					method: 'POST',
					body: formData
				});

				const data = await response.json();

				if (data.success) {
					// Si la notificación no estaba leída, actualizar badge
					if (item.classList.contains('unread')) {
						const badge = document.getElementById('notificationBadge');
						let count = parseInt(badge.textContent) || 0;
						if (count > 0) {
							actualizarBadgeNotificaciones(count - 1);
						}
					}

					// Remover del DOM después de la animación
					setTimeout(() => {
						item.remove();
						// Si no quedan notificaciones, mostrar mensaje vacío
						const lista = document.getElementById('notificationsList');
						if (!lista.querySelector('.notification-item')) {
							lista.innerHTML = `
								<div class="notification-empty">
									<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5">
										<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
										<path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
									</svg>
									<p>No tienes notificaciones</p>
								</div>
							`;
						}
					}, 300);
				} else {
					// Revertir animación si falla
					item.style.opacity = '1';
					item.style.transform = 'translateX(0)';
				}
			} catch (error) {
				console.error('Error eliminando notificación:', error);
				item.style.opacity = '1';
				item.style.transform = 'translateX(0)';
			}
		}

		function actualizarBadgeNotificaciones(count) {
			const badge = document.getElementById('notificationBadge');
			if (badge) {
				if (count > 0) {
					badge.textContent = count > 99 ? '99+' : count;
					badge.style.display = 'block';
				} else {
					badge.style.display = 'none';
				}
			}
		}

		// Cargar contador de notificaciones al iniciar
		async function cargarContadorNotificaciones() {
			try {
				const response = await fetch('/Usuario/ContarNotificacionesNoLeidas');
				const data = await response.json();
				actualizarBadgeNotificaciones(data.count || 0);
			} catch (error) {
				console.error('Error cargando contador:', error);
			}
		}

		// Actualizar contador cada 30 segundos
		document.addEventListener('DOMContentLoaded', function() {
			cargarContadorNotificaciones();
			setInterval(cargarContadorNotificaciones, 30000);
		});


			// Script Toast Global - Ejecutar al cargar la página
			document.addEventListener('DOMContentLoaded', function() {
				const toastNotification = document.getElementById('toastNotification');
				const toastIcon = document.getElementById('toastIcon');
				const toastTitle = document.getElementById('toastTitle');
				const toastMessage = document.getElementById('toastMessage');
				const toastClose = document.getElementById('toastClose');

				// Función global para mostrar toast
				window.showToast = function(type, title, message) {
					console.log('🔔 Toast Global:', type, title, message);

					// Forzar reinicio
					toastNotification.classList.remove('show');

					setTimeout(() => {
						// Ocultar título si está vacío
						if (title && title.trim() !== '') {
							toastTitle.textContent = title;
							toastTitle.style.display = 'block';
						} else {
							toastTitle.textContent = '';
							toastTitle.style.display = 'none';
						}
						toastMessage.textContent = message || '';

						// Limpiar clases
						toastNotification.className = 'toast-notification';
						toastIcon.innerHTML = '';

						if (type === 'success') {
							toastNotification.classList.add('success');
							toastIcon.innerHTML = `
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2.5">
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
							`;
						} else if (type === 'error') {
							toastNotification.classList.add('error');
							toastIcon.innerHTML = `
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2.5">
									<line x1="18" y1="6" x2="6" y2="18"></line>
									<line x1="6" y1="6" x2="18" y2="18"></line>
								</svg>
							`;
						} else if (type === 'warning') {
							toastNotification.classList.add('warning');
							toastIcon.innerHTML = `
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2.5">
									<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
									<line x1="12" y1="9" x2="12" y2="13"></line>
									<line x1="12" y1="17" x2="12.01" y2="17"></line>
								</svg>
							`;
						}

						toastNotification.classList.add('show');

						// Auto-cerrar después de 5 segundos
						setTimeout(() => {
							toastNotification.classList.remove('show');
						}, 5000);
					}, 100);
				};

				// Cerrar manualmente
				toastClose.addEventListener('click', () => {
					toastNotification.classList.remove('show');
				});

				// Verificar TempData al cargar
		@if (TempData["Success"] != null)
		{
			<text>showToast('success', '¡Éxito!', @System.Text.Json.JsonSerializer.Serialize(TempData["Success"]?.ToString() ?? ""));</text>
		}
		@if (TempData["Error"] != null)
		{
			<text>showToast('error', 'Error', @System.Text.Json.JsonSerializer.Serialize(TempData["Error"]?.ToString() ?? ""));</text>
		}
		@if (TempData["Warning"] != null)
		{
			<text>showToast('warning', 'Aviso', @System.Text.Json.JsonSerializer.Serialize(TempData["Warning"]?.ToString() ?? ""));</text>
		}
		@if (TempData["Info"] != null)
		{
			<text>showToast('success', 'Información', @System.Text.Json.JsonSerializer.Serialize(TempData["Info"]?.ToString() ?? ""));</text>
		}

			});

	</script>

	@await RenderSectionAsync("Scripts", required: false)

	<!-- Reels Creator Scripts -->
	@if (SignInManager.IsSignedIn(User))
	{
		<!-- Configuración del usuario para el Creador de Reels -->
		<script>
			window.reelsCreatorConfig = {
				esCreadorVerificado: @((usuario?.CreadorVerificado ?? false).ToString().ToLower()),
				seudonimo: '@(usuario?.Seudonimo ?? "")',
				nombreCompleto: '@(usuario?.NombreCompleto ?? "")'
			};
		</script>
		<!-- Hammer.js para gestos táctiles -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<!-- Reels Creator Modules -->
		<script src="~/js/reels/FilterEngine.js" asp-append-version="true"></script>
		<script src="~/js/reels/ExportManager.js" asp-append-version="true"></script>
		<script src="~/js/reels/VideoEditor.js" asp-append-version="true"></script>
		<script src="~/js/reels/LayerManager.js" asp-append-version="true"></script>
		<script src="~/js/reels/TextLayer.js" asp-append-version="true"></script>
		<script src="~/js/reels/StickerLayer.js" asp-append-version="true"></script>
		<script src="~/js/reels/DrawingCanvas.js" asp-append-version="true"></script>
		<script src="~/js/reels/AudioMixer.js" asp-append-version="true"></script>
		<script src="~/js/reels/MobileOptimizer.js" asp-append-version="true"></script>
		<script src="~/js/reels/TouchGestures.js" asp-append-version="true"></script>
		<script src="~/js/reels/CameraCapture.js" asp-append-version="true"></script>
		<script src="~/js/reels/FileUpload.js" asp-append-version="true"></script>
		<script src="~/js/reels/MemeMode.js" asp-append-version="true"></script>
		<script src="~/js/reels/TransformTools.js" asp-append-version="true"></script>
		<script src="~/js/reels/DraggablePanel.js" asp-append-version="true"></script>
		<script src="~/js/reels/ReelsCreator.js" asp-append-version="true"></script>
	}

	<!-- ========================================
	     POPUP BETA - ADVERTENCIA
	     ======================================== -->
	<div id="betaPopupOverlay" class="beta-popup-overlay">
		<div class="beta-popup">
			<button class="beta-popup-close" onclick="closeBetaPopup()" aria-label="Cerrar">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<line x1="18" y1="6" x2="6" y2="18"></line>
					<line x1="6" y1="6" x2="18" y2="18"></line>
				</svg>
			</button>

			<div class="beta-popup-icon">
				<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="1.5">
					<path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
				</svg>
			</div>

			<h3 class="beta-popup-title">LADO está en fase Beta</h3>

			<div class="beta-popup-content">
				<div class="beta-info-item">
					<div class="beta-info-icon safe">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
							<polyline points="9 12 11 14 15 10"/>
						</svg>
					</div>
					<div class="beta-info-text">
						<strong>Tu contenido está seguro</strong>
						<p>La información de tu <b>LadoA</b> (público) NO será eliminada. Tu perfil, fotos y publicaciones se mantendrán cuando lancemos la versión final.</p>
					</div>
				</div>

				<div class="beta-info-item">
					<div class="beta-info-icon money">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<circle cx="12" cy="12" r="10"/>
							<path d="M12 6v12m-4-8h8"/>
						</svg>
					</div>
					<div class="beta-info-text">
						<strong>Dinero ficticio</strong>
						<p>Todo el dinero mostrado es <b>de prueba</b>. No se realizan cobros reales. Disfruta explorando todas las funciones sin preocupaciones.</p>
					</div>
				</div>

				<div class="beta-info-item">
					<div class="beta-info-icon beta">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
						</svg>
					</div>
					<div class="beta-info-text">
						<strong>Estamos mejorando</strong>
						<p>Puedes encontrar errores o funciones incompletas. Tu feedback es valioso para construir una mejor plataforma.</p>
					</div>
				</div>
			</div>

			<button class="beta-popup-btn" onclick="closeBetaPopup()">
				Entendido
			</button>

			<label class="beta-popup-checkbox">
				<input type="checkbox" id="betaDontShowAgain">
				<span>No mostrar de nuevo por un tiempo</span>
			</label>
		</div>
	</div>

	<style>
		.beta-popup-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.5);
			z-index: 99999;
			align-items: center;
			justify-content: center;
			padding: 20px;
			animation: betaFadeIn 0.3s ease;
		}

		.beta-popup-overlay.active {
			display: flex;
		}

		@@keyframes betaFadeIn {
			from { opacity: 0; }
			to { opacity: 1; }
		}

		@@keyframes betaSlideIn {
			from { opacity: 0; transform: scale(0.9) translateY(-20px); }
			to { opacity: 1; transform: scale(1) translateY(0); }
		}

		.beta-popup {
			background: white;
			border-radius: 20px;
			padding: 32px;
			max-width: 440px;
			width: 100%;
			position: relative;
			border: 3px solid #4682B4;
			box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
			animation: betaSlideIn 0.3s ease;
		}

		.beta-popup-close {
			position: absolute;
			top: 16px;
			right: 16px;
			width: 36px;
			height: 36px;
			border: none;
			background: #f1f5f9;
			border-radius: 50%;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			color: #64748b;
			transition: all 0.2s;
		}

		.beta-popup-close:hover {
			background: #e2e8f0;
			color: #334155;
		}

		.beta-popup-icon {
			text-align: center;
			margin-bottom: 16px;
		}

		.beta-popup-title {
			text-align: center;
			font-size: 22px;
			font-weight: 700;
			color: #1e293b;
			margin: 0 0 24px 0;
		}

		.beta-popup-content {
			display: flex;
			flex-direction: column;
			gap: 16px;
			margin-bottom: 24px;
		}

		.beta-info-item {
			display: flex;
			gap: 14px;
			align-items: flex-start;
		}

		.beta-info-icon {
			width: 40px;
			height: 40px;
			border-radius: 10px;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-shrink: 0;
		}

		.beta-info-icon.safe {
			background: rgba(16, 185, 129, 0.1);
			color: #10b981;
		}

		.beta-info-icon.money {
			background: rgba(245, 158, 11, 0.1);
			color: #f59e0b;
		}

		.beta-info-icon.beta {
			background: rgba(70, 130, 180, 0.1);
			color: #4682B4;
		}

		.beta-info-text strong {
			display: block;
			font-size: 14px;
			font-weight: 600;
			color: #1e293b;
			margin-bottom: 4px;
		}

		.beta-info-text p {
			font-size: 13px;
			color: #64748b;
			margin: 0;
			line-height: 1.5;
		}

		.beta-info-text b {
			color: #4682B4;
			font-weight: 600;
		}

		.beta-popup-btn {
			width: 100%;
			padding: 14px;
			background: linear-gradient(135deg, #4682B4 0%, #36648B 100%);
			color: white;
			border: none;
			border-radius: 12px;
			font-size: 15px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s;
		}

		.beta-popup-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 20px rgba(70, 130, 180, 0.3);
		}

		.beta-popup-checkbox {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
			margin-top: 16px;
			cursor: pointer;
			font-size: 13px;
			color: #64748b;
		}

		.beta-popup-checkbox input {
			width: 16px;
			height: 16px;
			accent-color: #4682B4;
		}

		@@media (max-width: 480px) {
			.beta-popup {
				padding: 24px;
				border-radius: 16px;
			}

			.beta-popup-title {
				font-size: 18px;
			}

			.beta-info-icon {
				width: 36px;
				height: 36px;
			}

			.beta-info-text strong {
				font-size: 13px;
			}

			.beta-info-text p {
				font-size: 12px;
			}
		}
	</style>

	<script>
		(function() {
			const BETA_POPUP_KEY = 'lado_beta_popup';
			const DAYS_TO_HIDE = 5; // Días que no se mostrará después de "No mostrar de nuevo"
			const RANDOM_CHANCE = 0.15; // 15% de probabilidad de aparecer en cada visita

			function shouldShowBetaPopup() {
				const stored = localStorage.getItem(BETA_POPUP_KEY);

				if (stored) {
					const data = JSON.parse(stored);
					const now = Date.now();

					// Si el usuario marcó "no mostrar de nuevo" y aún no pasó el tiempo
					if (data.dontShow && data.hideUntil > now) {
						return false;
					}

					// Si ya se mostró hoy, no mostrar de nuevo
					const today = new Date().toDateString();
					if (data.lastShown === today) {
						return false;
					}
				}

				// Mostrar con probabilidad aleatoria
				return Math.random() < RANDOM_CHANCE;
			}

			function showBetaPopup() {
				const overlay = document.getElementById('betaPopupOverlay');
				if (overlay) {
					overlay.classList.add('active');
					document.body.style.overflow = 'hidden';

					// Registrar que se mostró hoy
					const stored = localStorage.getItem(BETA_POPUP_KEY);
					const data = stored ? JSON.parse(stored) : {};
					data.lastShown = new Date().toDateString();
					localStorage.setItem(BETA_POPUP_KEY, JSON.stringify(data));
				}
			}

			window.closeBetaPopup = function() {
				const overlay = document.getElementById('betaPopupOverlay');
				const checkbox = document.getElementById('betaDontShowAgain');

				if (checkbox && checkbox.checked) {
					const hideUntil = Date.now() + (DAYS_TO_HIDE * 24 * 60 * 60 * 1000);
					const data = {
						dontShow: true,
						hideUntil: hideUntil,
						lastShown: new Date().toDateString()
					};
					localStorage.setItem(BETA_POPUP_KEY, JSON.stringify(data));
				}

				if (overlay) {
					overlay.classList.remove('active');
					document.body.style.overflow = '';
				}
			};

			// Cerrar con Escape
			document.addEventListener('keydown', function(e) {
				if (e.key === 'Escape') {
					closeBetaPopup();
				}
			});

			// Cerrar al hacer clic fuera
			document.getElementById('betaPopupOverlay')?.addEventListener('click', function(e) {
				if (e.target === this) {
					closeBetaPopup();
				}
			});

			// Mostrar después de un pequeño delay si corresponde
			if (shouldShowBetaPopup()) {
				setTimeout(showBetaPopup, 2000); // Esperar 2 segundos después de cargar la página
			}
		})();
	</script>

	<!-- Service Worker & PWA Install -->
	<script>
		(function() {
			// ========================================
			// REGISTRO DEL SERVICE WORKER
			// ========================================
			if ('serviceWorker' in navigator) {
				window.addEventListener('load', async () => {
					try {
						const registration = await navigator.serviceWorker.register('/sw.js', {
							scope: '/'
						});

						console.log('[PWA] Service Worker registrado:', registration.scope);

						// Verificar actualizaciones
						registration.addEventListener('updatefound', () => {
							const newWorker = registration.installing;
							console.log('[PWA] Nueva version del SW encontrada');

							newWorker.addEventListener('statechange', () => {
								if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
									showUpdateAvailable();
								}
							});
						});

						// Verificar actualizaciones cada hora
						setInterval(() => registration.update(), 60 * 60 * 1000);

					} catch (error) {
						console.error('[PWA] Error registrando Service Worker:', error);
					}
				});
			}

			// ========================================
			// BANNER DE INSTALACION PWA
			// ========================================
			let deferredPrompt = null;
			const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
			const isInStandaloneMode = window.matchMedia('(display-mode: standalone)').matches ||
									   window.navigator.standalone === true;

			// Capturar evento beforeinstallprompt (Android/Chrome)
			window.addEventListener('beforeinstallprompt', (e) => {
				console.log('[PWA] beforeinstallprompt capturado');
				e.preventDefault();
				deferredPrompt = e;

				const visitCount = parseInt(localStorage.getItem('lado_visit_count') || '0') + 1;
				localStorage.setItem('lado_visit_count', visitCount.toString());

				if (visitCount >= 3 && !isInStandaloneMode && !localStorage.getItem('lado_pwa_dismissed')) {
					setTimeout(() => showInstallBanner(false), 3000);
				}
			});

			// Para iOS, mostrar instrucciones manuales
			if (isIOS && !isInStandaloneMode) {
				const visitCount = parseInt(localStorage.getItem('lado_visit_count') || '0') + 1;
				localStorage.setItem('lado_visit_count', visitCount.toString());

				if (visitCount >= 3 && !localStorage.getItem('lado_pwa_dismissed')) {
					setTimeout(() => showInstallBanner(true), 3000);
				}
			}

			function showInstallBanner(isIOSDevice) {
				if (document.getElementById('pwa-install-banner')) return;

				const banner = document.createElement('div');
				banner.id = 'pwa-install-banner';
				banner.innerHTML = `
					<style>
						#pwa-install-banner {
							position: fixed;
							bottom: 80px;
							left: 16px;
							right: 16px;
							max-width: 400px;
							margin: 0 auto;
							background: white;
							border-radius: 16px;
							box-shadow: 0 8px 32px rgba(0,0,0,0.2);
							padding: 20px;
							z-index: 9999;
							animation: slideUpBanner 0.4s ease;
							font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
						}
						@@keyframes slideUpBanner {
							from { opacity: 0; transform: translateY(30px); }
							to { opacity: 1; transform: translateY(0); }
						}
						#pwa-install-banner .pwa-header {
							display: flex;
							align-items: center;
							gap: 12px;
							margin-bottom: 12px;
						}
						#pwa-install-banner .pwa-icon {
							width: 48px;
							height: 48px;
							background: linear-gradient(135deg, #4682B4 0%, #2c5f8a 100%);
							border-radius: 12px;
							display: flex;
							align-items: center;
							justify-content: center;
							color: white;
							font-size: 24px;
							font-weight: 900;
						}
						#pwa-install-banner .pwa-title {
							flex: 1;
						}
						#pwa-install-banner .pwa-title h4 {
							margin: 0;
							font-size: 16px;
							font-weight: 700;
							color: #111;
						}
						#pwa-install-banner .pwa-title p {
							margin: 4px 0 0;
							font-size: 13px;
							color: #666;
						}
						#pwa-install-banner .pwa-close {
							position: absolute;
							top: 12px;
							right: 12px;
							background: none;
							border: none;
							font-size: 20px;
							color: #999;
							cursor: pointer;
							padding: 4px;
							line-height: 1;
						}
						#pwa-install-banner .pwa-buttons {
							display: flex;
							gap: 10px;
							margin-top: 16px;
						}
						#pwa-install-banner .pwa-btn {
							flex: 1;
							padding: 12px 16px;
							border-radius: 10px;
							font-size: 14px;
							font-weight: 600;
							cursor: pointer;
							border: none;
							transition: all 0.2s;
						}
						#pwa-install-banner .pwa-btn-primary {
							background: #4682B4;
							color: white;
						}
						#pwa-install-banner .pwa-btn-primary:hover {
							background: #36648B;
						}
						#pwa-install-banner .pwa-btn-secondary {
							background: #f3f4f6;
							color: #666;
						}
						#pwa-install-banner .pwa-ios-steps {
							margin-top: 12px;
							padding: 12px;
							background: #f8fafc;
							border-radius: 10px;
							font-size: 13px;
							color: #555;
							line-height: 1.6;
						}
						#pwa-install-banner .pwa-ios-steps strong {
							color: #111;
						}
					</style>
					<button class="pwa-close" onclick="closePwaBanner(true)">&times;</button>
					<div class="pwa-header">
						<div class="pwa-icon">L</div>
						<div class="pwa-title">
							<h4>Instalar LADO</h4>
							<p>Acceso rapido desde tu pantalla de inicio</p>
						</div>
					</div>
					${isIOSDevice ? `
						<div class="pwa-ios-steps">
							<strong>Para instalar en iPhone/iPad:</strong><br>
							1. Toca el boton <strong>Compartir</strong> (cuadro con flecha)<br>
							2. Desplaza y toca <strong>"Agregar a Inicio"</strong><br>
							3. Confirma tocando <strong>"Agregar"</strong>
						</div>
						<div class="pwa-buttons">
							<button class="pwa-btn pwa-btn-secondary" onclick="closePwaBanner(true)">Ahora no</button>
							<button class="pwa-btn pwa-btn-primary" onclick="closePwaBanner(false)">Entendido</button>
						</div>
					` : `
						<div class="pwa-buttons">
							<button class="pwa-btn pwa-btn-secondary" onclick="closePwaBanner(true)">Ahora no</button>
							<button class="pwa-btn pwa-btn-primary" onclick="installPwa()">Instalar</button>
						</div>
					`}
				`;
				document.body.appendChild(banner);
			}

			window.closePwaBanner = function(dismiss) {
				const banner = document.getElementById('pwa-install-banner');
				if (banner) {
					banner.style.animation = 'none';
					banner.style.opacity = '0';
					banner.style.transform = 'translateY(30px)';
					banner.style.transition = 'all 0.3s ease';
					setTimeout(() => banner.remove(), 300);
				}
				if (dismiss) {
					localStorage.setItem('lado_pwa_dismissed', Date.now().toString());
				}
			};

			window.installPwa = async function() {
				if (!deferredPrompt) return;

				deferredPrompt.prompt();
				const { outcome } = await deferredPrompt.userChoice;
				console.log('[PWA] Usuario eligio:', outcome);

				deferredPrompt = null;
				closePwaBanner(outcome === 'accepted');
			};

			// Limpiar dismissal despues de 7 dias
			const dismissedTime = localStorage.getItem('lado_pwa_dismissed');
			if (dismissedTime && Date.now() - parseInt(dismissedTime) > 7 * 24 * 60 * 60 * 1000) {
				localStorage.removeItem('lado_pwa_dismissed');
			}

			// Notificacion de actualizacion
			function showUpdateAvailable() {
				const toast = document.createElement('div');
				toast.id = 'pwa-update-toast';
				toast.style.cssText = `
					position: fixed;
					bottom: 20px;
					left: 50%;
					transform: translateX(-50%);
					background: #111;
					color: white;
					padding: 14px 20px;
					border-radius: 12px;
					font-size: 14px;
					z-index: 9999;
					display: flex;
					align-items: center;
					gap: 12px;
					box-shadow: 0 4px 20px rgba(0,0,0,0.3);
					font-family: -apple-system, BlinkMacSystemFont, sans-serif;
				`;
				toast.innerHTML = `
					<span>Nueva version disponible</span>
					<button onclick="location.reload()" style="
						background: #4682B4;
						color: white;
						border: none;
						padding: 8px 16px;
						border-radius: 8px;
						font-weight: 600;
						cursor: pointer;
					">Actualizar</button>
				`;
				document.body.appendChild(toast);
			}
		})();
	</script>

	<script>
	// Función para abrir FullView (vista fullscreen estilo TikTok/Reels)
	function abrirFullView() {
		// Siempre ir al Feed con fullview activado
		window.location.href = '/Feed?fullview=1';
	}
	</script>
</body>
</html>