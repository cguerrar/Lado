@using Microsoft.AspNetCore.Identity
@using Lado.Models
@using Lado.Data
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject ApplicationDbContext Context

@{
	var usuario = await UserManager.GetUserAsync(User);

	int mensajesNoLeidos = 0;
	if (usuario != null)
	{
		mensajesNoLeidos = Context.MensajesPrivados
			.Count(m => m.DestinatarioId == usuario.Id && !m.Leido && !m.EliminadoPorDestinatario);
	}
}

<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>@ViewData["Title"] - Lado</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
	<style>
		/* ========================================
		   SISTEMA DE TEMAS - MODO CLARO/OSCURO
		   ======================================== */
		:root {
			/* Colores primarios - Steel Blue */
			--primary: #4682B4;
			--primary-dark: #36648B;
			--primary-light: #B0C4DE;
			--primary-gradient: linear-gradient(135deg, #4682B4 0%, #36648B 50%, #2C5278 100%);
			--primary-glow: 0 0 20px rgba(70, 130, 180, 0.4);

			/* Colores de acento */
			--accent: #8b5cf6;
			--accent-light: #ede9fe;
			--accent-gradient: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);

			/* Colores semánticos */
			--success: #4682B4;
			--warning: #f59e0b;
			--danger: #ef4444;
			--info: #3b82f6;

			/* Modo claro - Fondos */
			--bg: #ffffff;
			--bg-secondary: #f8fafc;
			--bg-tertiary: #f1f5f9;
			--surface: #ffffff;
			--surface-hover: #f8fafc;

			/* Modo claro - Textos */
			--fg: #0f172a;
			--fg-secondary: #475569;
			--muted: #64748b;
			--muted-light: #94a3b8;

			/* Bordes y líneas */
			--line: #e2e8f0;
			--line-light: #f1f5f9;

			/* Sombras - Modo claro */
			--shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
			--shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
			--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
			--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
			--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

			/* Radios */
			--radius-xs: 6px;
			--radius-sm: 8px;
			--radius-md: 12px;
			--radius-lg: 16px;
			--radius-xl: 20px;
			--radius-2xl: 24px;

			/* Layout */
			--sidebar-width: 260px;

			/* Transiciones */
			--transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
			--transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
			--transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
		}

		/* ========================================
		   MODO OSCURO
		   ======================================== */
		[data-theme="dark"] {
			/* Fondos oscuros con profundidad */
			--bg: #0f172a;
			--bg-secondary: #1e293b;
			--bg-tertiary: #334155;
			--surface: #1e293b;
			--surface-hover: #334155;

			/* Textos claros */
			--fg: #f8fafc;
			--fg-secondary: #e2e8f0;
			--muted: #94a3b8;
			--muted-light: #64748b;

			/* Colores primarios ajustados para oscuro - Steel Blue */
			--primary: #6CA6CD;
			--primary-dark: #4682B4;
			--primary-light: rgba(108, 166, 205, 0.15);
			--primary-glow: 0 0 30px rgba(70, 130, 180, 0.4);

			/* Acentos ajustados */
			--accent: #a78bfa;
			--accent-light: rgba(167, 139, 250, 0.15);

			/* Bordes sutiles */
			--line: #334155;
			--line-light: #1e293b;

			/* Sombras para modo oscuro */
			--shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.3);
			--shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4), 0 1px 2px rgba(0, 0, 0, 0.3);
			--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.4);
			--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.4);
			--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.5);
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: var(--bg-secondary);
			color: var(--fg);
			overflow-x: hidden;
			transition: background-color var(--transition-slow), color var(--transition-slow);
		}

		/* Smooth transitions para cambio de tema */
		*, *::before, *::after {
			transition: background-color var(--transition-base),
						border-color var(--transition-base),
						box-shadow var(--transition-base);
		}

		/* ========================================
										   FIX COMPLETO DE Z-INDEX
										   ======================================== */

		/* SIDEBAR */
		.sidebar {
			position: fixed;
			left: 0;
			top: 0;
			bottom: 0;
			width: var(--sidebar-width);
			background: var(--surface);
			border-right: 1px solid var(--line);
			box-shadow: var(--shadow-lg);
			z-index: 1000 !important;
			overflow-y: auto;
			transition: transform 0.3s ease, background-color var(--transition-base);
		}

		/* Logo */
		.sidebar-brand {
			padding: 24px 20px;
			border-bottom: 1px solid var(--line);
			display: flex;
			align-items: center;
			text-decoration: none;
			background: var(--surface);
		}

		.brand {
			display: flex;
			align-items: center;
			gap: 12px;
			text-decoration: none;
			color: var(--fg);
			font-weight: 800;
			font-size: 1.5rem;
			letter-spacing: -0.02em;
			transition: transform var(--transition-base);
		}

			.brand:hover {
				transform: scale(1.02);
			}

		.brand-badge {
			width: 36px;
			height: 36px;
			border-radius: var(--radius-md);
			background: var(--primary-gradient);
			color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 700;
			font-size: 1.1rem;
			box-shadow: var(--primary-glow);
		}

		.sidebar-nav {
			padding: 16px 12px;
		}

		.nav-item {
			margin-bottom: 2px;
		}

		.nav-link {
			padding: 12px 16px;
			color: var(--muted);
			display: flex;
			align-items: center;
			transition: all var(--transition-fast);
			border-radius: var(--radius-md);
			text-decoration: none;
			font-size: 0.9375rem;
			font-weight: 500;
			margin: 0 4px;
			position: relative;
		}

			.nav-link:hover {
				background: var(--bg-tertiary);
				color: var(--fg);
			}

			.nav-link.active {
				background: var(--primary-light);
				color: var(--primary);
				font-weight: 600;
			}

			.nav-link.active::before {
				content: '';
				position: absolute;
				left: 0;
				top: 50%;
				transform: translateY(-50%);
				width: 3px;
				height: 60%;
				background: var(--primary);
				border-radius: 0 2px 2px 0;
			}

			.nav-link svg {
				width: 20px;
				height: 20px;
				margin-right: 12px;
				stroke: currentColor;
				fill: none;
				flex-shrink: 0;
			}

		.badge-notify {
			background: var(--danger);
			color: white;
			border-radius: 20px;
			padding: 2px 8px;
			font-size: 0.6875rem;
			margin-left: auto;
			font-weight: 600;
			min-width: 20px;
			text-align: center;
		}

		/* MAIN CONTENT */
		.main-content {
			margin-left: var(--sidebar-width);
			min-height: 100vh;
			transition: margin-left 0.3s ease;
			position: relative;
			z-index: 1 !important;
		}

		/* TOP NAVBAR - DEBE ESTAR SOBRE TODO */
		.top-navbar {
			background: var(--surface);
			box-shadow: var(--shadow-sm);
			padding: 16px 30px;
			margin-bottom: 0;
			position: sticky;
			top: 0;
			z-index: 1050 !important;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-bottom: 1px solid var(--line);
			backdrop-filter: blur(12px);
			background: rgba(var(--surface), 0.95);
		}

		[data-theme="dark"] .top-navbar {
			background: rgba(30, 41, 59, 0.95);
		}

		.hamburger-btn {
			display: none;
			background: none;
			border: none;
			padding: 8px;
			cursor: pointer;
			color: var(--muted);
			transition: color 0.2s;
			border-radius: var(--radius-sm);
		}

			.hamburger-btn:hover {
				color: var(--primary);
				background: var(--light-bg);
			}

			.hamburger-btn svg {
				width: 24px;
				height: 24px;
				stroke: currentColor;
			}

		.search-box {
			flex: 1;
			max-width: 480px;
			position: relative;
		}

			.search-box svg {
				position: absolute;
				left: 16px;
				top: 50%;
				transform: translateY(-50%);
				width: 18px;
				height: 18px;
				stroke: var(--muted);
				transition: stroke var(--transition-fast);
			}

			.search-box input {
				width: 100%;
				padding: 12px 16px 12px 48px;
				border: 1px solid var(--line);
				border-radius: var(--radius-lg);
				outline: none;
				transition: all var(--transition-fast);
				background: var(--bg-tertiary);
				font-family: inherit;
				font-size: 0.9375rem;
				color: var(--fg);
			}

			.search-box input::placeholder {
				color: var(--muted);
			}

				.search-box input:focus {
					border-color: var(--primary);
					box-shadow: 0 0 0 3px var(--primary-light);
					background: var(--surface);
				}

				.search-box input:focus + svg,
				.search-box:focus-within svg {
					stroke: var(--primary);
				}

		/* USER MENU */
		.user-menu {
			display: flex;
			align-items: center;
			gap: 16px;
			position: relative;
			z-index: 1055 !important;
		}

		.notification-icon {
			position: relative;
			cursor: pointer;
			padding: 8px;
			transition: all 0.2s ease;
			border-radius: var(--radius-sm);
		}

			.notification-icon:hover {
				background: var(--light-bg);
			}

			.notification-icon svg {
				width: 22px;
				height: 22px;
				stroke: var(--muted);
			}

		.notification-badge {
			position: absolute;
			top: 4px;
			right: 4px;
			background: #ef4444;
			color: white;
			border-radius: 10px;
			padding: 2px 6px;
			font-size: 10px;
			font-weight: 600;
		}

		.user-avatar {
			width: 40px;
			height: 40px;
			border-radius: 50%;
			background: var(--primary-gradient);
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-weight: 600;
			cursor: pointer;
			transition: all var(--transition-fast);
			position: relative;
			z-index: 1055 !important;
			box-shadow: var(--shadow-sm);
		}

			.user-avatar:hover {
				transform: scale(1.05);
				box-shadow: var(--primary-glow);
			}

			.user-avatar img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				border-radius: 50%;
			}

		/* THEME TOGGLE BUTTON */
		.theme-toggle {
			width: 40px;
			height: 40px;
			border-radius: var(--radius-md);
			background: var(--bg-tertiary);
			border: 1px solid var(--line);
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all var(--transition-fast);
			color: var(--muted);
		}

			.theme-toggle:hover {
				background: var(--primary-light);
				border-color: var(--primary);
				color: var(--primary);
				transform: scale(1.05);
			}

			.theme-toggle svg {
				width: 20px;
				height: 20px;
				transition: transform var(--transition-base);
			}

			.theme-toggle:hover svg {
				transform: rotate(15deg);
			}

		.theme-toggle .sun-icon { display: none; }
		.theme-toggle .moon-icon { display: block; }

		[data-theme="dark"] .theme-toggle .sun-icon { display: block; }
		[data-theme="dark"] .theme-toggle .moon-icon { display: none; }

		/* CONTENT AREA */
		.content-area {
			padding: 32px 30px;
			position: relative;
			z-index: 1 !important;
		}

		/* OVERLAY PARA MÓVIL */
		.sidebar-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.5);
			z-index: 999;
			opacity: 0;
			transition: opacity 0.3s ease;
		}

			.sidebar-overlay.active {
				opacity: 1;
			}

		/* DROPDOWN EN SIDEBAR */
		.sidebar .dropdown-menu {
			position: static !important;
			transform: none !important;
			border: none;
			box-shadow: none;
			background: transparent;
			padding-left: 36px;
			margin-top: 4px;
		}

		.sidebar .dropdown-item {
			padding: 8px 20px;
			color: var(--muted);
			border-radius: var(--radius-sm);
			transition: all 0.2s ease;
			font-size: 0.875rem;
		}

			.sidebar .dropdown-item:hover {
				background: var(--light-bg);
				color: var(--primary);
			}

		.sidebar .dropdown-toggle::after {
			float: right;
			margin-top: 8px;
		}

		/* DROPDOWN MENU TOP - DEBE ESTAR SOBRE TODO */
		.dropdown-menu {
			background: var(--surface);
			border: 1px solid var(--line);
			border-radius: var(--radius-lg);
			box-shadow: var(--shadow-xl);
			padding: 8px;
			margin-top: 8px;
			z-index: 1060 !important;
			position: absolute !important;
			min-width: 200px;
		}

			.dropdown-menu.show {
				z-index: 1060 !important;
			}

		.dropdown-item {
			padding: 10px 16px;
			border-radius: var(--radius-sm);
			font-size: 0.9375rem;
			transition: all var(--transition-fast);
			color: var(--fg);
		}

			.dropdown-item:hover {
				background: var(--bg-tertiary);
				color: var(--primary);
			}

		.dropdown-divider {
			border-color: var(--line);
			margin: 8px 0;
		}

		.user-info-dropdown {
			padding: 12px 16px;
			border-bottom: 1px solid var(--line);
			margin-bottom: 8px;
		}

		.user-info-name {
			font-weight: 600;
			color: var(--fg);
			font-size: 0.9375rem;
			margin-bottom: 2px;
		}

		.user-info-pseudo {
			font-size: 0.8125rem;
			color: var(--muted);
		}

		/* SCROLLBAR */
		.sidebar::-webkit-scrollbar {
			width: 6px;
		}

		.sidebar::-webkit-scrollbar-track {
			background: var(--light-bg);
		}

		.sidebar::-webkit-scrollbar-thumb {
			background: var(--line);
			border-radius: 3px;
		}

			.sidebar::-webkit-scrollbar-thumb:hover {
				background: var(--muted);
			}

		/* ESTILOS GLOBALES */
		.card {
			background: var(--surface);
			border: 1px solid var(--line);
			border-radius: var(--radius-lg);
			box-shadow: var(--shadow-sm);
		}

		.btn-primary {
			background: var(--primary-gradient);
			border: none;
			color: white;
			font-weight: 600;
			padding: 10px 20px;
			border-radius: var(--radius-md);
			transition: all var(--transition-fast);
		}

			.btn-primary:hover {
				background: var(--primary-dark);
				transform: translateY(-2px);
				box-shadow: var(--primary-glow);
			}

		/* FIX ADICIONAL PARA CONTENIDO DEL FEED */
		.feed-wrapper,
		.feed-container,
		.feed-main,
		.profile-wrapper {
			position: relative;
			z-index: 1 !important;
		}

		/* RESPONSIVE */
		@@media (max-width: 991px) {
			.sidebar {
				transform: translateX(-100%);
				z-index: 1100 !important;
			}

				.sidebar.active {
					transform: translateX(0);
				}

			.main-content {
				margin-left: 0;
			}

			.hamburger-btn {
				display: block;
			}

			.top-navbar {
				padding: 12px 15px;
			}

			.search-box {
				max-width: none;
				margin: 0 10px;
			}

			.content-area {
				padding: 24px 15px;
			}

			body.sidebar-open .sidebar-overlay {
				display: block;
			}

			body.sidebar-open {
				overflow: hidden;
			}

			.sidebar-overlay {
				z-index: 1099 !important;
			}
		}

		@@media (max-width: 768px) {
			.search-box {
				display: none;
			}

			.user-menu {
				gap: 10px;
			}
		}

		@@media (max-width: 576px) {
			.sidebar-brand {
				padding: 20px 15px;
			}

			.brand {
				font-size: 1.3rem;
			}

			.brand-badge {
				width: 30px;
				height: 30px;
			}

			.nav-link {
				padding: 10px 15px;
				font-size: 0.875rem;
			}

			.top-navbar {
				padding: 10px;
			}

			.content-area {
				padding: 20px 10px;
			}
		}

		@@media (min-width: 1400px) {
			.content-area {
				max-width: 1320px;
				margin: 0 auto;
			}
		}

		.toast-notification {
			position: fixed;
			top: 80px;
			right: -500px;
			min-width: 350px;
			max-width: 450px;
			background: white;
			border-radius: 12px;
			box-shadow: 0 12px 48px rgba(0, 0, 0, 0.25);
			padding: 20px;
			display: flex;
			align-items: flex-start;
			gap: 16px;
			z-index: 999999;
			transition: right 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
		}

			.toast-notification.show {
				right: 20px;
			}

			.toast-notification.success {
				border-left: 4px solid #4682B4;
			}

			.toast-notification.error {
				border-left: 4px solid #EF4444;
			}

			.toast-notification.warning {
				border-left: 4px solid #F59E0B;
			}

		.toast-icon {
			flex-shrink: 0;
			width: 40px;
			height: 40px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.toast-notification.success .toast-icon {
			background: rgba(70, 130, 180, 0.1);
		}

		.toast-notification.error .toast-icon {
			background: rgba(239, 68, 68, 0.1);
		}

		.toast-notification.warning .toast-icon {
			background: rgba(245, 158, 11, 0.1);
		}

		.toast-content {
			flex: 1;
		}

			.toast-content h4 {
				font-size: 16px;
				font-weight: 600;
				color: #111827;
				margin: 0 0 4px 0;
			}

			.toast-content p {
				font-size: 14px;
				color: #6B7280;
				margin: 0;
				line-height: 1.4;
			}

		.toast-close {
			flex-shrink: 0;
			width: 24px;
			height: 24px;
			border: none;
			background: transparent;
			color: #9CA3AF;
			cursor: pointer;
			padding: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 4px;
			transition: all 0.2s;
		}

			.toast-close:hover {
				background: #F3F4F6;
				color: #111827;
			}

		@@media (max-width: 768px) {
			.toast-notification {
				min-width: 300px;
				max-width: 90%;
				top: 70px;
				right: -500px;
			}

				.toast-notification.show {
					right: 10px;
				}
		}

	</style>
</head>
<body>
	<div class="sidebar-overlay" onclick="toggleSidebar()"></div>

	<!-- SIDEBAR -->
	<div class="sidebar" id="sidebar">
		<div class="sidebar-brand">
			<a href="/Dashboard" class="brand">
				<span class="brand-badge">L</span>
				<span>lado</span>
			</a>
		</div>

		<nav class="sidebar-nav">
			<ul class="nav flex-column">
				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Dashboard" ? "active" : "")" href="/Dashboard">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
							<polyline points="9 22 9 12 15 12 15 22"></polyline>
						</svg>
						Resumen
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Feed" && ViewContext.RouteData.Values["action"]?.ToString() == "Index" ? "active" : "")" href="/Feed">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path>
							<circle cx="12" cy="12" r="3"></circle>
						</svg>
						Feed
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Feed" && ViewContext.RouteData.Values["action"]?.ToString() == "Explorar" ? "active" : "")" href="/Feed/Explorar">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="11" cy="11" r="8"></circle>
							<path d="m21 21-4.35-4.35"></path>
						</svg>
						Explorar
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Contenido" ? "active" : "")" href="/Contenido">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
							<circle cx="8.5" cy="8.5" r="1.5"></circle>
							<polyline points="21 15 16 10 5 21"></polyline>
						</svg>
						Mi Contenido
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Mensajes" ? "active" : "")" href="/Mensajes">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
						</svg>
						Mensajes
						@if (mensajesNoLeidos > 0)
						{
							<span class="badge-notify">@mensajesNoLeidos</span>
						}
					</a>
				</li>

				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle @(ViewContext.RouteData.Values["controller"]?.ToString() == "Desafios" ? "active" : "")"
					   href="#"
					   id="desafiosDropdown"
					   role="button"
					   data-bs-toggle="dropdown"
					   aria-expanded="false">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
							<path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
							<path d="M4 22h16"></path>
							<path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
							<path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
							<path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
						</svg>
						Desafíos
					</a>
					<ul class="dropdown-menu" aria-labelledby="desafiosDropdown">
						<li><a class="dropdown-item" href="/Desafios/FeedPublico">Feed Público</a></li>
						<li><a class="dropdown-item" href="/Desafios/MisDesafios">Mis Desafíos</a></li>
						<li><a class="dropdown-item" href="/Desafios/DesafiosRecibidos">Desafíos Recibidos</a></li>
						<li><a class="dropdown-item" href="/Desafios/MisPropuestas">Mis Propuestas</a></li>
					</ul>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "MisSuscripciones" ? "active" : "")" href="/Suscripciones/MisSuscripciones">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
							<circle cx="9" cy="7" r="4"></circle>
							<path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
							<path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
						</svg>
						Suscripciones
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Billetera" ? "active" : "")" href="/Billetera">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"></path>
							<path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"></path>
						</svg>
						Mi Billetera
						@if (usuario != null && usuario.Saldo > 0)
						{
							<span class="badge-notify" style="background: var(--primary);">$@usuario.Saldo.ToString("N0")</span>
						}
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Estadisticas" ? "active" : "")" href="/Usuario/Estadisticas">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M3 3v18h18"></path>
							<path d="m19 9-5 5-4-4-3 3"></path>
						</svg>
						Estadísticas
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Configuracion" ? "active" : "")" href="/Usuario/Configuracion">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="3"></circle>
							<path d="M12 1v6m0 6v6m5.2-12.8 4.2-4.2m-4.2 4.2-4.2-4.2m0 4.2L8.8 6M6 6l4.2 4.2M1 12h6m6 0h6m-12.8 5.2-4.2 4.2m4.2-4.2L6 18m12.2-1.8 4.2 4.2m-4.2-4.2L18 18"></path>
						</svg>
						Configuración
					</a>
				</li>

				<li class="nav-item">
					<a class="nav-link" href="#">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="10"></circle>
							<path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
							<line x1="12" y1="17" x2="12.01" y2="17"></line>
						</svg>
						Centro de Ayuda
					</a>
				</li>

				<li class="nav-item mt-3">
					<a class="nav-link" href="/Account/Logout">
						<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
							<polyline points="16 17 21 12 16 7"></polyline>
							<line x1="21" y1="12" x2="9" y2="12"></line>
						</svg>
						Cerrar Sesión
					</a>
				</li>
			</ul>
		</nav>
	</div>

	<!-- MAIN CONTENT -->
	<div class="main-content">
		<div class="top-navbar">
			<button class="hamburger-btn" onclick="toggleSidebar()" aria-label="Toggle menu">
				<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<line x1="3" y1="12" x2="21" y2="12"></line>
					<line x1="3" y1="6" x2="21" y2="6"></line>
					<line x1="3" y1="18" x2="21" y2="18"></line>
				</svg>
			</button>

			<div class="search-box">
				<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<circle cx="11" cy="11" r="8"></circle>
					<path d="m21 21-4.35-4.35"></path>
				</svg>
				<input type="text" class="form-control" placeholder="Buscar...">
			</div>

			<div class="user-menu">
				<!-- Theme Toggle -->
				<button class="theme-toggle" onclick="toggleTheme()" aria-label="Cambiar tema">
					<svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
					</svg>
					<svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<circle cx="12" cy="12" r="5"></circle>
						<line x1="12" y1="1" x2="12" y2="3"></line>
						<line x1="12" y1="21" x2="12" y2="23"></line>
						<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
						<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
						<line x1="1" y1="12" x2="3" y2="12"></line>
						<line x1="21" y1="12" x2="23" y2="12"></line>
						<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
						<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
					</svg>
				</button>

				<div class="notification-icon">
					<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
						<path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
					</svg>
					@if (mensajesNoLeidos > 0)
					{
						<span class="notification-badge">@mensajesNoLeidos</span>
					}
				</div>

				<div class="dropdown">
					<div class="user-avatar" data-bs-toggle="dropdown" aria-expanded="false">
						@if (!string.IsNullOrEmpty(usuario?.FotoPerfil))
						{
							<img src="@usuario.FotoPerfil" alt="@usuario.NombreCompleto">
						}
						else
						{
							<span>@(usuario?.NombreCompleto?.Substring(0, 1).ToUpper() ?? "U")</span>
						}
					</div>
					<ul class="dropdown-menu dropdown-menu-end">
						@if (usuario != null)
						{
							<li class="user-info-dropdown">
								<div class="user-info-name">@usuario.NombreCompleto</div>
								<div class="user-info-pseudo">@@@usuario.UserName</div>
							</li>
						}
						<li><a class="dropdown-item" href="/Usuario/Perfil/@usuario?.Id">Mi Perfil</a></li>
						<li><a class="dropdown-item" href="/Usuario/Configuracion">Configuración</a></li>
						<li><hr class="dropdown-divider"></li>
						<li><a class="dropdown-item" href="/Account/Logout">Cerrar Sesión</a></li>
					</ul>
				</div>
			</div>
		</div>

		<div class="content-area">
			@RenderBody()
		</div>
	</div>

	<!-- Toast Notification Global -->
	<div class="toast-notification" id="toastNotification">
		<div class="toast-icon" id="toastIcon"></div>
		<div class="toast-content">
			<h4 id="toastTitle">Título</h4>
			<p id="toastMessage">Mensaje</p>
		</div>
		<button type="button" class="toast-close" id="toastClose">
			<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
				<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
			</svg>
		</button>
	</div>



	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		// ========================================
		// THEME TOGGLE - Modo Oscuro/Claro
		// ========================================
		(function() {
			const savedTheme = localStorage.getItem('theme') || 'light';
			document.documentElement.setAttribute('data-theme', savedTheme);
		})();

		function toggleTheme() {
			const html = document.documentElement;
			const currentTheme = html.getAttribute('data-theme');
			const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

			html.setAttribute('data-theme', newTheme);
			localStorage.setItem('theme', newTheme);
		}

		function toggleSidebar() {
			const sidebar = document.getElementById('sidebar');
			const overlay = document.querySelector('.sidebar-overlay');
			const body = document.body;

			sidebar.classList.toggle('active');
			overlay.classList.toggle('active');
			body.classList.toggle('sidebar-open');
		}

		document.querySelectorAll('.sidebar .nav-link').forEach(link => {
			link.addEventListener('click', function() {
				if (window.innerWidth <= 991) {
					toggleSidebar();
				}
			});
		});

		window.addEventListener('resize', function() {
			if (window.innerWidth > 991) {
				const sidebar = document.getElementById('sidebar');
				const overlay = document.querySelector('.sidebar-overlay');
				const body = document.body;

				sidebar.classList.remove('active');
				overlay.classList.remove('active');
				body.classList.remove('sidebar-open');
			}
		});

		const observer = new MutationObserver(function(mutations) {
			mutations.forEach(function(mutation) {
				if (mutation.attributeName === 'class') {
					const body = mutation.target;
					if (body.classList.contains('sidebar-open')) {
						body.style.overflow = 'hidden';
					} else {
						body.style.overflow = '';
					}
				}
			});
		});

		observer.observe(document.body, {
			attributes: true
		});

		// Fix adicional para asegurar que dropdowns funcionen
		document.addEventListener('DOMContentLoaded', function() {
			const navbar = document.querySelector('.top-navbar');
			if (navbar) {
				navbar.style.zIndex = '1050';
			}

			const userMenu = document.querySelector('.user-menu');
			if (userMenu) {
				userMenu.style.zIndex = '1055';
			}
		});

		// Fix para cuando se abre el dropdown
		document.addEventListener('shown.bs.dropdown', function(event) {
			const dropdown = event.target.querySelector('.dropdown-menu');
			if (dropdown) {
				dropdown.style.zIndex = '1060';
			}
		});


			// Script Toast Global - Ejecutar al cargar la página
			document.addEventListener('DOMContentLoaded', function() {
				const toastNotification = document.getElementById('toastNotification');
				const toastIcon = document.getElementById('toastIcon');
				const toastTitle = document.getElementById('toastTitle');
				const toastMessage = document.getElementById('toastMessage');
				const toastClose = document.getElementById('toastClose');

				// Función global para mostrar toast
				window.showToast = function(type, title, message) {
					console.log('🔔 Toast Global:', type, title, message);

					// Forzar reinicio
					toastNotification.classList.remove('show');

					setTimeout(() => {
						toastTitle.textContent = title;
						toastMessage.textContent = message;

						// Limpiar clases
						toastNotification.className = 'toast-notification';
						toastIcon.innerHTML = '';

						if (type === 'success') {
							toastNotification.classList.add('success');
							toastIcon.innerHTML = `
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2.5">
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
							`;
						} else if (type === 'error') {
							toastNotification.classList.add('error');
							toastIcon.innerHTML = `
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2.5">
									<line x1="18" y1="6" x2="6" y2="18"></line>
									<line x1="6" y1="6" x2="18" y2="18"></line>
								</svg>
							`;
						} else if (type === 'warning') {
							toastNotification.classList.add('warning');
							toastIcon.innerHTML = `
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2.5">
									<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
									<line x1="12" y1="9" x2="12" y2="13"></line>
									<line x1="12" y1="17" x2="12.01" y2="17"></line>
								</svg>
							`;
						}

						toastNotification.classList.add('show');

						// Auto-cerrar después de 5 segundos
						setTimeout(() => {
							toastNotification.classList.remove('show');
						}, 5000);
					}, 100);
				};

				// Cerrar manualmente
				toastClose.addEventListener('click', () => {
					toastNotification.classList.remove('show');
				});

				// Verificar TempData al cargar
		@if (TempData["Success"] != null)
		{
			<text>
									showToast('success', '¡Éxito!', '@Html.Raw(System.Text.Json.JsonSerializer.Serialize(TempData["Success"]?.ToString() ?? ""))'.replace(/^"|"$/g, ''));
			</text>
		}
		@if (TempData["Error"] != null)
		{
			<text>
									showToast('error', 'Error', '@Html.Raw(System.Text.Json.JsonSerializer.Serialize(TempData["Error"]?.ToString() ?? ""))'.replace(/^"|"$/g, ''));
			</text>
		}
		@if (TempData["Warning"] != null)
		{
			<text>
									showToast('warning', 'Aviso', '@Html.Raw(System.Text.Json.JsonSerializer.Serialize(TempData["Warning"]?.ToString() ?? ""))'.replace(/^"|"$/g, ''));
			</text>
		}
		@if (TempData["Info"] != null)
		{
			<text>
									showToast('success', 'Información', '@Html.Raw(System.Text.Json.JsonSerializer.Serialize(TempData["Info"]?.ToString() ?? ""))'.replace(/^"|"$/g, ''));
			</text>
		}
			});

	</script>

	@await RenderSectionAsync("Scripts", required: false)
</body>
</html>