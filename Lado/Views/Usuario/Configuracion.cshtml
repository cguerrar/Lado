@model Lado.Models.ApplicationUser
@using Lado.Data
@inject ApplicationDbContext Context
@{
    ViewData["Title"] = "Configuración";

    // Obtener la agencia del usuario actual si existe
    var agenciaUsuario = Context.Agencias.FirstOrDefault(a => a.UsuarioId == Model.Id);
}

<style>
    .config-page-wrapper {
        --config-primary: #4682B4;
        --config-primary-dark: #3a6d96;
        --config-danger: #ef4444;
        --config-danger-dark: #dc2626;
        --config-success: #10b981;
        --config-warning: #f59e0b;
        --config-card-bg: #ffffff;
        --config-border: #e5e7eb;
        --config-text-primary: #1f2937;
        --config-text-secondary: #6b7280;
        --config-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
        --config-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
        --config-input-bg: #ffffff;
        max-width: 1100px;
        margin: 0 auto;
        padding: 40px 24px;
        position: relative;
        z-index: 1;
    }

    /* Asegurar que el navbar tenga prioridad */
    .config-page-wrapper ~ *,
    .config-page-wrapper * {
        z-index: auto;
    }

    /* Modo oscuro */
    [data-theme="dark"] .config-page-wrapper {
        --config-card-bg: #1e293b;
        --config-border: #334155;
        --config-text-primary: #f1f5f9;
        --config-text-secondary: #94a3b8;
        --config-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
        --config-shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
        --config-input-bg: #0f172a;
    }

    [data-theme="dark"] .config-modal-dialog {
        background: #1e293b;
        color: #f1f5f9;
    }

    [data-theme="dark"] .config-modal-body {
        color: #e2e8f0;
    }

    [data-theme="dark"] .config-modal-body ul {
        color: #cbd5e1;
    }

    [data-theme="dark"] .config-form-control {
        background: #0f172a;
        border-color: #334155;
        color: #f1f5f9;
    }

    [data-theme="dark"] .config-form-control:focus {
        border-color: #4682B4;
    }

    [data-theme="dark"] .config-btn-secondary {
        background: #475569;
        color: #f1f5f9;
    }

    [data-theme="dark"] .config-btn-secondary:hover {
        background: #64748b;
    }

    [data-theme="dark"] .config-modal-header {
        border-bottom-color: #334155;
    }

    [data-theme="dark"] .config-modal-header h5 {
        color: #ef4444;
    }

    [data-theme="dark"] .config-modal-footer {
        background: #1e293b !important;
        border-top-color: #334155;
    }

    [data-theme="dark"] .config-btn-danger {
        background: #ef4444 !important;
        color: white !important;
    }

    [data-theme="dark"] .config-btn-danger:disabled {
        background: #fca5a5 !important;
        color: #7f1d1d !important;
    }

    [data-theme="dark"] .config-modal-body p,
    [data-theme="dark"] .config-modal-body strong {
        color: #e2e8f0;
    }

    [data-theme="dark"] .config-modal-body .config-form-label {
        color: #f1f5f9;
    }

    [data-theme="dark"] .config-btn-close {
        color: #94a3b8;
    }

    [data-theme="dark"] .config-btn-close:hover {
        background: #334155;
        color: #f1f5f9;
    }

    [data-theme="dark"] .config-alert-danger {
        background: rgba(239, 68, 68, 0.15);
        border-color: #ef4444;
        color: #fca5a5;
    }

    [data-theme="dark"] .config-nav-item:hover {
        background: #334155;
    }

    [data-theme="dark"] .config-input-group-text {
        background: #334155;
        border-color: #475569;
        color: #94a3b8;
    }

    /* Header */
    .config-header {
        margin-bottom: 36px;
        padding-bottom: 24px;
        border-bottom: 1px solid var(--config-border);
    }

    .config-header h2 {
        font-size: 26px;
        font-weight: 700;
        color: var(--config-text-primary);
        margin: 0 0 8px 0;
    }

    .config-header p {
        color: var(--config-text-secondary);
        font-size: 15px;
        margin: 0;
    }

    /* Layout */
    .config-layout {
        display: grid;
        grid-template-columns: 240px 1fr;
        gap: 32px;
    }

    /* Sidebar */
    .config-sidebar {
        background: var(--config-card-bg);
        border: 1px solid var(--config-border);
        border-radius: 12px;
        padding: 6px;
        height: fit-content;
        position: sticky;
        top: 100px; /* Espacio para el navbar */
        box-shadow: var(--config-shadow-sm);
        z-index: 1;
    }

    .config-nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        border-radius: 12px;
        color: var(--config-text-secondary);
        text-decoration: none;
        font-weight: 500;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        background: transparent;
        width: 100%;
        text-align: left;
    }

    .config-nav-item:hover {
        background: #f9fafb;
        color: var(--config-text-primary);
    }

    .config-nav-item.active {
        background: rgba(70, 130, 180, 0.1);
        color: var(--config-primary);
        font-weight: 600;
    }

    .config-nav-icon {
        width: 20px;
        height: 20px;
        stroke: currentColor;
        fill: none;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
    }

    /* Cards */
    .config-card {
        background: var(--config-card-bg);
        border: 1px solid var(--config-border);
        border-radius: 16px;
        box-shadow: var(--config-shadow-sm);
        margin-bottom: 24px;
    }

    .config-card-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--config-border);
    }

    .config-card-header h5 {
        margin: 0;
        font-size: 18px;
        font-weight: 700;
        color: var(--config-text-primary);
    }

    .config-card-body {
        padding: 24px;
    }

    /* Danger Zone */
    .config-card-danger {
        border-color: var(--config-danger);
    }

    .config-card-danger .config-card-header {
        background: rgba(239, 68, 68, 0.05);
        border-bottom-color: var(--config-danger);
    }

    .config-card-danger .config-card-header h5 {
        color: var(--config-danger);
    }

    /* Form Elements */
    .config-form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: var(--config-text-primary);
        margin-bottom: 8px;
    }

    .config-form-control {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--config-border);
        border-radius: 12px;
        font-size: 15px;
        color: var(--config-text-primary);
        transition: all 0.2s;
        font-family: inherit;
    }

    .config-form-control:focus {
        outline: none;
        border-color: var(--config-primary);
        box-shadow: 0 0 0 3px rgba(70, 130, 180, 0.1);
    }

    .config-form-control:disabled {
        background: #f9fafb;
        cursor: not-allowed;
        opacity: 0.6;
    }

    .config-form-text {
        display: block;
        font-size: 13px;
        color: var(--config-text-secondary);
        margin-top: 6px;
    }

    .config-input-group {
        display: flex;
        gap: 0;
    }

    .config-input-group-text {
        padding: 12px 16px;
        background: #f9fafb;
        border: 1px solid var(--config-border);
        border-right: none;
        border-radius: 12px 0 0 12px;
        color: var(--config-text-secondary);
        font-weight: 600;
    }

    .config-input-group .config-form-control {
        border-radius: 0 12px 12px 0;
    }

    .config-form-group {
        margin-bottom: 20px;
    }

    /* Settings Row */
    .config-settings-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
        border-bottom: 1px solid var(--config-border);
    }

    .config-settings-row:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }

    .config-settings-row:first-child {
        padding-top: 0;
    }

    .config-settings-info h6 {
        font-size: 15px;
        font-weight: 600;
        color: var(--config-text-primary);
        margin: 0 0 4px 0;
    }

    .config-settings-info p {
        font-size: 13px;
        color: var(--config-text-secondary);
        margin: 0;
    }

    /* Switch */
    .config-switch {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 28px;
    }

    .config-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .config-switch-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #cbd5e1;
        transition: 0.3s;
        border-radius: 34px;
    }

    .config-switch-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
    }

    .config-switch input:checked + .config-switch-slider {
        background-color: var(--config-primary);
    }

    .config-switch input:checked + .config-switch-slider:before {
        transform: translateX(20px);
    }

    /* Buttons */
    .config-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 15px;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }

    .config-btn-primary {
        background: var(--config-primary);
        color: white;
    }

    .config-btn-primary:hover:not(:disabled) {
        background: var(--config-primary-dark);
        transform: translateY(-1px);
        box-shadow: var(--config-shadow-md);
    }

    .config-btn-outline-danger {
        background: transparent;
        color: var(--config-danger);
        border: 1px solid var(--config-danger);
    }

    .config-btn-outline-danger:hover {
        background: var(--config-danger);
        color: white;
    }

    .config-btn-danger {
        background: #ef4444 !important;
        color: white !important;
        display: inline-flex !important;
        visibility: visible !important;
    }

    .config-btn-danger:hover:not(:disabled) {
        background: #dc2626 !important;
    }

    .config-btn-danger:disabled {
        background: #fca5a5 !important;
        color: #7f1d1d !important;
        opacity: 1;
    }

    .config-btn-secondary {
        background: #6b7280;
        color: white;
    }

    .config-btn-secondary:hover {
        background: #4b5563;
    }

    .config-btn:disabled {
        cursor: not-allowed;
    }

    /* Icons */
    .config-icon {
        width: 20px;
        height: 20px;
        stroke: currentColor;
        fill: none;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
    }

    .config-icon-fill {
        fill: currentColor;
        stroke: none;
    }

    /* Modal */
    .config-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }

    .config-modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .config-modal-dialog {
        background: white;
        border-radius: 16px;
        max-width: 500px;
        width: 90%;
        margin: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-height: calc(100vh - 40px);
        display: flex;
        flex-direction: column;
    }

    .config-modal-header {
        padding: 24px;
        border-bottom: 1px solid var(--config-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .config-modal-header h5 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
        color: var(--config-danger);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .config-btn-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--config-text-secondary);
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        transition: all 0.2s;
    }

    .config-btn-close:hover {
        background: #f3f4f6;
    }

    .config-modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
        min-height: 0;
    }

    .config-modal-body ul {
        padding-left: 20px;
        margin: 16px 0;
    }

    .config-modal-body li {
        margin-bottom: 8px;
        color: var(--config-text-secondary);
    }

    .config-modal-footer {
        padding: 20px 24px;
        border-top: 1px solid var(--config-border);
        display: flex !important;
        gap: 12px;
        flex-shrink: 0;
        background: white;
        border-radius: 0 0 16px 16px;
        min-height: 80px;
    }

    .config-modal-footer .config-btn {
        flex: 1;
        text-align: center;
        justify-content: center;
        min-height: 48px;
    }

    /* Asegurar ambos botones visibles en desktop */
    @@media (min-width: 481px) {
        .config-modal-footer {
            flex-direction: row;
            align-items: center;
        }
    }

    .config-alert {
        padding: 16px;
        border-radius: 12px;
        margin: 16px 0;
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .config-alert-danger {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid var(--config-danger);
        color: var(--config-danger);
    }

    /* Tab Content */
    .config-tab-content {
        display: none;
    }

    .config-tab-content.active {
        display: block;
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .config-layout {
            grid-template-columns: 1fr;
        }

        .config-sidebar {
            position: static;
        }
    }

    @@media (max-width: 768px) {
        .config-page-wrapper {
            padding: 24px 16px;
        }

        .config-header h2 {
            font-size: 24px;
        }

        .config-card-body {
            padding: 20px;
        }

        .config-settings-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }

        .config-modal-dialog {
            margin: 10px;
            max-height: calc(100vh - 20px);
        }

        .config-modal-footer {
            padding: 16px;
            flex-direction: column;
            gap: 10px;
            min-height: 130px;
        }

        .config-modal-footer .config-btn {
            width: 100%;
            min-width: unset;
            min-height: 48px;
            padding: 12px 16px;
        }

        /* Botón peligroso primero en móvil */
        .config-modal-footer .config-btn-danger {
            order: -1;
            background: #ef4444 !important;
            color: white !important;
            border: none;
        }

        .config-modal-footer .config-btn-danger:disabled {
            background: #fca5a5 !important;
            color: #7f1d1d !important;
        }

        .config-modal-body {
            padding: 16px;
        }

        .config-modal-header {
            padding: 16px;
        }
    }

    @@media (max-width: 480px) {
        .config-page-wrapper {
            padding: 16px 12px;
        }

        .config-header h2 {
            font-size: 20px;
        }

        .config-card-header {
            padding: 16px 20px;
        }

        .config-card-body {
            padding: 16px;
        }

        .config-btn {
            padding: 10px 20px;
            font-size: 14px;
        }
    }

    /* Language Options */
    .language-option {
        border-color: var(--config-border) !important;
    }

    .language-option:hover {
        border-color: var(--config-primary) !important;
        background: rgba(70, 130, 180, 0.03);
    }

    .language-option.selected {
        border-color: var(--config-primary) !important;
        background: rgba(70, 130, 180, 0.05);
    }

    .language-option.loading {
        opacity: 0.7;
        pointer-events: none;
    }

    /* Lado Preferido Options */
    .lado-pref-option {
        border-color: var(--config-border) !important;
    }

    .lado-pref-option:hover {
        border-color: var(--config-primary) !important;
        background: rgba(70, 130, 180, 0.03);
    }

    .lado-pref-option.selected {
        border-color: var(--config-primary) !important;
        background: rgba(70, 130, 180, 0.05);
    }

    .lado-pref-option.loading {
        opacity: 0.7;
        pointer-events: none;
    }

    /* ========================================
       SIMPLIFICACIÓN MÓVIL - CONFIGURACIÓN
       ======================================== */

    /* Móvil Grande (< 768px) - Mejoras adicionales */
    @@media (max-width: 767px) {
        /* Layout edge-to-edge */
        .config-page-wrapper {
            padding: 0;
            max-width: 100%;
        }

        /* Header sticky */
        .config-header {
            padding: 16px 12px;
            margin-bottom: 0;
            border-bottom: 1px solid var(--config-border);
            background: var(--config-card-bg);
            position: sticky;
            top: 56px;
            z-index: 50;
        }

        .config-header h2 {
            font-size: 1.25rem;
            margin-bottom: 4px;
        }

        .config-header p {
            font-size: 0.85rem;
        }

        /* Layout de una columna */
        .config-layout {
            display: block;
        }

        /* Sidebar como tabs horizontales */
        .config-sidebar {
            position: sticky;
            top: 120px;
            border-radius: 0;
            border-left: none;
            border-right: none;
            padding: 8px 12px;
            display: flex;
            overflow-x: auto;
            gap: 6px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            background: var(--config-card-bg);
            z-index: 40;
        }

        .config-sidebar::-webkit-scrollbar {
            display: none;
        }

        .config-nav-item {
            flex-shrink: 0;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            gap: 8px;
            white-space: nowrap;
            background: var(--bg-tertiary, #f3f4f6);
        }

        .config-nav-item.active {
            background: var(--config-primary);
            color: white;
        }

        .config-nav-icon {
            width: 18px;
            height: 18px;
        }

        /* Cards sin bordes laterales */
        .config-card {
            border-radius: 0;
            border-left: none;
            border-right: none;
            margin-bottom: 8px;
        }

        .config-card-header {
            padding: 14px 12px;
        }

        .config-card-header h5 {
            font-size: 1rem;
        }

        .config-card-body {
            padding: 12px;
        }

        /* Settings row */
        .config-settings-row {
            padding: 14px 0;
            gap: 10px;
        }

        .config-settings-info h6 {
            font-size: 0.9rem;
        }

        .config-settings-info p {
            font-size: 0.8rem;
        }

        /* Form elements */
        .config-form-group {
            margin-bottom: 16px;
        }

        .config-form-label {
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .config-form-control {
            padding: 10px 12px;
            font-size: 16px; /* Evitar zoom en iOS */
            border-radius: 10px;
        }

        .config-form-text {
            font-size: 0.75rem;
        }

        .config-input-group-text {
            padding: 10px 12px;
            font-size: 0.9rem;
        }

        /* Switch más grande para touch */
        .config-switch {
            width: 52px;
            height: 30px;
        }

        .config-switch-slider:before {
            height: 22px;
            width: 22px;
        }

        .config-switch input:checked + .config-switch-slider:before {
            transform: translateX(22px);
        }

        /* Botones */
        .config-btn {
            padding: 10px 16px;
            font-size: 0.9rem;
            border-radius: 10px;
            min-height: 44px;
        }

        .config-btn-sm {
            padding: 8px 14px;
            font-size: 0.85rem;
        }

        /* Modal */
        .config-modal-backdrop {
            padding: 0;
        }

        .config-modal-dialog {
            margin: 0;
            max-width: 100%;
            max-height: 100vh;
            border-radius: 16px 16px 0 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .config-modal-header {
            padding: 14px 16px;
        }

        .config-modal-body {
            padding: 16px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .config-modal-footer {
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 0));
        }

        /* Alerts */
        .config-alert {
            padding: 12px;
            font-size: 0.85rem;
            border-radius: 10px;
        }
    }

    /* Móvil Pequeño (< 480px) */
    @@media (max-width: 479px) {
        .config-header {
            padding: 12px 10px;
        }

        .config-header h2 {
            font-size: 1.1rem;
        }

        .config-header p {
            font-size: 0.8rem;
        }

        .config-sidebar {
            padding: 6px 10px;
            gap: 5px;
        }

        .config-nav-item {
            padding: 8px 12px;
            font-size: 0.8rem;
        }

        .config-nav-icon {
            width: 16px;
            height: 16px;
        }

        .config-card-header {
            padding: 12px 10px;
        }

        .config-card-header h5 {
            font-size: 0.95rem;
        }

        .config-card-body {
            padding: 10px;
        }

        .config-settings-row {
            padding: 12px 0;
        }

        .config-settings-info h6 {
            font-size: 0.85rem;
        }

        .config-settings-info p {
            font-size: 0.75rem;
        }

        .config-form-control {
            padding: 8px 10px;
        }

        .config-btn {
            padding: 8px 14px;
            font-size: 0.85rem;
        }

        /* Language/Lado options más compactos */
        .language-option,
        .lado-pref-option {
            padding: 10px !important;
        }

        .language-option span,
        .lado-pref-option span {
            font-size: 0.85rem;
        }
    }

    /* Pantallas muy pequeñas (< 360px) */
    @@media (max-width: 359px) {
        .config-header h2 {
            font-size: 1rem;
        }

        .config-nav-item {
            padding: 6px 10px;
            font-size: 0.75rem;
        }

        .config-nav-item .config-nav-icon {
            display: none;
        }

        .config-card-header h5 {
            font-size: 0.9rem;
        }

        .config-settings-info h6 {
            font-size: 0.8rem;
        }

        .config-switch {
            width: 46px;
            height: 26px;
        }

        .config-switch-slider:before {
            height: 18px;
            width: 18px;
        }

        .config-switch input:checked + .config-switch-slider:before {
            transform: translateX(20px);
        }
    }

    /* Safe area para iPhone X+ */
    @@supports (padding-bottom: env(safe-area-inset-bottom)) {
        @@media (max-width: 767px) {
            .config-page-wrapper {
                padding-bottom: calc(70px + env(safe-area-inset-bottom));
            }

            .config-modal-footer {
                padding-bottom: calc(16px + env(safe-area-inset-bottom));
            }
        }
    }

    /* Optimizaciones de rendimiento móvil */
    @@media (max-width: 767px) {
        .config-card,
        .config-nav-item,
        .config-switch-slider {
            transition-duration: 0.15s;
        }

        /* Desactivar hover en móvil */
        .config-nav-item:hover {
            background: transparent;
        }

        .config-nav-item:active {
            background: rgba(70, 130, 180, 0.1);
        }

        .config-nav-item.active:hover,
        .config-nav-item.active:active {
            background: var(--config-primary);
        }

        /* Scroll suave en sidebar */
        .config-sidebar {
            scroll-snap-type: x proximity;
        }

        .config-nav-item {
            scroll-snap-align: start;
        }
    }

</style>

<div class="config-page-wrapper">
    <!-- Mensajes de error/éxito -->
    @if (TempData["Error"] != null)
    {
        <div class="config-alert config-alert-danger" style="margin-bottom: 20px;">
            <svg class="config-icon" viewBox="0 0 24 24" style="flex-shrink: 0;">
                <circle cx="12" cy="12" r="10" />
                <line x1="12" y1="8" x2="12" y2="12" />
                <line x1="12" y1="16" x2="12.01" y2="16" />
            </svg>
            <div>
                <strong>Error:</strong> @TempData["Error"]
            </div>
        </div>
    }
    @if (TempData["Success"] != null)
    {
        <div class="config-alert" style="margin-bottom: 20px; background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; color: #059669;">
            <svg class="config-icon" viewBox="0 0 24 24" style="flex-shrink: 0;">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            <div>
                <strong>Éxito:</strong> @TempData["Success"]
            </div>
        </div>
    }

    <!-- Header -->
    <div class="config-header">
        <h2>Configuracion de la Cuenta</h2>
        <p>Administra tu cuenta, seguridad, notificaciones y preferencias de privacidad</p>
    </div>

    <div class="config-layout">
        <!-- Sidebar -->
        <div class="config-sidebar">
            <button class="config-nav-item active" onclick="cambiarTab('cuenta')">
                <svg class="config-nav-icon" viewBox="0 0 24 24">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
                Cuenta
            </button>
            <button class="config-nav-item" onclick="cambiarTab('seguridad')">
                <svg class="config-nav-icon" viewBox="0 0 24 24">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                    <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                </svg>
                Seguridad
            </button>
            <button class="config-nav-item" onclick="cambiarTab('notificaciones')">
                <svg class="config-nav-icon" viewBox="0 0 24 24">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                    <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                </svg>
                Notificaciones
            </button>
            <button class="config-nav-item" onclick="cambiarTab('privacidad')">
                <svg class="config-nav-icon" viewBox="0 0 24 24">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                </svg>
                Privacidad
            </button>
            <button class="config-nav-item" onclick="cambiarTab('agencia')">
                <svg class="config-nav-icon" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                Agencia Publicitaria
            </button>
            <button class="config-nav-item" onclick="cambiarTab('idioma')">
                <svg class="config-nav-icon" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="2" y1="12" x2="22" y2="12"/>
                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                </svg>
                Idioma
            </button>
            <button class="config-nav-item" onclick="cambiarTab('ladopreferido')">
                <svg class="config-nav-icon" viewBox="0 0 24 24">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                Lado Preferido
            </button>
        </div>

        <!-- Content -->
        <div>
            <!-- Tab Cuenta -->
            <div class="config-tab-content active" id="cuenta">
                <div class="config-card">
                    <div class="config-card-header">
                        <h5>Información de la Cuenta</h5>
                    </div>
                    <div class="config-card-body">
                        <form asp-action="ActualizarCuenta" method="post">
                            <div class="config-form-group">
                                <label class="config-form-label">Correo Electrónico</label>
                                <input type="email" class="config-form-control" value="@Model.Email" disabled>
                                <small class="config-form-text">Para cambiar tu correo, contacta con soporte</small>
                            </div>

                            <div class="config-form-group">
                                <label class="config-form-label">Nombre de Usuario</label>
                                <div class="config-input-group">
                                    <span class="config-input-group-text">@@</span>
                                    <input type="text" class="config-form-control" value="@Model.UserName" asp-for="UserName">
                                </div>
                            </div>

                            <button type="submit" class="config-btn config-btn-primary">
                                <svg class="config-icon" viewBox="0 0 24 24">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                    <polyline points="17 21 17 13 7 13 7 21" />
                                    <polyline points="7 3 7 8 15 8" />
                                </svg>
                                Guardar Cambios
                            </button>
                        </form>
                    </div>
                </div>

                <div class="config-card config-card-danger">
                    <div class="config-card-header">
                        <h5>Zona de Peligro</h5>
                    </div>
                    <div class="config-card-body">
                        <div class="config-settings-row">
                            <div class="config-settings-info">
                                <h6>Eliminar Cuenta</h6>
                                <p>Una vez eliminada, no podrás recuperar tu cuenta</p>
                            </div>
                            <button class="config-btn config-btn-outline-danger" onclick="abrirModal()">
                                <svg class="config-icon" viewBox="0 0 24 24">
                                    <polyline points="3 6 5 6 21 6" />
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                </svg>
                                Eliminar Cuenta
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Seguridad -->
            <div class="config-tab-content" id="seguridad">
                <div class="config-card">
                    <div class="config-card-header">
                        <h5>Cambiar Contraseña</h5>
                    </div>
                    <div class="config-card-body">
                        <form asp-action="CambiarContrasena" method="post">
                            <div class="config-form-group">
                                <label class="config-form-label">Contraseña Actual</label>
                                <input type="password" class="config-form-control" name="ContrasenaActual" required>
                            </div>

                            <div class="config-form-group">
                                <label class="config-form-label">Nueva Contraseña</label>
                                <input type="password" class="config-form-control" name="NuevaContrasena" required>
                                <small class="config-form-text">Mínimo 8 caracteres</small>
                            </div>

                            <div class="config-form-group">
                                <label class="config-form-label">Confirmar Nueva Contraseña</label>
                                <input type="password" class="config-form-control" name="ConfirmarContrasena" required>
                            </div>

                            <button type="submit" class="config-btn config-btn-primary">
                                <svg class="config-icon" viewBox="0 0 24 24">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                                </svg>
                                Cambiar Contraseña
                            </button>
                        </form>
                    </div>
                </div>

                <div class="config-card">
                    <div class="config-card-header">
                        <h5>Autenticación de Dos Factores</h5>
                    </div>
                    <div class="config-card-body">
                        <div class="config-settings-row">
                            <div class="config-settings-info">
                                <h6>Autenticación de Dos Factores (2FA)</h6>
                                <p>Agrega una capa extra de seguridad a tu cuenta</p>
                            </div>
                            <label class="config-switch">
                                <input type="checkbox" id="switch2FA">
                                <span class="config-switch-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Notificaciones -->
            <div class="config-tab-content" id="notificaciones">
                <div class="config-card">
                    <div class="config-card-header">
                        <h5>Preferencias de Notificaciones</h5>
                    </div>
                    <div class="config-card-body">
                        <form asp-action="ActualizarNotificaciones" method="post">
                            <h6 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Notificaciones por Email</h6>

                            <div class="config-settings-row">
                                <div class="config-settings-info">
                                    <h6>Nuevos Seguidores</h6>
                                    <p>Recibe un email cuando alguien te siga</p>
                                </div>
                                <label class="config-switch">
                                    <input type="checkbox" name="EmailNuevosSeguidores" checked>
                                    <span class="config-switch-slider"></span>
                                </label>
                            </div>

                            <div class="config-settings-row">
                                <div class="config-settings-info">
                                    <h6>Nuevos Mensajes</h6>
                                    <p>Notificación de mensajes directos</p>
                                </div>
                                <label class="config-switch">
                                    <input type="checkbox" name="EmailNuevosMensajes" checked>
                                    <span class="config-switch-slider"></span>
                                </label>
                            </div>

                            <hr style="border: none; border-top: 1px solid var(--config-border); margin: 24px 0;">

                            <h6 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Notificaciones Push</h6>

                            <div class="config-settings-row">
                                <div class="config-settings-info">
                                    <h6>Activar Notificaciones Push</h6>
                                    <p>Recibe notificaciones en tu dispositivo</p>
                                </div>
                                <label class="config-switch">
                                    <input type="checkbox" name="PushNotifications">
                                    <span class="config-switch-slider"></span>
                                </label>
                            </div>

                            <button type="submit" class="config-btn config-btn-primary" style="margin-top: 24px;">
                                <svg class="config-icon" viewBox="0 0 24 24">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                    <polyline points="17 21 17 13 7 13 7 21" />
                                    <polyline points="7 3 7 8 15 8" />
                                </svg>
                                Guardar Preferencias
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Tab Privacidad -->
            <div class="config-tab-content" id="privacidad">
                <div class="config-card">
                    <div class="config-card-header">
                        <h5>Configuración de Privacidad</h5>
                    </div>
                    <div class="config-card-body">
                        <form asp-action="ActualizarPrivacidad" method="post">
                            <div class="config-settings-row">
                                <div class="config-settings-info">
                                    <h6>Perfil Público</h6>
                                    <p>Permite que cualquiera vea tu perfil</p>
                                </div>
                                <label class="config-switch">
                                    <input type="checkbox" name="PerfilPublico" checked>
                                    <span class="config-switch-slider"></span>
                                </label>
                            </div>

                            <div class="config-settings-row">
                                <div class="config-settings-info">
                                    <h6>Mostrar en Búsquedas</h6>
                                    <p>Aparecer en resultados de búsqueda</p>
                                </div>
                                <label class="config-switch">
                                    <input type="checkbox" name="MostrarBusquedas" checked>
                                    <span class="config-switch-slider"></span>
                                </label>
                            </div>

                            <div class="config-settings-row">
                                <div class="config-settings-info">
                                    <h6>Mensajes de Desconocidos</h6>
                                    <p>Permite mensajes de personas que no sigues</p>
                                </div>
                                <label class="config-switch">
                                    <input type="checkbox" name="MensajesDesconocidos">
                                    <span class="config-switch-slider"></span>
                                </label>
                            </div>

                            <div class="config-settings-row">
                                <div class="config-settings-info">
                                    <h6>Detectar Ubicacion en Fotos</h6>
                                    <p>Extrae automaticamente la ubicacion de tus fotos y la muestra en el feed</p>
                                </div>
                                <label class="config-switch">
                                    <input type="checkbox" name="DetectarUbicacionAutomaticamente" id="detectarUbicacion"
                                           @(Model.DetectarUbicacionAutomaticamente ? "checked" : "")
                                           onchange="actualizarDetectarUbicacion(this.checked)">
                                    <span class="config-switch-slider"></span>
                                </label>
                            </div>

                            <div class="config-settings-row">
                                <div class="config-settings-info">
                                    <h6>Mostrar Estado En Linea</h6>
                                    <p>Permite que otros usuarios vean cuando estas conectado en la plataforma</p>
                                </div>
                                <label class="config-switch">
                                    <input type="checkbox" name="MostrarEstadoEnLinea" id="mostrarEstadoEnLinea"
                                           @(Model.MostrarEstadoEnLinea ? "checked" : "")
                                           onchange="actualizarEstadoEnLinea(this.checked)">
                                    <span class="config-switch-slider"></span>
                                </label>
                            </div>

                            @if (Model.EsCreador && !string.IsNullOrEmpty(Model.Seudonimo))
                            {
                                <div class="config-settings-row">
                                    <div class="config-settings-info">
                                        <h6>Ocultar Identidad LadoA</h6>
                                        <p>Si activas esta opción, solo quienes te sigan en LadoA podrán ver tu perfil público. Los demás serán redirigidos a tu perfil LadoB (@Model.Seudonimo).</p>
                                    </div>
                                    <label class="config-switch">
                                        <input type="checkbox" name="OcultarIdentidadLadoA" id="ocultarIdentidadLadoA"
                                               @(Model.OcultarIdentidadLadoA ? "checked" : "")
                                               onchange="actualizarOcultarIdentidad(this.checked)">
                                        <span class="config-switch-slider"></span>
                                    </label>
                                </div>
                            }

                            <div class="config-settings-row" style="border-top: 1px solid var(--config-border); padding-top: 20px; margin-top: 20px;">
                                <div class="config-settings-info">
                                    <h6>Usuarios Bloqueados</h6>
                                    <p>Gestiona la lista de usuarios que has bloqueado</p>
                                </div>
                                <a href="/Usuario/UsuariosBloqueados" class="config-btn config-btn-secondary" style="padding: 8px 16px; font-size: 14px;">
                                    <svg class="config-icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                                    </svg>
                                    Ver bloqueados
                                </a>
                            </div>

                            <button type="submit" class="config-btn config-btn-primary" style="margin-top: 24px;">
                                <svg class="config-icon" viewBox="0 0 24 24">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                    <polyline points="17 21 17 13 7 13 7 21" />
                                    <polyline points="7 3 7 8 15 8" />
                                </svg>
                                Guardar Configuración
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Tab Agencia -->
            <div class="config-tab-content" id="agencia">
                <div class="config-card">
                    <div class="config-card-header">
                        <h5>Agencia Publicitaria</h5>
                    </div>
                    <div class="config-card-body">
                        @if (agenciaUsuario == null)
                        {
                            <!-- Usuario sin agencia - Mostrar opcion de solicitar -->
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: rgba(70, 130, 180, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                        <polyline points="9 22 9 12 15 12 15 22"/>
                                    </svg>
                                </div>
                                <h5 style="margin-bottom: 10px; color: var(--config-text-primary);">Conviertete en Agencia Publicitaria</h5>
                                <p style="color: var(--config-text-secondary); margin-bottom: 24px; max-width: 400px; margin-left: auto; margin-right: auto;">
                                    Registra tu agencia para crear y gestionar campanas publicitarias, llegar a mas audiencia y hacer crecer tu negocio.
                                </p>
                                <a href="/Agencia/Registrar" class="config-btn config-btn-primary">
                                    <svg class="config-icon" viewBox="0 0 24 24">
                                        <path d="M12 5v14M5 12h14"/>
                                    </svg>
                                    Solicitar ser Agencia
                                </a>
                            </div>
                        }
                        else if (agenciaUsuario.Estado == Lado.Models.EstadoAgencia.Pendiente)
                        {
                            <!-- Solicitud pendiente -->
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: rgba(245, 158, 11, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                </div>
                                <h5 style="margin-bottom: 10px; color: var(--config-text-primary);">Solicitud en Revision</h5>
                                <p style="color: var(--config-text-secondary); margin-bottom: 16px; max-width: 400px; margin-left: auto; margin-right: auto;">
                                    Tu solicitud para <strong>@agenciaUsuario.NombreEmpresa</strong> esta siendo revisada por nuestro equipo. Te notificaremos cuando sea aprobada.
                                </p>
                                <span style="display: inline-block; padding: 8px 16px; background: rgba(245, 158, 11, 0.1); color: #F59E0B; border-radius: 20px; font-weight: 600; font-size: 14px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    Pendiente de aprobacion
                                </span>
                            </div>
                        }
                        else if (agenciaUsuario.Estado == Lado.Models.EstadoAgencia.Rechazada)
                        {
                            <!-- Solicitud rechazada -->
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: rgba(239, 68, 68, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="15" y1="9" x2="9" y2="15"/>
                                        <line x1="9" y1="9" x2="15" y2="15"/>
                                    </svg>
                                </div>
                                <h5 style="margin-bottom: 10px; color: var(--config-text-primary);">Solicitud Rechazada</h5>
                                <p style="color: var(--config-text-secondary); margin-bottom: 16px; max-width: 400px; margin-left: auto; margin-right: auto;">
                                    Tu solicitud para <strong>@agenciaUsuario.NombreEmpresa</strong> fue rechazada.
                                    @if (!string.IsNullOrEmpty(agenciaUsuario.MotivoRechazo))
                                    {
                                        <br/><br/><strong>Motivo:</strong> @agenciaUsuario.MotivoRechazo
                                    }
                                </p>
                                <a href="/Agencia/Registrar" class="config-btn config-btn-primary">
                                    <svg class="config-icon" viewBox="0 0 24 24">
                                        <path d="M12 5v14M5 12h14"/>
                                    </svg>
                                    Enviar Nueva Solicitud
                                </a>
                            </div>
                        }
                        else if (agenciaUsuario.Estado == Lado.Models.EstadoAgencia.Suspendida)
                        {
                            <!-- Agencia suspendida -->
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: rgba(239, 68, 68, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                                    </svg>
                                </div>
                                <h5 style="margin-bottom: 10px; color: var(--config-text-primary);">Agencia Suspendida</h5>
                                <p style="color: var(--config-text-secondary); margin-bottom: 16px; max-width: 400px; margin-left: auto; margin-right: auto;">
                                    Tu agencia <strong>@agenciaUsuario.NombreEmpresa</strong> ha sido suspendida.
                                    @if (!string.IsNullOrEmpty(agenciaUsuario.MotivoSuspension))
                                    {
                                        <br/><br/><strong>Motivo:</strong> @agenciaUsuario.MotivoSuspension
                                    }
                                    <br/><br/>Para mas informacion, contacta con soporte.
                                </p>
                            </div>
                        }
                        else if (agenciaUsuario.Estado == Lado.Models.EstadoAgencia.Activa)
                        {
                            <!-- Agencia activa -->
                            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px;">
                                @if (!string.IsNullOrEmpty(agenciaUsuario.LogoUrl))
                                {
                                    <img src="@agenciaUsuario.LogoUrl" alt="@agenciaUsuario.NombreEmpresa" style="width: 70px; height: 70px; border-radius: 12px; object-fit: cover;">
                                }
                                else
                                {
                                    <div style="width: 70px; height: 70px; border-radius: 12px; background: #4682B4; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: 700;">
                                        @agenciaUsuario.NombreEmpresa.Substring(0, 1).ToUpper()
                                    </div>
                                }
                                <div>
                                    <h5 style="margin: 0 0 4px; color: var(--config-text-primary);">@agenciaUsuario.NombreEmpresa</h5>
                                    <p style="margin: 0; color: var(--config-text-secondary); font-size: 14px;">@agenciaUsuario.RazonSocial</p>
                                    <span style="display: inline-block; margin-top: 8px; padding: 4px 12px; background: rgba(70, 130, 180, 0.1); color: #4682B4; border-radius: 20px; font-weight: 600; font-size: 12px;">
                                        Agencia Activa
                                    </span>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
                                <div style="text-align: center; padding: 16px; background: var(--config-border); border-radius: 12px;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--config-primary);">$@agenciaUsuario.SaldoPublicitario.ToString("N2")</div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary);">Saldo disponible</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: var(--config-border); border-radius: 12px;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--config-text-primary);">@agenciaUsuario.Anuncios?.Count(a => a.Estado == Lado.Models.EstadoAnuncio.Activo)</div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary);">Anuncios activos</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: var(--config-border); border-radius: 12px;">
                                    <div style="font-size: 24px; font-weight: 700; color: var(--config-text-primary);">@agenciaUsuario.Anuncios?.Count</div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary);">Total anuncios</div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <a href="/Agencia" class="config-btn config-btn-primary">
                                    <svg class="config-icon" viewBox="0 0 24 24">
                                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                        <polyline points="9 22 9 12 15 12 15 22"/>
                                    </svg>
                                    Ir al Panel de Agencia
                                </a>
                                <a href="/Agencia/CrearAnuncio" class="config-btn" style="background: var(--config-border); color: var(--config-text-primary);">
                                    <svg class="config-icon" viewBox="0 0 24 24">
                                        <path d="M12 5v14M5 12h14"/>
                                    </svg>
                                    Crear Anuncio
                                </a>
                                <a href="/Agencia/RecargarSaldo" class="config-btn" style="background: var(--config-border); color: var(--config-text-primary);">
                                    <svg class="config-icon" viewBox="0 0 24 24">
                                        <path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/>
                                        <path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/>
                                    </svg>
                                    Recargar Saldo
                                </a>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Tab Idioma -->
            <div class="config-tab-content" id="idioma">
                <div class="config-card">
                    <div class="config-card-header">
                        <h5>Preferencias de Idioma</h5>
                    </div>
                    <div class="config-card-body">
                        <p style="color: var(--config-text-secondary); margin-bottom: 24px;">
                            Selecciona el idioma en el que deseas ver la interfaz de Lado. El contenido creado por otros usuarios se mostrara en su idioma original.
                        </p>

                        <div class="language-options" style="display: flex; flex-direction: column; gap: 12px;">
                            <!-- Español -->
                            <label class="language-option @(Model.Idioma == "es" || string.IsNullOrEmpty(Model.Idioma) ? "selected" : "")" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; border: 2px solid var(--config-border); border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                                <input type="radio" name="idioma" value="es" @(Model.Idioma == "es" || string.IsNullOrEmpty(Model.Idioma) ? "checked" : "") style="display: none;" onchange="cambiarIdioma('es')">
                                <span style="font-size: 32px;">🇲🇽</span>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--config-text-primary);">Espanol (Latino)</div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary);">Interfaz en espanol latinoamericano</div>
                                </div>
                                <svg class="check-icon" viewBox="0 0 24 24" style="width: 24px; height: 24px; stroke: var(--config-primary); fill: none; stroke-width: 3; display: @(Model.Idioma == "es" || string.IsNullOrEmpty(Model.Idioma) ? "block" : "none");">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </label>

                            <!-- English -->
                            <label class="language-option @(Model.Idioma == "en" ? "selected" : "")" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; border: 2px solid var(--config-border); border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                                <input type="radio" name="idioma" value="en" @(Model.Idioma == "en" ? "checked" : "") style="display: none;" onchange="cambiarIdioma('en')">
                                <span style="font-size: 32px;">🇺🇸</span>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--config-text-primary);">English</div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary);">Interface in English</div>
                                </div>
                                <svg class="check-icon" viewBox="0 0 24 24" style="width: 24px; height: 24px; stroke: var(--config-primary); fill: none; stroke-width: 3; display: @(Model.Idioma == "en" ? "block" : "none");">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </label>

                            <!-- Portugues -->
                            <label class="language-option @(Model.Idioma == "pt" ? "selected" : "")" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; border: 2px solid var(--config-border); border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                                <input type="radio" name="idioma" value="pt" @(Model.Idioma == "pt" ? "checked" : "") style="display: none;" onchange="cambiarIdioma('pt')">
                                <span style="font-size: 32px;">🇧🇷</span>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--config-text-primary);">Portugues</div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary);">Interface em portugues</div>
                                </div>
                                <svg class="check-icon" viewBox="0 0 24 24" style="width: 24px; height: 24px; stroke: var(--config-primary); fill: none; stroke-width: 3; display: @(Model.Idioma == "pt" ? "block" : "none");">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </label>
                        </div>

                        <div id="idiomaFeedback" style="margin-top: 20px; padding: 12px 16px; border-radius: 8px; display: none;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Lado Preferido -->
            <div class="config-tab-content" id="ladopreferido">
                <div class="config-card">
                    <div class="config-card-header">
                        <h5>Lado Preferido</h5>
                    </div>
                    <div class="config-card-body">
                        <p style="color: var(--config-text-secondary); margin-bottom: 24px;">
                            Selecciona qué tipo de contenido prefieres ver primero en tu feed. Esto afecta el orden en que se muestra el contenido de los creadores que sigues.
                        </p>

                        <div class="lado-options" style="display: flex; flex-direction: column; gap: 12px;">
                            <!-- Lado A -->
                            <label class="lado-pref-option @(Model.LadoPreferido == Lado.Models.TipoLado.LadoA ? "selected" : "")" style="display: flex; align-items: center; gap: 16px; padding: 20px; border: 2px solid var(--config-border); border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                                <input type="radio" name="ladoPreferido" value="0" @(Model.LadoPreferido == Lado.Models.TipoLado.LadoA ? "checked" : "") style="display: none;" onchange="cambiarLadoPreferido(0)">
                                <div style="width: 56px; height: 56px; border-radius: 12px; background: linear-gradient(135deg, #4682B4, #5a9fd4); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; flex-shrink: 0;">
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                        <circle cx="12" cy="7" r="4"/>
                                    </svg>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; color: var(--config-text-primary); font-size: 1.1rem; margin-bottom: 4px;">Lado A</div>
                                    <div style="font-size: 14px; color: var(--config-text-secondary); line-height: 1.4;">
                                        Contenido publico y gratuito. Veras primero las publicaciones abiertas de los creadores.
                                    </div>
                                </div>
                                <svg class="check-icon-lado" viewBox="0 0 24 24" style="width: 28px; height: 28px; stroke: var(--config-primary); fill: none; stroke-width: 3; display: @(Model.LadoPreferido == Lado.Models.TipoLado.LadoA ? "block" : "none");">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </label>

                            <!-- Lado B -->
                            <label class="lado-pref-option @(Model.LadoPreferido == Lado.Models.TipoLado.LadoB ? "selected" : "")" style="display: flex; align-items: center; gap: 16px; padding: 20px; border: 2px solid var(--config-border); border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                                <input type="radio" name="ladoPreferido" value="1" @(Model.LadoPreferido == Lado.Models.TipoLado.LadoB ? "checked" : "") style="display: none;" onchange="cambiarLadoPreferido(1)">
                                <div style="width: 56px; height: 56px; border-radius: 12px; background: linear-gradient(135deg, #9333ea, #c084fc); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; flex-shrink: 0;">
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                    </svg>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; color: var(--config-text-primary); font-size: 1.1rem; margin-bottom: 4px;">Lado B</div>
                                    <div style="font-size: 14px; color: var(--config-text-secondary); line-height: 1.4;">
                                        Contenido premium y exclusivo. Veras primero las publicaciones de pago de los creadores a los que estas suscrito.
                                    </div>
                                </div>
                                <svg class="check-icon-lado" viewBox="0 0 24 24" style="width: 28px; height: 28px; stroke: var(--config-primary); fill: none; stroke-width: 3; display: @(Model.LadoPreferido == Lado.Models.TipoLado.LadoB ? "block" : "none");">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </label>
                        </div>

                        <div id="ladoFeedback" style="margin-top: 20px; padding: 12px 16px; border-radius: 8px; display: none;">
                        </div>

                        <!-- Separador -->
                        <hr style="border: none; border-top: 1px solid var(--config-border); margin: 24px 0;">

                        <!-- Bloquear LadoB -->
                        <div class="bloquear-ladob-section">
                            <h6 style="font-size: 1rem; font-weight: 600; color: var(--config-text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                                Control Parental
                            </h6>
                            <p style="font-size: 13px; color: var(--config-text-secondary); margin-bottom: 16px; line-height: 1.5;">
                                Activa esta opcion para ocultar completamente el contenido para adultos (LadoB) de tu experiencia en la plataforma.
                            </p>

                            <label class="bloquear-option @(Model.BloquearLadoB ? "selected" : "")" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; border: 2px solid @(Model.BloquearLadoB ? "#ef4444" : "var(--config-border)"); border-radius: 12px; cursor: pointer; transition: all 0.2s; background: @(Model.BloquearLadoB ? "rgba(239, 68, 68, 0.05)" : "transparent");">
                                <input type="checkbox" id="chkBloquearLadoB" @(Model.BloquearLadoB ? "checked" : "") onchange="cambiarBloqueoLadoB(this.checked)" style="display: none;">
                                <div style="width: 48px; height: 48px; border-radius: 10px; background: linear-gradient(135deg, #ef4444, #f87171); display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                                    </svg>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; color: var(--config-text-primary); font-size: 1rem; margin-bottom: 4px;">
                                        Bloquear contenido LadoB
                                    </div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary); line-height: 1.4;">
                                        No veras usuarios con contenido premium ni sus publicaciones en el feed o explorar.
                                    </div>
                                </div>
                                <div class="bloquear-toggle" style="width: 48px; height: 28px; border-radius: 14px; background: @(Model.BloquearLadoB ? "#ef4444" : "#ccc"); position: relative; transition: all 0.2s; flex-shrink: 0;">
                                    <div style="width: 24px; height: 24px; border-radius: 50%; background: white; position: absolute; top: 2px; @(Model.BloquearLadoB ? "right: 2px;" : "left: 2px;") transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2);"></div>
                                </div>
                            </label>

                            <div id="bloqueoFeedback" style="margin-top: 12px; padding: 10px 14px; border-radius: 8px; display: none; font-size: 13px;">
                            </div>

                            <!-- Separador -->
                            <div style="height: 1px; background: var(--config-border); margin: 24px 0;"></div>

                            <!-- Ocultar del Feed Público -->
                            <h6 style="font-size: 1rem; font-weight: 600; color: var(--config-text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                                    <line x1="1" y1="1" x2="23" y2="23"/>
                                </svg>
                                Privacidad del Feed Público
                            </h6>
                            <p style="font-size: 13px; color: var(--config-text-secondary); margin-bottom: 16px; line-height: 1.5;">
                                Controla si tu contenido aparece en la página pública que pueden ver visitantes sin cuenta.
                            </p>

                            <label class="ocultar-publico-option @(Model.OcultarDeFeedPublico ? "selected" : "")" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; border: 2px solid @(Model.OcultarDeFeedPublico ? "#6366f1" : "var(--config-border)"); border-radius: 12px; cursor: pointer; transition: all 0.2s; background: @(Model.OcultarDeFeedPublico ? "rgba(99, 102, 241, 0.05)" : "transparent");">
                                <input type="checkbox" id="chkOcultarFeedPublico" @(Model.OcultarDeFeedPublico ? "checked" : "") onchange="cambiarOcultarFeedPublico(this.checked)" style="display: none;">
                                <div style="width: 48px; height: 48px; border-radius: 10px; background: linear-gradient(135deg, #6366f1, #818cf8); display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                        <line x1="1" y1="1" x2="23" y2="23"/>
                                    </svg>
                                </div>
                                <div style="flex: 1; min-width: 0;">
                                    <div style="font-weight: 700; color: var(--config-text-primary); font-size: 1rem; margin-bottom: 4px;">
                                        Ocultar del Feed Público
                                    </div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary); line-height: 1.4;">
                                        Tu contenido solo será visible para usuarios registrados. No aparecerás en la página de inicio pública.
                                    </div>
                                </div>
                                <div class="ocultar-toggle" style="width: 48px; height: 28px; border-radius: 14px; background: @(Model.OcultarDeFeedPublico ? "#6366f1" : "#ccc"); position: relative; transition: all 0.2s; flex-shrink: 0;">
                                    <div style="width: 24px; height: 24px; border-radius: 50%; background: white; position: absolute; top: 2px; @(Model.OcultarDeFeedPublico ? "right: 2px;" : "left: 2px;") transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2);"></div>
                                </div>
                            </label>

                            <div id="ocultarPublicoFeedback" style="margin-top: 12px; padding: 10px 14px; border-radius: 8px; display: none; font-size: 13px;">
                            </div>
                        </div>
                    </div>
                </div>

                @if (Model.EsCreador && Model.TieneLadoB())
                {
                <!-- Promoción de LadoB -->
                <div class="config-card" style="margin-top: 24px;">
                    <div class="config-card-header">
                        <h5>Promocionar tu LadoB</h5>
                    </div>
                    <div class="config-card-body">
                        <p style="color: var(--config-text-secondary); margin-bottom: 24px;">
                            Configura cómo promocionar tu contenido LadoB desde tu perfil público (LadoA) sin revelar tu identidad.
                        </p>

                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <!-- Teaser en Perfil -->
                            <label class="promo-option @(Model.MostrarTeaserLadoB ? "selected" : "")" style="display: flex; align-items: flex-start; gap: 16px; padding: 20px; border: 2px solid var(--config-border); border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                                <input type="checkbox" id="chkTeaserLadoB" @(Model.MostrarTeaserLadoB ? "checked" : "") onchange="cambiarPromocionLadoB('teaser', this.checked)" style="display: none;">
                                <div style="width: 48px; height: 48px; border-radius: 10px; background: linear-gradient(135deg, #f59e0b, #fbbf24); display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                                        <polyline points="10 17 15 12 10 7"/>
                                        <line x1="15" y1="12" x2="3" y2="12"/>
                                    </svg>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; color: var(--config-text-primary); font-size: 1rem; margin-bottom: 4px;">
                                        Mostrar teaser en perfil
                                    </div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary); line-height: 1.5;">
                                        Muestra un banner "Tengo contenido exclusivo" en tu perfil LadoA. Los usuarios podrán suscribirse para descubrir tu LadoB.
                                    </div>
                                </div>
                                <div class="promo-toggle" style="width: 48px; height: 28px; border-radius: 14px; background: @(Model.MostrarTeaserLadoB ? "var(--config-primary)" : "#ccc"); position: relative; transition: all 0.2s; flex-shrink: 0;">
                                    <div style="width: 24px; height: 24px; border-radius: 50%; background: white; position: absolute; top: 2px; @(Model.MostrarTeaserLadoB ? "right: 2px;" : "left: 2px;") transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2);"></div>
                                </div>
                            </label>

                            <!-- Preview Blur -->
                            <label class="promo-option @(Model.PermitirPreviewBlurLadoB ? "selected" : "")" style="display: flex; align-items: flex-start; gap: 16px; padding: 20px; border: 2px solid var(--config-border); border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                                <input type="checkbox" id="chkPreviewBlur" @(Model.PermitirPreviewBlurLadoB ? "checked" : "") onchange="cambiarPromocionLadoB('blur', this.checked)" style="display: none;">
                                <div style="width: 48px; height: 48px; border-radius: 10px; background: linear-gradient(135deg, #8b5cf6, #a78bfa); display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0;">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <circle cx="8.5" cy="8.5" r="1.5"/>
                                        <polyline points="21 15 16 10 5 21"/>
                                    </svg>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; color: var(--config-text-primary); font-size: 1rem; margin-bottom: 4px;">
                                        Previews censurados en LadoA
                                    </div>
                                    <div style="font-size: 13px; color: var(--config-text-secondary); line-height: 1.5;">
                                        Activa esta opcion para poder mostrar una version blur de tu contenido LadoB en tu perfil publico (LadoA). Cuando publiques en LadoB, tendras la opcion de crear un preview censurado que servira como adelanto para atraer suscriptores.
                                    </div>
                                </div>
                                <div class="promo-toggle" style="width: 48px; height: 28px; border-radius: 14px; background: @(Model.PermitirPreviewBlurLadoB ? "var(--config-primary)" : "#ccc"); position: relative; transition: all 0.2s; flex-shrink: 0;">
                                    <div style="width: 24px; height: 24px; border-radius: 50%; background: white; position: absolute; top: 2px; @(Model.PermitirPreviewBlurLadoB ? "right: 2px;" : "left: 2px;") transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2);"></div>
                                </div>
                            </label>
                        </div>

                        <div id="promoFeedback" style="margin-top: 20px; padding: 12px 16px; border-radius: 8px; display: none;"></div>
                    </div>
                </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Modal Eliminar -->
<div class="config-modal" id="modalEliminar">
    <div class="config-modal-dialog">
        <form asp-action="EliminarCuenta" asp-controller="Usuario" method="post">
            @Html.AntiForgeryToken()

            <div class="config-modal-header">
                <h5>
                    <svg class="config-icon" viewBox="0 0 24 24">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                        <line x1="12" y1="9" x2="12" y2="13" />
                        <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                    Eliminar Cuenta
                </h5>
                <button type="button" class="config-btn-close" onclick="cerrarModal()">×</button>
            </div>

            <div class="config-modal-body">
                <p style="font-weight: 600; margin-bottom: 12px;">¿Estás seguro de que deseas eliminar tu cuenta?</p>
                <p style="color: var(--config-text-secondary); margin-bottom: 16px;">Esta acción es permanente y no se puede deshacer. Perderás:</p>
                <ul>
                    <li>Todo tu contenido publicado</li>
                    <li>Tus seguidores y suscriptores</li>
                    <li>Tu historial de transacciones</li>
                    <li>Todos tus mensajes y conversaciones</li>
                    <li>Todos tus datos personales</li>
                </ul>

                <div class="config-alert config-alert-danger">
                    <svg class="config-icon" viewBox="0 0 24 24" style="flex-shrink: 0;">
                        <circle cx="12" cy="12" r="10" />
                        <line x1="12" y1="8" x2="12" y2="12" />
                        <line x1="12" y1="16" x2="12.01" y2="16" />
                    </svg>
                    <div>
                        <strong>¡Advertencia!</strong> Esta acción no se puede revertir.
                    </div>
                </div>

                <div class="config-form-group">
                    <label class="config-form-label">Escribe <strong>ELIMINAR</strong> para confirmar</label>
                    <input type="text"
                           class="config-form-control"
                           id="confirmarEliminar"
                           name="confirmacion"
                           placeholder="ELIMINAR"
                           required>
                </div>
            </div>

            <div class="config-modal-footer">
                <button type="button" class="config-btn config-btn-secondary" onclick="cerrarModal()">
                    <svg class="config-icon" viewBox="0 0 24 24">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                    Cancelar
                </button>
                <button type="submit" class="config-btn config-btn-danger" id="btnEliminarCuenta" disabled>
                    <svg class="config-icon" viewBox="0 0 24 24">
                        <polyline points="3 6 5 6 21 6" />
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                    </svg>
                    Eliminar Mi Cuenta
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Cambiar entre tabs
    function cambiarTab(tabId) {
        // Ocultar todos los tabs
        document.querySelectorAll('.config-tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        // Remover active de nav items
        document.querySelectorAll('.config-nav-item').forEach(item => {
            item.classList.remove('active');
        });

        // Mostrar el tab seleccionado
        document.getElementById(tabId).classList.add('active');

        // Marcar nav item como activo
        event.target.closest('.config-nav-item').classList.add('active');
    }

    // Actualizar preferencia de ocultar identidad LadoA
    async function actualizarOcultarIdentidad(habilitado) {
        try {
            const response = await fetch('/Usuario/ActualizarOcultarIdentidad', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ ocultar: habilitado })
            });

            const data = await response.json();

            if (!data.success) {
                document.getElementById('ocultarIdentidadLadoA').checked = !habilitado;
            }
        } catch (error) {
            document.getElementById('ocultarIdentidadLadoA').checked = !habilitado;
        }
    }

    // Actualizar preferencia de deteccion de ubicacion
    async function actualizarDetectarUbicacion(habilitado) {
        try {
            const response = await fetch('/Usuario/ActualizarDeteccionUbicacion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ habilitado: habilitado })
            });

            const data = await response.json();

            if (!data.success) {
                document.getElementById('detectarUbicacion').checked = !habilitado;
            }
        } catch (error) {
            document.getElementById('detectarUbicacion').checked = !habilitado;
        }
    }

    // Actualizar preferencia de mostrar estado en linea
    async function actualizarEstadoEnLinea(habilitado) {
        try {
            const response = await fetch('/Usuario/ActualizarEstadoEnLinea', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ mostrar: habilitado })
            });

            const data = await response.json();

            if (!data.success) {
                document.getElementById('mostrarEstadoEnLinea').checked = !habilitado;
            }
        } catch (error) {
            document.getElementById('mostrarEstadoEnLinea').checked = !habilitado;
        }
    }

    // Modal Eliminar Cuenta
    function abrirModal() {
        const modal = document.getElementById('modalEliminar');
        if (modal) {
            modal.classList.add('show');
        }
    }

    function cerrarModal() {
        const modal = document.getElementById('modalEliminar');
        if (modal) {
            modal.classList.remove('show');
        }
        const confirmar = document.getElementById('confirmarEliminar');
        if (confirmar) {
            confirmar.value = '';
        }
        const btn = document.getElementById('btnEliminarCuenta');
        if (btn) {
            btn.disabled = true;
        }
    }

    // Validar confirmación
    const confirmarInput = document.getElementById('confirmarEliminar');
    if (confirmarInput) {
        confirmarInput.addEventListener('input', function() {
            const btnEliminar = document.getElementById('btnEliminarCuenta');
            if (btnEliminar) {
                btnEliminar.disabled = this.value !== 'ELIMINAR';
            }
        });
    }

    // Confirmar antes de enviar
    const formEliminar = document.querySelector('#modalEliminar form');
    if (formEliminar) {
        formEliminar.addEventListener('submit', function(e) {
            const confirmacion = document.getElementById('confirmarEliminar')?.value;

            if (confirmacion !== 'ELIMINAR') {
                e.preventDefault();
                alert('Debes escribir "ELIMINAR" exactamente para confirmar');
                return false;
            }

            if (!confirm('¿Estás ABSOLUTAMENTE seguro? Esta acción NO se puede deshacer.')) {
                e.preventDefault();
                return false;
            }

            const btnEliminar = document.getElementById('btnEliminarCuenta');
            if (btnEliminar) {
                btnEliminar.disabled = true;
                btnEliminar.innerHTML = '<svg class="config-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg> Eliminando...';
            }

            return true;
        });
    }

    // Cerrar modal al hacer clic fuera
    document.getElementById('modalEliminar')?.addEventListener('click', function(event) {
        if (event.target === this) {
            cerrarModal();
        }
    });

    // Cambiar idioma
    async function cambiarIdioma(idioma) {
        const options = document.querySelectorAll('.language-option');
        const feedback = document.getElementById('idiomaFeedback');

        // Marcar todas como loading
        options.forEach(opt => {
            opt.classList.add('loading');
        });

        try {
            const response = await fetch('/Usuario/CambiarIdioma', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ idioma: idioma })
            });

            const data = await response.json();

            if (data.success) {
                // Actualizar UI
                options.forEach(opt => {
                    const input = opt.querySelector('input[type="radio"]');
                    const checkIcon = opt.querySelector('.check-icon');

                    if (input.value === idioma) {
                        opt.classList.add('selected');
                        if (checkIcon) checkIcon.style.display = 'block';
                    } else {
                        opt.classList.remove('selected');
                        if (checkIcon) checkIcon.style.display = 'none';
                    }
                });

                // Mostrar feedback
                feedback.style.display = 'block';
                feedback.style.background = 'rgba(16, 185, 129, 0.1)';
                feedback.style.color = '#10b981';
                feedback.innerHTML = '<strong>✓</strong> ' + data.message + ' - Recargando...';

                // Recargar la página para aplicar el idioma
                setTimeout(() => {
                    window.location.reload();
                }, 800);
            } else {
                throw new Error(data.message || 'Error al cambiar idioma');
            }
        } catch (error) {
            feedback.style.display = 'block';
            feedback.style.background = 'rgba(239, 68, 68, 0.1)';
            feedback.style.color = '#ef4444';
            feedback.innerHTML = '<strong>✗</strong> ' + error.message;

            // Restaurar seleccion anterior
            const currentLang = '@Model.Idioma' || 'es';
            options.forEach(opt => {
                const input = opt.querySelector('input[type="radio"]');
                input.checked = (input.value === currentLang);
            });
        } finally {
            options.forEach(opt => {
                opt.classList.remove('loading');
            });
        }
    }

    // Cambiar lado preferido
    async function cambiarLadoPreferido(lado) {
        const options = document.querySelectorAll('.lado-pref-option');
        const feedback = document.getElementById('ladoFeedback');

        // Marcar todas como loading
        options.forEach(opt => {
            opt.classList.add('loading');
        });

        try {
            const response = await fetch('/Usuario/CambiarLadoPreferido', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ ladoPreferido: lado })
            });

            const data = await response.json();

            if (data.success) {
                // Actualizar UI
                options.forEach(opt => {
                    const input = opt.querySelector('input[type="radio"]');
                    const checkIcon = opt.querySelector('.check-icon-lado');

                    if (parseInt(input.value) === lado) {
                        opt.classList.add('selected');
                        if (checkIcon) checkIcon.style.display = 'block';
                    } else {
                        opt.classList.remove('selected');
                        if (checkIcon) checkIcon.style.display = 'none';
                    }
                });

                // Mostrar feedback
                feedback.style.display = 'block';
                feedback.style.background = 'rgba(16, 185, 129, 0.1)';
                feedback.style.color = '#10b981';
                feedback.innerHTML = '<strong>✓</strong> ' + data.message + ' Actualizando...';

                // Recargar la página para actualizar sidebar y menús
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                throw new Error(data.message || 'Error al cambiar lado preferido');
            }
        } catch (error) {
            feedback.style.display = 'block';
            feedback.style.background = 'rgba(239, 68, 68, 0.1)';
            feedback.style.color = '#ef4444';
            feedback.innerHTML = '<strong>✗</strong> ' + error.message;

            // Restaurar seleccion anterior
            const currentLado = @((int)Model.LadoPreferido);
            options.forEach(opt => {
                const input = opt.querySelector('input[type="radio"]');
                input.checked = (parseInt(input.value) === currentLado);
            });
        } finally {
            options.forEach(opt => {
                opt.classList.remove('loading');
            });
        }
    }

    // Cambiar bloqueo de LadoB
    async function cambiarBloqueoLadoB(bloquear) {
        const option = document.querySelector('.bloquear-option');
        const toggle = option.querySelector('.bloquear-toggle');
        const toggleCircle = toggle.querySelector('div');
        const feedback = document.getElementById('bloqueoFeedback');

        try {
            const response = await fetch('/Usuario/CambiarBloqueoLadoB', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ bloquear: bloquear })
            });

            const data = await response.json();

            if (data.success) {
                // Actualizar UI
                if (bloquear) {
                    option.classList.add('selected');
                    option.style.borderColor = '#ef4444';
                    option.style.background = 'rgba(239, 68, 68, 0.05)';
                    toggle.style.background = '#ef4444';
                    toggleCircle.style.left = 'auto';
                    toggleCircle.style.right = '2px';
                } else {
                    option.classList.remove('selected');
                    option.style.borderColor = 'var(--config-border)';
                    option.style.background = 'transparent';
                    toggle.style.background = '#ccc';
                    toggleCircle.style.right = 'auto';
                    toggleCircle.style.left = '2px';
                }

                // Mostrar feedback
                feedback.style.display = 'block';
                feedback.style.background = 'rgba(16, 185, 129, 0.1)';
                feedback.style.color = '#10b981';
                feedback.innerHTML = '<strong>✓</strong> ' + data.message;

                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 3000);
            } else {
                throw new Error(data.message || 'Error al cambiar configuración');
            }
        } catch (error) {
            // Restaurar estado anterior
            document.getElementById('chkBloquearLadoB').checked = !bloquear;

            feedback.style.display = 'block';
            feedback.style.background = 'rgba(239, 68, 68, 0.1)';
            feedback.style.color = '#ef4444';
            feedback.innerHTML = '<strong>✗</strong> ' + error.message;

            setTimeout(() => {
                feedback.style.display = 'none';
            }, 3000);
        }
    }

    // Cambiar configuración de ocultar del Feed Público
    async function cambiarOcultarFeedPublico(ocultar) {
        const option = document.querySelector('.ocultar-publico-option');
        const toggle = option.querySelector('.ocultar-toggle');
        const toggleCircle = toggle.querySelector('div');
        const feedback = document.getElementById('ocultarPublicoFeedback');

        try {
            const response = await fetch('/Usuario/CambiarOcultarFeedPublico', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ ocultar: ocultar })
            });

            const data = await response.json();

            if (data.success) {
                // Actualizar UI
                if (ocultar) {
                    option.classList.add('selected');
                    option.style.borderColor = '#6366f1';
                    option.style.background = 'rgba(99, 102, 241, 0.05)';
                    toggle.style.background = '#6366f1';
                    toggleCircle.style.left = 'auto';
                    toggleCircle.style.right = '2px';
                } else {
                    option.classList.remove('selected');
                    option.style.borderColor = 'var(--config-border)';
                    option.style.background = 'transparent';
                    toggle.style.background = '#ccc';
                    toggleCircle.style.right = 'auto';
                    toggleCircle.style.left = '2px';
                }

                // Mostrar feedback
                feedback.style.display = 'block';
                feedback.style.background = 'rgba(16, 185, 129, 0.1)';
                feedback.style.color = '#10b981';
                feedback.innerHTML = '<strong>✓</strong> ' + data.message;

                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 3000);
            } else {
                throw new Error(data.message || 'Error al cambiar configuración');
            }
        } catch (error) {
            // Restaurar estado anterior
            document.getElementById('chkOcultarFeedPublico').checked = !ocultar;

            feedback.style.display = 'block';
            feedback.style.background = 'rgba(239, 68, 68, 0.1)';
            feedback.style.color = '#ef4444';
            feedback.innerHTML = '<strong>✗</strong> ' + error.message;

            setTimeout(() => {
                feedback.style.display = 'none';
            }, 3000);
        }
    }

    // Cambiar configuración de promoción LadoB
    async function cambiarPromocionLadoB(tipo, activo) {
        const feedback = document.getElementById('promoFeedback');

        try {
            const response = await fetch('/Usuario/CambiarPromocionLadoB', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ tipo: tipo, activo: activo })
            });

            const data = await response.json();

            if (data.success) {
                // Actualizar UI del toggle
                const label = tipo === 'teaser'
                    ? document.querySelector('#chkTeaserLadoB').closest('label')
                    : document.querySelector('#chkPreviewBlur').closest('label');

                const toggle = label.querySelector('.promo-toggle');
                const circle = toggle.querySelector('div');

                if (activo) {
                    label.classList.add('selected');
                    toggle.style.background = 'var(--config-primary)';
                    circle.style.left = 'auto';
                    circle.style.right = '2px';
                } else {
                    label.classList.remove('selected');
                    toggle.style.background = '#ccc';
                    circle.style.right = 'auto';
                    circle.style.left = '2px';
                }

                // Mostrar feedback
                feedback.style.display = 'block';
                feedback.style.background = 'rgba(16, 185, 129, 0.1)';
                feedback.style.color = '#10b981';
                feedback.innerHTML = '<strong>✓</strong> ' + data.message;

                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 3000);
            } else {
                throw new Error(data.message || 'Error al guardar');
            }
        } catch (error) {
            // Revertir checkbox
            const checkbox = tipo === 'teaser'
                ? document.getElementById('chkTeaserLadoB')
                : document.getElementById('chkPreviewBlur');
            checkbox.checked = !activo;

            feedback.style.display = 'block';
            feedback.style.background = 'rgba(239, 68, 68, 0.1)';
            feedback.style.color = '#ef4444';
            feedback.innerHTML = '<strong>✗</strong> ' + error.message;
        }
    }
</script>