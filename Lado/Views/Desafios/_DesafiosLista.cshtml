@model IEnumerable<Lado.Models.Desafio>

<style>
    .desafios-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .desafio-card {
        background: white;
        border-radius: 20px;
        padding: 24px;
        display: grid;
        grid-template-columns: 1fr auto auto auto auto auto;
        gap: 24px;
        align-items: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.04);
        border: 1px solid var(--border-color, #e2e8f0);
        transition: all 0.3s ease;
    }

    .desafio-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(70, 130, 180, 0.12);
        border-color: #B0C4DE;
    }

    /* Title Section */
    .desafio-info {
        display: flex;
        align-items: center;
        gap: 16px;
        min-width: 0;
    }

    .desafio-icon {
        width: 52px;
        height: 52px;
        border-radius: 14px;
        background: linear-gradient(135deg, #4682B4 0%, #36648B 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        box-shadow: 0 6px 20px rgba(70, 130, 180, 0.3);
    }

    .desafio-icon svg {
        width: 26px;
        height: 26px;
        color: white;
    }

    .desafio-content {
        min-width: 0;
    }

    .desafio-content h4 {
        font-size: 1rem;
        font-weight: 700;
        color: #1a1a2e;
        margin: 0 0 6px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .desafio-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .desafio-categoria {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 0.8rem;
        color: #64748b;
    }

    .desafio-fecha {
        font-size: 0.8rem;
        color: #94a3b8;
    }

    /* Type Badge */
    .tipo-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.8rem;
        white-space: nowrap;
    }

    .tipo-badge.publico {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
    }

    .tipo-badge.directo {
        background: linear-gradient(135deg, #4682B4 0%, #36648B 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(70, 130, 180, 0.25);
    }

    .tipo-badge svg {
        width: 14px;
        height: 14px;
    }

    /* Budget */
    .presupuesto-section {
        text-align: center;
        min-width: 100px;
    }

    .presupuesto-valor {
        font-size: 1.25rem;
        font-weight: 800;
        color: #4682B4;
        display: block;
    }

    .presupuesto-plazo {
        font-size: 0.75rem;
        color: #94a3b8;
        margin-top: 4px;
    }

    /* Status Badge */
    .estado-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.8rem;
        white-space: nowrap;
    }

    .estado-badge.completado {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
    }

    .estado-badge.asignado,
    .estado-badge.enprogreso,
    .estado-badge.contenidosubido {
        background: linear-gradient(135deg, #4682B4 0%, #36648B 100%);
        color: white;
    }

    .estado-badge.pendiente,
    .estado-badge.recibiendopropuestas {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
    }

    .estado-badge.rechazado,
    .estado-badge.expirado,
    .estado-badge.cancelado {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
    }

    /* Proposals */
    .propuestas-section {
        text-align: center;
        min-width: 80px;
    }

    .propuestas-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        border-radius: 12px;
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        font-weight: 700;
        font-size: 0.85rem;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.25);
    }

    .propuestas-badge svg {
        width: 14px;
        height: 14px;
    }

    .propuestas-text {
        font-size: 0.8rem;
        color: #64748b;
    }

    /* Actions */
    .desafio-actions {
        display: flex;
        gap: 10px;
    }

    .btn-action {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 10px 18px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.85rem;
        text-decoration: none;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        cursor: pointer;
    }

    .btn-action.primary {
        background: rgba(70, 130, 180, 0.1);
        color: #4682B4;
        border-color: #4682B4;
    }

    .btn-action.primary:hover {
        background: linear-gradient(135deg, #4682B4 0%, #36648B 100%);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(70, 130, 180, 0.3);
    }

    .btn-action.danger {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border-color: #ef4444;
    }

    .btn-action.danger:hover {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
    }

    .btn-action svg {
        width: 16px;
        height: 16px;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 30px;
        background: white;
        border-radius: 24px;
        box-shadow: 0 4px 20px rgba(70, 130, 180, 0.08);
        border: 1px solid #e2e8f0;
    }

    .empty-icon {
        width: 100px;
        height: 100px;
        margin: 0 auto 24px;
        background: linear-gradient(135deg, rgba(70, 130, 180, 0.1) 0%, rgba(70, 130, 180, 0.05) 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .empty-icon svg {
        width: 48px;
        height: 48px;
        color: #4682B4;
        opacity: 0.6;
    }

    .empty-state h5 {
        color: #1a1a2e;
        font-weight: 700;
        font-size: 1.25rem;
        margin-bottom: 10px;
    }

    .empty-state p {
        color: #64748b;
        font-size: 1rem;
        margin: 0;
    }

    /* Responsive */
    @@media (max-width: 1200px) {
        .desafio-card {
            grid-template-columns: 1fr auto auto;
            gap: 16px;
        }

        .propuestas-section,
        .presupuesto-section {
            display: none;
        }
    }

    @@media (max-width: 768px) {
        .desafio-card {
            grid-template-columns: 1fr;
            gap: 16px;
            padding: 20px;
        }

        .desafio-info {
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
        }

        .desafio-content h4 {
            white-space: normal;
        }

        .desafio-actions {
            width: 100%;
            justify-content: stretch;
        }

        .desafio-actions .btn-action {
            flex: 1;
            justify-content: center;
        }

        .tipo-badge,
        .estado-badge {
            width: fit-content;
        }

        .propuestas-section,
        .presupuesto-section {
            display: block;
            text-align: left;
        }
    }
</style>

@if (Model != null && Model.Any())
{
    <div class="desafios-list">
        @foreach (var desafio in Model)
        {
            <div class="desafio-card">
                <!-- Info -->
                <div class="desafio-info">
                    <div class="desafio-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                            <path d="M4 22h16"/>
                            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
                        </svg>
                    </div>
                    <div class="desafio-content">
                        <h4>@desafio.Titulo</h4>
                        <div class="desafio-meta">
                            @if (!string.IsNullOrEmpty(desafio.Categoria))
                            {
                                <span class="desafio-categoria">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M4 9h16"/>
                                        <path d="M4 15h16"/>
                                        <path d="M10 3L8 21"/>
                                        <path d="M16 3l-2 18"/>
                                    </svg>
                                    @desafio.Categoria
                                </span>
                            }
                            <span class="desafio-fecha">@desafio.FechaCreacion.ToString("dd MMM yyyy")</span>
                        </div>
                    </div>
                </div>

                <!-- Type -->
                @if (desafio.TipoDesafio == TipoDesafio.Publico)
                {
                    <span class="tipo-badge publico">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                        Publico
                    </span>
                }
                else
                {
                    <span class="tipo-badge directo">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Directo
                    </span>
                }

                <!-- Budget -->
                <div class="presupuesto-section">
                    <span class="presupuesto-valor">$@desafio.Presupuesto.ToString("N0")</span>
                    <span class="presupuesto-plazo">@desafio.DiasPlazoPlazo dias</span>
                </div>

                <!-- Status -->
                <span class="estado-badge @desafio.Estado.ToString().ToLower()">
                    @switch (desafio.Estado)
                    {
                        case EstadoDesafio.Completado:
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            break;
                        case EstadoDesafio.EnProgreso:
                        case EstadoDesafio.Asignado:
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            break;
                        case EstadoDesafio.Pendiente:
                        case EstadoDesafio.RecibiendoPropuestas:
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                            break;
                        default:
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="15" y1="9" x2="9" y2="15"/>
                                <line x1="9" y1="9" x2="15" y2="15"/>
                            </svg>
                            break;
                    }
                    @desafio.Estado.ToString()
                </span>

                <!-- Proposals -->
                <div class="propuestas-section">
                    @if (desafio.TipoDesafio == TipoDesafio.Publico)
                    {
                        <span class="propuestas-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            @desafio.Propuestas.Count
                        </span>
                    }
                    else if (desafio.CreadorObjetivo != null)
                    {
                        <span class="propuestas-text">@desafio.CreadorObjetivo.NombreCompleto</span>
                    }
                    else
                    {
                        <span class="propuestas-text">-</span>
                    }
                </div>

                <!-- Actions -->
                <div class="desafio-actions">
                    <a href="@Url.Action("Detalles", "Desafios", new { id = desafio.Id })" class="btn-action primary">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        Ver
                    </a>
                    @if (desafio.Estado == EstadoDesafio.Pendiente || desafio.Estado == EstadoDesafio.RecibiendoPropuestas)
                    {
                        <button type="button" class="btn-action danger" onclick="cancelarDesafio(@desafio.Id)">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="15" y1="9" x2="9" y2="15"/>
                                <line x1="9" y1="9" x2="15" y2="15"/>
                            </svg>
                        </button>
                    }
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="empty-state">
        <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                <path d="M4 22h16"/>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
            </svg>
        </div>
        <h5>No hay desafios en esta categoria</h5>
        <p>Crea un desafio para empezar a recibir contenido personalizado de tus creadores favoritos.</p>
    </div>
}

<script>
    function cancelarDesafio(desafioId) {
        if (!confirm('Â¿Estas seguro de cancelar este desafio?')) return;

        fetch('/Desafios/CancelarDesafio?desafioId=' + desafioId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
            }
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Error al cancelar el desafio');
            }
        })
        .catch(err => alert('Error al cancelar el desafio'));
    }
</script>
